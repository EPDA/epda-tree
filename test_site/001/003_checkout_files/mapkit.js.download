/* Copyright (c) 2015 Apple Inc. All rights reserved. */

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){window.console||a("./console"),window.mapkit=a("./index")},{"./console":54,"./index":64}],2:[function(a,b,c){function d(){return/Trident/i.test(navigator.userAgent)}b.exports={add:function(a,b){if(a.classList)return void a.classList.add(b);if(Boolean(b)&&"string"==typeof b){var c=this._classNames(a);c.indexOf(b)>=0||(c.push(b),this._classNames(a,c))}},remove:function(a,b){if(a.classList)return void a.classList.remove(b);var c=this._classNames(a),d=c.indexOf(b);0>d||(c.splice(d,1),this._classNames(a,c))},toggle:function(a,b,c){return!a.classList||d()&&3===arguments.length?("undefined"==typeof c&&(c=!this.contains(a,b)),c?this.add(a,b):this.remove(a,b),c):"undefined"==typeof c?a.classList.toggle(b):a.classList.toggle(b,c)},contains:function(a,b){return this._classNames(a).indexOf(b)>=0},_classNames:function(a,b){if(a&&b)a.className=b.join(" ");else if(a){var c=(a.className||"").trim();return c.length>0?c.split(" "):[]}}}},{}],3:[function(a,b,c){function d(){this._operations=[]}function e(a,b,c){this.x=k(a),this.y=k(b),this.z=k(c)}function f(a,b,c){this.x=k(a,1),this.y=k(b,this.x),this.z=k(c,1)}function g(a){this.angle=k(a)}function h(a,b){this.x=k(a),this.y=k(b)}function i(a,b,c,d){this.x=k(a),this.y=k(b),this.z=k(c),this.angle=k(d)}function j(){if(1===arguments.length)return arguments[0]+"px";for(var a=0,b=arguments.length,c=[];b>a;++a)c.push(j(arguments[a]));return c.join(", ")}function k(a,b){return null==a?b||0:a}function l(a,b){return a+"("+b+")"}d.prototype={constructor:d,translate:function(a,b,c){return this._operations.push(new e(a,b,c)),this},scale:function(a,b,c){return this._operations.push(new f(a,b,c)),this},rotate:function(a){return this._operations.push(new g(a)),this},rotate3d:function(a,b,c,d){return this._operations.push(new i(a,b,c,d)),this},skew:function(a,b){return this._operations.push(new h(a,b)),this},transform:function(a){return this._operations=this._operations.concat(a),this},toString:function(){return this._operations.map(function(a){return a.toString()}).join(" ")}},b.exports=d,e.prototype={constructor:e,toString:function(){return!this.x||this.y||this.z?!this.y||this.x||this.z?!this.z||this.x||this.y?this.z?l("translate3d",j(this.x,this.y,this.z)):l("translate",j(this.x,this.y)):l("translateZ",j(this.z)):l("translateY",j(this.y)):l("translateX",j(this.x))}},f.prototype={constructor:f,toString:function(){return 1!==this.x&&1===this.y&&1===this.z?l("scaleX",this.x):1!==this.y&&1===this.x&&1===this.z?l("scaleY",this.y):1!==this.z&&1===this.x&&1===this.y?l("scaleZ",this.z):1===this.z?this.x===this.y?l("scale",this.x):l("scale",[this.x,this.y].join(", ")):l("scale3d",[this.x,this.y,this.z].join(", "))}},g.prototype={constructor:g,toString:function(){return l("rotate",angle+"deg")}},h.prototype={constructor:h,toString:function(){return 0!==this.x&&0===this.y?l("skewX",this.x+"deg"):0!==this.y&&0===this.x?l("skewY",this.y+"deg"):l("skew",[this.x+"deg",this.y+"deg"].join(", "))}},i.prototype={constructor:g,toString:function(){return l("rotate3d",[this.x,this.y,this.z,this.angle].join(", ")+"deg")}}},{}],4:[function(a,b,c){function d(a,b){if(window.matchMedia){var c=window.matchMedia(a);"function"==typeof c.addListener&&c.addListener(b)}}function e(){return"devicePixelRatio"in window?Math.max(Math.round(window.devicePixelRatio),1):"screen"in window&&"deviceXDPI"in window.screen&&"logicalXDPI"in window.screen?Math.max(Math.round(window.screen.deviceXDPI/window.screen.logicalXDPI),1):1}function f(){var a=new g.Event("device-pixel-ratio-change");a.value=e(),e.dispatchEvent(a)}var g=a("dom-events");d("(-webkit-device-pixel-ratio: 1)",f),d("(-moz-device-pixel-ratio: 1)",f),g.EventTarget(e),b.exports=e},{"dom-events":5}],5:[function(a,b,c){function d(a){return a?(a.addEventListener=d.prototype.addEventListener,a.removeEventListener=d.prototype.removeEventListener,a.dispatchEvent=d.prototype.dispatchEvent,a):void 0}function e(a){this.type=a,this.target=null,this.defaultPrevented=!1,this._stoppedPropagation=!1}var f=a("logger");b.exports={EventTarget:d,Event:e},d.prototype={constructor:d,addEventListener:function(a,b,c){if(c=c||null,f.assert(a,"Object.addEventListener: invalid event type ",a,"(listener: ",b,"thisObject: ",c,")"),a&&(f.assert(b,"Object.addEventListener: invalid listener ",b,"(event type: ",a,"thisObject: ",c,")"),b)){this._listeners||(this._listeners={});var d=this._listeners[a];d||(d=this._listeners[a]=[]);for(var e=0;e<d.length;++e)if(d[e].listener===b&&d[e].thisObject===c)return;d.push({thisObject:c,listener:b})}},removeEventListener:function(a,b,c){if(a=a||null,b=b||null,c=c||null,this._listeners)if(a){var d=this._listeners[a];if(d){for(var e=d.length-1;e>=0;--e)b&&d[e].listener===b&&d[e].thisObject===c?d.splice(e,1):!b&&c&&d[e].thisObject===c&&d.splice(e,1);d.length||delete this._listeners[a],Object.keys(this._listeners).length||delete this._listeners}}else for(a in this._listeners)this.removeEventListener(a,b,c)},dispatchEvent:function(a){if(a.target=this,!this._listeners||!this._listeners[a.type]||a._stoppedPropagation)return!0;for(var b=this._listeners[a.type].slice(0),c=0;c<b.length;++c){var d=b[c].thisObject,e=b[c].listener;if(d||"function"==typeof e||"function"!=typeof e.handleEvent?e.call(d,a):e.handleEvent.call(e,a),a._stoppedPropagation)break}return!a.defaultPrevented}},e.prototype={constructor:e,stopPropagation:function(){this._stoppedPropagation=!0},preventDefault:function(){this.defaultPrevented=!0}}},{logger:6}],6:[function(a,b,c){"use strict";function d(){}function e(a){return window.console&&console[a]?Function.prototype.bind.call(console[a],console):d}b.exports={log:e("log"),warn:e("warn"),error:e("error"),assert:e("assert")}},{}],7:[function(a,b,c){function d(a){return a?(a.addEventListener=d.prototype.addEventListener,a.removeEventListener=d.prototype.removeEventListener,a.dispatchEvent=d.prototype.dispatchEvent,a):void 0}function e(a){this.type=a,this.target=null,this.defaultPrevented=!1,this._stoppedPropagation=!1}b.exports={EventTarget:d,Event:e},d.prototype={constructor:d,addEventListener:function(a,b,c){if(c=c||null,console.assert(a,"Object.addEventListener: invalid event type ",a,"(listener: ",b,"thisObject: ",c,")"),!a)return!1;if(console.assert(b,"Object.addEventListener: invalid listener ",b,"(event type: ",a,"thisObject: ",c,")"),!b)return!1;this._listeners||(this._listeners={});var d=this._listeners[a];d||(d=this._listeners[a]=[]);for(var e=0;e<d.length;++e)if(d[e].listener===b&&d[e].thisObject===c)return!1;return d.push({thisObject:c,listener:b}),!0},removeEventListener:function(a,b,c){if(a=a||null,b=b||null,c=c||null,!this._listeners)return!1;if(!a){for(a in this._listeners)this.removeEventListener(a,b,c);return!1}var d=this._listeners[a];if(!d)return!1;for(var e=!1,f=d.length-1;f>=0;--f)if(b&&d[f].listener===b&&d[f].thisObject===c||!b&&c&&d[f].thisObject===c){d.splice(f,1),e=!0;break}return d.length||delete this._listeners[a],Object.keys(this._listeners).length||delete this._listeners,e},dispatchEvent:function(a){if(a.target=this,!this._listeners||!this._listeners[a.type]||a._stoppedPropagation)return!0;for(var b=this._listeners[a.type].slice(0),c=0;c<b.length;++c){var d=b[c].thisObject,e=b[c].listener;if(d||"function"==typeof e||"function"!=typeof e.handleEvent?e.call(d,a):e.handleEvent.call(e,a),a._stoppedPropagation)break}return!a.defaultPrevented}},e.prototype={constructor:e,stopPropagation:function(){this._stoppedPropagation=!0},preventDefault:function(){this.defaultPrevented=!0}}},{}],8:[function(a,b,c){"use strict";window.DOMPoint||(window.DOMPoint=function(a,b,c,d){1===arguments.length&&a&&"object"==typeof a?("x"in a&&(this.x=a.x),"y"in b&&(this.y=a.y),"z"in a&&(this.z=a.z),"w"in a&&(this.w=a.w)):arguments.length>0&&(this.x=a,arguments.length>1&&(this.y=b,arguments.length>2&&(this.z=c,arguments.length>3&&(this.w=d))))},window.DOMPoint.prototype={_x:0,_y:0,_z:0,_w:1,get x(){return this._x},set x(a){if(null===a||isNaN(a))throw"[DOMPoint] `"+a+"` set for x is not a number";this._x=a},get y(){return this._y},set y(a){if(null===a||isNaN(a))throw"[DOMPoint] `"+a+"` set for y is not a number";this._y=a},get z(){return this._z},set z(a){if(null===a||isNaN(a))throw"[DOMPoint] `"+a+"` set for z is not a number";this._z=a},get w(){return this._w},set w(a){if(null===a||isNaN(a))throw"[DOMPoint] `"+a+"` set for w is not a number";this._w=a},matrixTransform:function(a){return console.warn("DOMPoint.matrixTransform is not implemented yet."),this}})},{}],9:[function(a,b,c){function d(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}b.exports=d,d.fromEvent=function(a){var b="undefined"!=typeof TouchEvent&&a instanceof TouchEvent?a.targetTouches[0]:a;return new d(b.pageX,b.pageY)},d.fromEventInElement=function(a,b){var c="undefined"!=typeof TouchEvent&&a instanceof TouchEvent?a.targetTouches[0]:a,e=window.webkitConvertPointFromPageToNode(b,new WebKitPoint(c.pageX,c.pageY));return new d(e.x,e.y)},d.prototype={constructor:d,toString:function(){return"Point["+[this.x,this.y,this.z].join(", ")+"]"},copy:function(){return new d(this.x,this.y,this.z)},equals:function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z},distanceToPoint:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)+Math.pow(this.z-a.z,2))}}},{}],10:[function(a,b,c){function d(a,b,c,d){this.origin=new e(a||0,b||0),this.size=new f(c||0,d||0)}b.exports=d;var e=a("./point"),f=a("./size");d.ZeroRect=new d(0,0,0,0),d.rectFromClientRect=function(a){return new d(a.left,a.top,a.width,a.height)},d.unionOfRects=function(a){for(var b=a[0],c=1;c<a.length;++c)b=b.unionWithRect(a[c]);return b},d.prototype={constructor:d,toString:function(){return"Rect["+[this.origin.x,this.origin.y,this.size.width,this.size.height].join(", ")+"]"},copy:function(){return new d(this.origin.x,this.origin.y,this.size.width,this.size.height)},equals:function(a){return this.origin.equals(a.origin)&&this.size.equals(a.size)},inset:function(a,b,c,e){return new d(this.origin.x+a,this.origin.y+b,this.size.width-a-c,this.size.height-b-e)},pad:function(a){return new d(this.origin.x-a,this.origin.y-a,this.size.width+2*a,this.size.height+2*a)},minX:function(){return this.origin.x},minY:function(){return this.origin.y},midX:function(){return this.origin.x+this.size.width/2},midY:function(){return this.origin.y+this.size.height/2},maxX:function(){return this.origin.x+this.size.width},maxY:function(){return this.origin.y+this.size.height},intersectionWithRect:function(a){var b=Math.max(this.minX(),a.minX()),c=Math.min(this.maxX(),a.maxX());if(b>c)return d.ZeroRect;var e=new d;e.origin.x=b,e.size.width=c-b;var f=Math.max(this.minY(),a.minY()),g=Math.min(this.maxY(),a.maxY());return f>g?d.ZeroRect:(e.origin.y=f,e.size.height=g-f,e)},unionWithRect:function(a){var b=Math.min(this.minX(),a.minX()),c=Math.min(this.minY(),a.minY()),e=Math.max(this.maxX(),a.maxX())-b,f=Math.max(this.maxY(),a.maxY())-c;return new d(b,c,e,f)},round:function(){return new d(Math.floor(this.origin.x),Math.floor(this.origin.y),Math.ceil(this.size.width),Math.ceil(this.size.height))}}},{"./point":9,"./size":11}],11:[function(a,b,c){function d(a,b){this.width=a||0,this.height=b||0}b.exports=d,d.prototype={constructor:d,toString:function(){return"Size["+this.width+", "+this.height+"]"},copy:function(){return new d(this.width,this.height)},equals:function(a){return this.width===a.width&&this.height===a.height}}},{}],12:[function(a,b,c){var d=a("./js/gesture-recognizer");b.exports={GestureRecognizer:d,SupportsTouches:d.SupportsTouches,States:d.States,LongPress:a("./js/long-press"),Pan:a("./js/pan"),Pinch:a("./js/pinch"),Rotation:a("./js/rotation"),Swipe:a("./js/swipe"),Tap:a("./js/tap"),View:a("./js/view")}},{"./js/gesture-recognizer":13,"./js/long-press":14,"./js/pan":15,"./js/pinch":16,"./js/rotation":17,"./js/swipe":18,"./js/tap":19,"./js/view":20}],13:[function(a,b,c){function d(){e.EventTarget.call(this),this._targetTouches=[],this._enabled=!0,this._target=null,this.view=null,this.state=d.States.Possible,this.delegate=null}var e=a("dom-events"),f=a("geometry/point"),g=a("web-point-converter");d.SupportsTouches="createTouch"in document,d.States={Possible:"possible",Began:"began",Changed:"changed",Ended:"ended",Cancelled:"cancelled",Failed:"failed",Recognized:"ended"},d.Events={TouchStart:d.SupportsTouches?"touchstart":"mousedown",TouchMove:d.SupportsTouches?"touchmove":"mousemove",TouchEnd:d.SupportsTouches?"touchend":"mouseup",TouchCancel:"touchcancel",GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"},d.prototype=Object.create(e.EventTarget.prototype,{target:{get:function(){return this._target},set:function(a){a&&this._target!==a&&(this._target=a,this._initRecognizer())}},numberOfTouches:{get:function(){return this._targetTouches.length}},enabled:{get:function(){return this._enabled},set:function(a){this._enabled!==a&&(this._enabled=a,a||(0===this.numberOfTouches?(this._removeTrackingListeners(),this.reset()):this.enterCancelledState()),this._updateBaseListeners())}}}),d.prototype.constructor=d,d.prototype.modifierKeys={alt:!1,ctrl:!1,meta:!1,shift:!1},d.prototype.reset=function(){},d.prototype.locationInElement=function(a){for(var b=new f,c=this._targetTouches,d=0,e=c.length;e>d;++d){var h=c[d];b.x+=h.pageX,b.y+=h.pageY}return b.x/=e,b.y/=e,a?g.fromPageToElement(a,b):b},d.prototype.locationInClient=function(){for(var a=new f,b=this._targetTouches,c=0,d=b.length;d>c;++c){var e=b[c];a.x+=e.clientX,a.y+=e.clientY}return a.x/=d,a.y/=d,a},d.prototype.locationOfTouchInElement=function(a,b){var c=this._targetTouches[a];if(!c)return new f;var d=new f(c.pageX,c.pageY);return b?g.fromPageToElement(b,d):d},d.prototype.touchesBegan=function(a){a.currentTarget===this._target&&(window.addEventListener(d.Events.TouchMove,this,!0),window.addEventListener(d.Events.TouchEnd,this,!0),window.addEventListener(d.Events.TouchCancel,this,!0),this.enterPossibleState())},d.prototype.touchesMoved=function(a){},d.prototype.touchesEnded=function(a){},d.prototype.touchesCancelled=function(a){},d.prototype.gestureBegan=function(a){a.currentTarget===this._target&&(window.addEventListener(d.Events.GestureChange,this,!0),window.addEventListener(d.Events.GestureEnd,this,!0),this.enterPossibleState())},d.prototype.gestureChanged=function(a){},d.prototype.gestureEnded=function(a){},d.prototype.enterPossibleState=function(){this._setStateAndNotifyOfChange(d.States.Possible)},d.prototype.enterBeganState=function(){return this.delegate&&"function"==typeof this.delegate.gestureRecognizerShouldBegin&&!this.delegate.gestureRecognizerShouldBegin(this)?void this.enterFailedState():void this._setStateAndNotifyOfChange(d.States.Began)},d.prototype.enterEndedState=function(){this._setStateAndNotifyOfChange(d.States.Ended),this._removeTrackingListeners(),this.reset()},d.prototype.enterCancelledState=function(){this._setStateAndNotifyOfChange(d.States.Cancelled),this._removeTrackingListeners(),this.reset()},d.prototype.enterFailedState=function(){this._setStateAndNotifyOfChange(d.States.Failed),this._removeTrackingListeners(),this.reset()},d.prototype.enterChangedState=function(){this._setStateAndNotifyOfChange(d.States.Changed)},d.prototype.enterRecognizedState=function(){this._setStateAndNotifyOfChange(d.States.Recognized)},d.prototype.handleEvent=function(a){switch(this._updateTargetTouches(a),this._updateKeyboardModifiers(a),a.type){case d.Events.TouchStart:this.touchesBegan(a);break;case d.Events.TouchMove:this.touchesMoved(a);break;case d.Events.TouchEnd:this.touchesEnded(a);break;case d.Events.TouchCancel:this.touchesCancelled(a);break;case d.Events.GestureStart:this.gestureBegan(a);break;case d.Events.GestureChange:this.gestureChanged(a);break;case d.Events.GestureEnd:this.gestureEnded(a)}},d.prototype._initRecognizer=function(){this.reset(),this.state=d.States.Possible,this._updateBaseListeners()},d.prototype._updateBaseListeners=function(){this._target&&(this._enabled?(this._target.addEventListener(d.Events.TouchStart,this),d.SupportsTouches&&this._target.addEventListener(d.Events.GestureStart,this)):(this._target.removeEventListener(d.Events.TouchStart,this),d.SupportsTouches&&this._target.removeEventListener(d.Events.GestureStart,this)))},d.prototype._removeTrackingListeners=function(){window.removeEventListener(d.Events.TouchMove,this,!0),window.removeEventListener(d.Events.TouchEnd,this,!0),window.removeEventListener(d.Events.GestureChange,this,!0),window.removeEventListener(d.Events.GestureEnd,this,!0)},d.prototype._setStateAndNotifyOfChange=function(a){this.state=a,this.dispatchEvent(new e.Event(d.Events.StateChange))},d.prototype._updateTargetTouches=function(a){if(!d.SupportsTouches)return void(a.type===d.Events.TouchEnd?this._targetTouches=[]:this._targetTouches=[a]);if(a instanceof TouchEvent)if(a.type!==d.Events.TouchStart)if(a.type!==d.Events.TouchMove){for(var b=a.touches,c=[],e=0,f=b.length;f>e;++e)c.push(b[e].identifier);this._targetTouches=this._targetTouches.filter(function(a){return-1!==c.indexOf(a.identifier)})}else{var g=this._targetTouches.map(function(a){return a.identifier});this._targetTouches=[];for(var h=a.touches,e=0,f=h.length;f>e;++e){var i=h[e];-1!==g.indexOf(i.identifier)&&this._targetTouches.push(i)}}else{this._targetTouches=[];for(var h=a.targetTouches,e=0,f=h.length;f>e;++e)this._targetTouches.push(h[e])}},d.prototype._updateKeyboardModifiers=function(a){this.modifierKeys.alt=a.altKey,this.modifierKeys.ctrl=a.ctrlKey,this.modifierKeys.meta=a.metaKey,this.modifierKeys.shift=a.shiftKey},b.exports=d},{"dom-events":21,"geometry/point":23,"web-point-converter":24}],14:[function(a,b,c){function d(){this.allowableMovement=10,this.minimumPressDuration=500,this.numberOfTouchesRequired=1,this.allowsRightMouseButton=!1,e.call(this)}var e=a("./gesture-recognizer");d.prototype=Object.create(e.prototype),d.constructor=d,d.prototype.touchesBegan=function(a){if(a.currentTarget===this.target&&(2!==a.button||this.allowsRightMouseButton)){if(e.prototype.touchesBegan.call(this,a),this.numberOfTouches!==this.numberOfTouchesRequired)return void this.enterFailedState();this._startPoint=this.locationInElement(),this._timerId=window.setTimeout(this.enterRecognizedState.bind(this),this.minimumPressDuration)}},d.prototype.touchesMoved=function(a){a.preventDefault(),this._startPoint.distanceToPoint(this.locationInElement())>this.allowableMovement&&this.enterFailedState()},d.prototype.touchesEnded=function(a){return this.state!==e.States.Recognized?void this.enterFailedState():(a.preventDefault(),void(this.numberOfTouches!==this.numberOfTouchesRequired&&this.enterFailedState()))},d.prototype.reset=function(){window.clearTimeout(this._timerId),delete this._timerId},b.exports=d},{"./gesture-recognizer":13}],15:[function(a,b,c){function d(){g.call(this)}function e(){return{start:new h,end:new h,dt:0}}function f(a){return a.dt<1?new h:new h((a.end.x-a.start.x)/a.dt*1e3,(a.end.y-a.start.y)/a.dt*1e3)}var g=a("./gesture-recognizer"),h=a("geometry/point"),i=100,j=8,k=.75;d.prototype=Object.create(g.prototype,{velocity:{get:function(){if(Date.now()-this._lastTouchTime>i)return new h;var a=f(this._velocitySample);if(g.SupportsTouches&&this._previousVelocitySample.dt>0){var b=f(this._previousVelocitySample);a.x=(1-k)*a.x+k*b.x,a.y=(1-k)*a.y+k*b.y}return a}}}),d.prototype.constructor=d,d.prototype.minimumNumberOfTouches=1,d.prototype.maximumNumberOfTouches=1e5,d.prototype.translationThreshold=10,d.prototype.touchesBegan=function(a){if(a.currentTarget===this.target&&!(a instanceof MouseEvent&&0!==a.button)){if(g.prototype.touchesBegan.call(this,a),!this._numberOfTouchesIsAllowed())return void this.enterFailedState();this._lastTouchTime=Date.now(),this._resetTrackedLocations(),1===this.numberOfTouches&&(this._travelledMinimumDistance=!1)}},d.prototype.touchesMoved=function(a){a.preventDefault();var b=Date.now(),c=this.locationInElement(),d=b-this._lastTouchTime;d>j&&(this._previousVelocitySample.start=this._velocitySample.start.copy(),this._previousVelocitySample.end=this._velocitySample.end.copy(),this._previousVelocitySample.dt=this._velocitySample.dt,this._velocitySample.start=this._lastTouchLocation.copy(),this._velocitySample.end=c,this._velocitySample.dt=d),this._travelledMinimumDistance?(this.translation.x+=c.x-this._lastTouchLocation.x,this.translation.y+=c.y-this._lastTouchLocation.y,this.enterChangedState()):this._canBeginWithTravelledDistance(new h(c.x-this._translationOrigin.x,c.y-this._translationOrigin.y))&&(this._travelledMinimumDistance=!0,this.enterBeganState()),this._lastTouchTime=b,this._lastTouchLocation=c},d.prototype.touchesEnded=function(a){return this._numberOfTouchesIsAllowed()?void this._resetTrackedLocations():void(this._travelledMinimumDistance?this.enterEndedState():this.enterFailedState())},d.prototype.reset=function(){this._velocitySample=e(),this._previousVelocitySample=e(),this._gestures=[],this.translation=new h,delete this._travelledMinimumDistance},d.prototype._travelledMinimumDistance=!1,d.prototype._previousVelocitySample=e(),d.prototype._velocitySample=e(),d.prototype._canBeginWithTravelledDistance=function(a){return Math.abs(a.x)>=this.translationThreshold||Math.abs(a.y)>=this.translationThreshold},d.prototype._numberOfTouchesIsAllowed=function(){return this.numberOfTouches>=this.minimumNumberOfTouches&&this.numberOfTouches<=this.maximumNumberOfTouches},d.prototype._resetTrackedLocations=function(){var a=this.locationInElement();this._lastTouchLocation=a,this._translationOrigin=a},b.exports=d},{"./gesture-recognizer":13,"geometry/point":23}],16:[function(a,b,c){function d(){e.call(this)}var e=a("./gesture-recognizer"),f=a("geometry/point"),g=100,h=500,i=!!window.GestureEvent;d.prototype=Object.create(e.prototype,{velocity:{get:function(){var a=this._gestures[this._gestures.length-1];if(!a)return this._velocity;var b=Date.now()-(a.timeStamp+g);if(0>=b)return this._velocity;var c=Math.max((h-b)/h,0);return this._velocity*c}}}),d.constructor=d,d.prototype.scaleThreshold=0,d.prototype.touchesBegan=function(a){if(a.currentTarget===this.target){if(i){if(2!==this.numberOfTouches)return}else{if(this.numberOfTouches>2)return void this.enterFailedState();if(2!==this.numberOfTouches)return;this._startDistance=this._distance(),this._recordGesture(1),this._scaledMinimumAmount=!1,this._updateStateWithEvent(a)}e.prototype.touchesBegan.call(this,a)}},d.prototype.touchesMoved=function(a){i||2===this.numberOfTouches&&this._updateStateWithEvent(a)},d.prototype.touchesEnded=function(a){i||this.numberOfTouches>=2||!this._startDistance||(this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState())},d.prototype.gestureBegan=function(a){e.prototype.gestureBegan.call(this,a),this._recordGesture(a.scale),this._scaledMinimumAmount=!1,this._updateStateWithEvent(a)},d.prototype.gestureChanged=function(a){a.preventDefault(),this._updateStateWithEvent(a)},d.prototype.gestureEnded=function(a){this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState()},d.prototype.reset=function(){this.scale=1,this._velocity=0,this._gestures=[],delete this._startDistance},d.prototype._scaledMinimumAmount=!1,d.prototype._recordGesture=function(a){var b=Date.now(),c=this._gestures.push({scale:a,timeStamp:b});if(!(2>=c)){for(var d=this._gestures[c-1].scale>=this._gestures[c-2].scale,e=c-3;e>=0;--e){var f=this._gestures[e];if(b-f.timeStamp>g||this._gestures[e+1].scale>=f.scale!==d)break}e>0&&(this._gestures=this._gestures.slice(e+1))}},d.prototype._updateStateWithEvent=function(a){var b=i?a.scale:this._distance()/this._startDistance;if(!this._scaledMinimumAmount)return void(Math.abs(1-b)>=this.scaleThreshold&&(this._scaledMinimumAmount=!0,this.scale=1,this.enterBeganState()));this._recordGesture(b);var c=this._gestures[0],d=b-c.scale,e=Date.now()-c.timeStamp;this._velocity=0===e?0:d/e*1e3,this.scale*=b/this._gestures[this._gestures.length-2].scale,this.enterChangedState()},d.prototype._distance=function(){console.assert(2===this.numberOfTouches);var a=this._targetTouches[0],b=new f(a.pageX,a.pageY),c=this._targetTouches[1],d=new f(c.pageX,c.pageY);return b.distanceToPoint(d)},b.exports=d},{"./gesture-recognizer":13,"geometry/point":23}],17:[function(a,b,c){function d(){e.call(this)}var e=a("./gesture-recognizer"),f=100,g=500;d.prototype=Object.create(e.prototype,{velocity:{get:function(){var a=this._gestures[this._gestures.length-1];if(!a)return this._velocity;var b=Date.now()-(a.timeStamp+f);if(0>=b)return this._velocity;var c=Math.max((g-b)/g,0);return this._velocity*c}}}),d.constructor=d,d.prototype.touchesBegan=function(a){a.currentTarget===this.target&&2===this.numberOfTouches&&e.prototype.touchesBegan.call(this,a)},d.prototype.gestureBegan=function(a){e.prototype.gestureBegan.call(this,a),this._recordGesture(a),this.rotation=a.rotation,this.enterBeganState()},d.prototype.gestureChanged=function(a){a.preventDefault(),this.enterChangedState(),this._recordGesture(a);var b=this._gestures[0],c=a.rotation-b.rotation,d=Date.now()-b.timeStamp;this._velocity=c/d*1e3,this.rotation+=a.rotation-this._gestures[this._gestures.length-2].rotation},d.prototype.gestureEnded=function(a){this.enterEndedState()},d.prototype.reset=function(){this.rotation=0,this._velocity=0,this._gestures=[]},d.prototype._recordGesture=function(a){var b=Date.now(),c=this._gestures.push({rotation:a.rotation,timeStamp:b});if(!(2>=c)){for(var d=this._gestures[c-1].rotation>=this._gestures[c-2].rotation,e=c-3;e>=0;--e){var g=this._gestures[e];if(b-g.timeStamp>f||this._gestures[e+1].rotation>=g.rotation!==d)break}e>0&&(this._gestures=this._gestures.slice(e+1))}},b.exports=d},{"./gesture-recognizer":13}],18:[function(a,b,c){function d(){this.numberOfTouchesRequired=1,this.direction=d.Directions.Right,e.call(this)}var e=a("./gesture-recognizer"),f=a("geometry/point"),g=100;d.Directions={Right:1,Left:2,Up:4,Down:8},d.prototype=Object.create(e.prototype),d.constructor=d,d.prototype.touchesBegan=function(a){a.currentTarget===this.target&&(this.numberOfTouchesRequired===this.numberOfTouches?(e.prototype.touchesBegan.call(this,a),this._translationOrigin=this.locationInElement()):this.enterFailedState())},d.prototype.touchesMoved=function(a){if(this.numberOfTouchesRequired!==this.numberOfTouches)return void this.enterFailedState();a.preventDefault();var b=this.locationInElement(),c=new f(b.x-this._translationOrigin.x,b.y-this._translationOrigin.y);this.state!==e.States.Recognized&&this.direction===d.Directions.Right&&c.x>g&&Math.abs(c.x)>Math.abs(c.y)&&this.enterRecognizedState(),this.state!==e.States.Recognized&&this.direction===d.Directions.Left&&c.x<-g&&Math.abs(c.x)>Math.abs(c.y)&&this.enterRecognizedState(),this.state!==e.States.Recognized&&this.direction===d.Directions.Up&&c.y<-g&&Math.abs(c.y)>Math.abs(c.x)&&this.enterRecognizedState(),this.state!==e.States.Recognized&&this.direction===d.Directions.Down&&c.y>g&&Math.abs(c.y)>Math.abs(c.x)&&this.enterRecognizedState()},d.prototype.touchesEnded=function(a){this.enterFailedState()},b.exports=d},{"./gesture-recognizer":13,"geometry/point":23}],19:[function(a,b,c){function d(){this.numberOfTapsRequired=1,this.numberOfTouchesRequired=1,this.allowsRightMouseButton=!1,e.call(this)}var e=a("./gesture-recognizer"),f=a("web-point-converter"),g=a("geometry/point"),h=e.SupportsTouches?40:0,i=350,j=750;d.prototype=Object.create(e.prototype),d.constructor=d,d.prototype.touchesBegan=function(a){if(a.currentTarget===this.target&&(2!==a.button||this.allowsRightMouseButton)){if(e.prototype.touchesBegan.call(this,a),this.numberOfTouches!==this.numberOfTouchesRequired)return void this.enterFailedState();this._startPoint=e.prototype.locationInElement.call(this),this._startClientPoint=e.prototype.locationInClient.call(this),this._rewindTimer(j)}},d.prototype.touchesMoved=function(a){a.preventDefault(),this._startPoint.distanceToPoint(e.prototype.locationInElement.call(this))>h&&this.enterFailedState()},d.prototype.touchesEnded=function(a){this._taps++,this._taps===this.numberOfTapsRequired&&(a.preventDefault(),this.enterRecognizedState(),this.reset()),this._rewindTimer(i)},d.prototype.reset=function(){this._taps=0,this._clearTimer()},d.prototype.locationInElement=function(a){var b=this._startPoint||new g;return a?f.fromPageToElement(a,b):b},d.prototype.locationInClient=function(){return this._startClientPoint||new g},d.prototype._clearTimer=function(){window.clearTimeout(this._timerId),delete this._timerId},d.prototype._rewindTimer=function(a){this._clearTimer(),this._timerId=window.setTimeout(this._timerFired.bind(this),a)},d.prototype._timerFired=function(){this.enterFailedState()},b.exports=d},{"./gesture-recognizer":13,"geometry/point":23,"web-point-converter":24}],20:[function(a,b,c){function d(a){this.element="string"==typeof a?document.getElementById(a):a,this.scale=1,this.rotation=this.x=this.y=this.z=0,this.transform={}}b.exports=d;a("./gesture-recognizer");d.prototype={constructor:d,set transform(a){this._x=this._getDefined(a.x,this._x,this.x),this._y=this._getDefined(a.y,this._y,this.y),this._z=this._getDefined(a.z,this._z,this.z),this._scale=this._getDefined(a.scale,this._scale,this.scale),this._rotation=this._getDefined(a.rotation,this._rotation,this.rotation),this.element.style.webkitTransform="translate3d("+this._x+"px, "+this._y+"px, "+this._z+") scale("+this._scale+") rotate("+this._rotation+"deg)"},addGestureRecognizer:function(a){a.target=this.element,a.view=this},_getDefined:function(){for(var a=0;a<arguments.length;a++)if("undefined"!=typeof arguments[a])return arguments[a];return arguments[arguments.length-1]}}},{"./gesture-recognizer":13}],21:[function(a,b,c){arguments[4][5][0].apply(c,arguments)},{dup:5,logger:22}],22:[function(a,b,c){arguments[4][6][0].apply(c,arguments)},{dup:6}],23:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],24:[function(a,b,c){function d(a){for(var b,c=a.getBoundingClientRect(),d=a.offsetWidth,g=a.offsetHeight,h=[new f(0,0),new f(d,0),new f(d,g),new f(0,g)],i=new e,j=a.ownerDocument.defaultView;a.nodeType===Node.ELEMENT_NODE;)b=j.getComputedStyle(a),i=new e(b.transform||b.MozTransform||b.msTransform||b.WebkitTransform).multiply(i),a=a.parentNode;var k=1/0,l=1/0;h.forEach(function(a){var b=i.transformPoint(a);k=Math.min(k,b.x),l=Math.min(l,b.y)});var m=window.pageXOffset+c.left-k,n=window.pageYOffset+c.top-l;return(new e).translate(m,n).multiply(i)}var e=a("css-matrix"),f=a("geometry/point");b.exports={fromPageToElement:function(a,b){if(window.webkitConvertPointFromPageToNode){var c=window.webkitConvertPointFromPageToNode(a,new WebKitPoint(b.x,b.y));return new f(c.x,c.y)}return d(a).inverse().transformPoint(b)},fromElementToPage:function(a,b){if(window.webkitConvertPointFromNodeToPage){var c=window.webkitConvertPointFromNodeToPage(a,new WebKitPoint(b.x,b.y));return new f(c.x,c.y)}return d(a).transformPoint(b)}}},{"css-matrix":25,"geometry/point":27}],25:[function(a,b,c){function d(){if(this._=e(),6===arguments.length)this._setValues(["a","b","c","d","e","f"],arguments);else if(16===arguments.length)this._setValues(["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"],arguments);else if(1==arguments.length){var a=arguments[0];if("string"==typeof a){if("none"===a)return;a=a.match(/\bmatrix(?:3d)?\(([^)]+)\)/)[1].split(",").map(parseFloat)}6===a.length?this._setValues(["a","b","c","d","e","f"],a):16===a.length&&this._setValues(["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"],a)}}function e(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];
}function f(a){return a/180*Math.PI}function g(a,b,c,d){return a*d-b*c}function h(a,b,c,d,e,f,h,i,j){return a*g(e,f,i,j)-d*g(b,c,i,j)+h*g(b,c,e,f)}function i(a,b){j(a,b);var c=a._determinant();if(Math.abs(c)<l)return!1;for(var d=0;4>d;d++)for(var e=0;4>e;e++)b._[d][e]=b._[d][e]/c;return!0}function j(a,b){var c=a._[0][0],d=a._[0][1],e=a._[0][2],f=a._[0][3],g=a._[1][0],i=a._[1][1],j=a._[1][2],k=a._[1][3],l=a._[2][0],m=a._[2][1],n=a._[2][2],o=a._[2][3],p=a._[3][0],q=a._[3][1],r=a._[3][2],s=a._[3][3];b._[0][0]=h(i,m,q,j,n,r,k,o,s),b._[1][0]=-h(g,l,p,j,n,r,k,o,s),b._[2][0]=h(g,l,p,i,m,q,k,o,s),b._[3][0]=-h(g,l,p,i,m,q,j,n,r),b._[0][1]=-h(d,m,q,e,n,r,f,o,s),b._[1][1]=h(c,l,p,e,n,r,f,o,s),b._[2][1]=-h(c,l,p,d,m,q,f,o,s),b._[3][1]=h(c,l,p,d,m,q,e,n,r),b._[0][2]=h(d,i,q,e,j,r,f,k,s),b._[1][2]=-h(c,g,p,e,j,r,f,k,s),b._[2][2]=h(c,g,p,d,i,q,f,k,s),b._[3][2]=-h(c,g,p,d,i,q,e,j,r),b._[0][3]=-h(d,i,m,e,j,n,f,k,o),b._[1][3]=h(c,g,l,e,j,n,f,k,o),b._[2][3]=-h(c,g,l,d,i,m,f,k,o),b._[3][3]=h(c,g,l,d,i,m,e,j,n)}var k=a("geometry/point"),l=1e-8;d.prototype={constructor:d,get a(){return this._[0][0]},get b(){return this._[0][1]},get c(){return this._[1][0]},get d(){return this._[1][1]},get e(){return this._[3][0]},get f(){return this._[3][1]},get m11(){return this._[0][0]},get m12(){return this._[0][1]},get m13(){return this._[0][2]},get m14(){return this._[0][3]},get m21(){return this._[1][0]},get m22(){return this._[1][1]},get m23(){return this._[1][2]},get m24(){return this._[1][3]},get m31(){return this._[2][0]},get m32(){return this._[2][1]},get m33(){return this._[2][2]},get m34(){return this._[2][3]},get m41(){return this._[3][0]},get m42(){return this._[3][1]},get m43(){return this._[3][2]},get m44(){return this._[3][3]},set a(a){this._[0][0]=a},set b(a){this._[0][1]=a},set c(a){this._[1][0]=a},set d(a){this._[1][1]=a},set e(a){this._[3][0]=a},set f(a){this._[3][1]=a},set m11(a){this._[0][0]=a},set m12(a){this._[0][1]=a},set m13(a){this._[0][2]=a},set m14(a){this._[0][3]=a},set m21(a){this._[1][0]=a},set m22(a){this._[1][1]=a},set m23(a){this._[1][2]=a},set m24(a){this._[1][3]=a},set m31(a){this._[2][0]=a},set m32(a){this._[2][1]=a},set m33(a){this._[2][2]=a},set m34(a){this._[2][3]=a},set m41(a){this._[3][0]=a},set m42(a){this._[3][1]=a},set m43(a){this._[3][2]=a},set m44(a){this._[3][3]=a},translate:function(a,b,c){return a=a||0,b=b||0,c=c||0,this._[3][0]+=a*this._[0][0]+b*this._[1][0]+c*this._[2][0],this._[3][1]+=a*this._[0][1]+b*this._[1][1]+c*this._[2][1],this._[3][2]+=a*this._[0][2]+b*this._[1][2]+c*this._[2][2],this._[3][3]+=a*this._[0][3]+b*this._[1][3]+c*this._[2][3],this},scale:function(a,b,c){return a=a||1,b=b||a,c=c||1,this._[0][0]*=a,this._[0][1]*=a,this._[0][2]*=a,this._[0][3]*=a,this._[1][0]*=b,this._[1][1]*=b,this._[1][2]*=b,this._[1][3]*=b,this._[2][0]*=c,this._[2][1]*=c,this._[2][2]*=c,this._[2][3]*=c,this},rotate:function(a){return this.rotateAxisAngle(0,0,1,a)},rotateAxisAngle:function(a,b,c,e){0===a&&0===b&&0===c&&(c=1);var g=Math.sqrt(a*a+b*b+c*c);1!=g&&(a/=g,b/=g,c/=g),e=f(e);var h=Math.sin(e),i=Math.cos(e),j=new d;if(1===a&&0===b&&0===c)j._[0][0]=1,j._[0][1]=0,j._[0][2]=0,j._[1][0]=0,j._[1][1]=i,j._[1][2]=h,j._[2][0]=0,j._[2][1]=-h,j._[2][2]=i,j._[0][3]=j._[1][3]=j._[2][3]=0,j._[3][0]=j._[3][1]=j._[3][2]=0,j._[3][3]=1;else if(0===a&&1===b&&0===c)j._[0][0]=i,j._[0][1]=0,j._[0][2]=-h,j._[1][0]=0,j._[1][1]=1,j._[1][2]=0,j._[2][0]=h,j._[2][1]=0,j._[2][2]=i,j._[0][3]=j._[1][3]=j._[2][3]=0,j._[3][0]=j._[3][1]=j._[3][2]=0,j._[3][3]=1;else if(0===a&&0===b&&1===c)j._[0][0]=i,j._[0][1]=h,j._[0][2]=0,j._[1][0]=-h,j._[1][1]=i,j._[1][2]=0,j._[2][0]=0,j._[2][1]=0,j._[2][2]=1,j._[0][3]=j._[1][3]=j._[2][3]=0,j._[3][0]=j._[3][1]=j._[3][2]=0,j._[3][3]=1;else{var k=1-i;j._[0][0]=i+a*a*k,j._[0][1]=b*a*k+c*h,j._[0][2]=c*a*k-b*h,j._[1][0]=a*b*k-c*h,j._[1][1]=i+b*b*k,j._[1][2]=c*b*k+a*h,j._[2][0]=a*c*k+b*h,j._[2][1]=b*c*k-a*h,j._[2][2]=i+c*c*k,j._[0][3]=j._[1][3]=j._[2][3]=0,j._[3][0]=j._[3][1]=j._[3][2]=0,j._[3][3]=1}return this.multiply(j)},multiply:function(a){var b=e();return b[0][0]=a._[0][0]*this._[0][0]+a._[0][1]*this._[1][0]+a._[0][2]*this._[2][0]+a._[0][3]*this._[3][0],b[0][1]=a._[0][0]*this._[0][1]+a._[0][1]*this._[1][1]+a._[0][2]*this._[2][1]+a._[0][3]*this._[3][1],b[0][2]=a._[0][0]*this._[0][2]+a._[0][1]*this._[1][2]+a._[0][2]*this._[2][2]+a._[0][3]*this._[3][2],b[0][3]=a._[0][0]*this._[0][3]+a._[0][1]*this._[1][3]+a._[0][2]*this._[2][3]+a._[0][3]*this._[3][3],b[1][0]=a._[1][0]*this._[0][0]+a._[1][1]*this._[1][0]+a._[1][2]*this._[2][0]+a._[1][3]*this._[3][0],b[1][1]=a._[1][0]*this._[0][1]+a._[1][1]*this._[1][1]+a._[1][2]*this._[2][1]+a._[1][3]*this._[3][1],b[1][2]=a._[1][0]*this._[0][2]+a._[1][1]*this._[1][2]+a._[1][2]*this._[2][2]+a._[1][3]*this._[3][2],b[1][3]=a._[1][0]*this._[0][3]+a._[1][1]*this._[1][3]+a._[1][2]*this._[2][3]+a._[1][3]*this._[3][3],b[2][0]=a._[2][0]*this._[0][0]+a._[2][1]*this._[1][0]+a._[2][2]*this._[2][0]+a._[2][3]*this._[3][0],b[2][1]=a._[2][0]*this._[0][1]+a._[2][1]*this._[1][1]+a._[2][2]*this._[2][1]+a._[2][3]*this._[3][1],b[2][2]=a._[2][0]*this._[0][2]+a._[2][1]*this._[1][2]+a._[2][2]*this._[2][2]+a._[2][3]*this._[3][2],b[2][3]=a._[2][0]*this._[0][3]+a._[2][1]*this._[1][3]+a._[2][2]*this._[2][3]+a._[2][3]*this._[3][3],b[3][0]=a._[3][0]*this._[0][0]+a._[3][1]*this._[1][0]+a._[3][2]*this._[2][0]+a._[3][3]*this._[3][0],b[3][1]=a._[3][0]*this._[0][1]+a._[3][1]*this._[1][1]+a._[3][2]*this._[2][1]+a._[3][3]*this._[3][1],b[3][2]=a._[3][0]*this._[0][2]+a._[3][1]*this._[1][2]+a._[3][2]*this._[2][2]+a._[3][3]*this._[3][2],b[3][3]=a._[3][0]*this._[0][3]+a._[3][1]*this._[1][3]+a._[3][2]*this._[2][3]+a._[3][3]*this._[3][3],this._=b,this},skewX:function(a){return this._skew(a,0)},skewY:function(a){return this._skew(0,a)},isAffine:function(){return 0==this._[0][2]&&0==this._[0][3]&&0==this._[1][2]&&0==this._[1][3]&&0==this._[2][0]&&0==this._[2][1]&&1==this._[2][2]&&0==this._[2][3]&&0==this._[3][2]&&1==this._[3][3]},inverse:function(){if(this._isIdentityOrTranslation())return 0==this._[3][0]&&0==this._[3][1]&&0==this._[3][2]?this:(this._[3][0]*=-1,this._[3][1]*=-1,this._[3][2]*=-1,this);var a=new d,b=i(this,a);return b?a:new d},transformPoint:function(a){return new k(this._[0][0]*a.x+this._[1][0]*a.y+this._[2][0]*a.z+this._[3][0],this._[0][1]*a.x+this._[1][1]*a.y+this._[2][1]*a.z+this._[3][1],this._[0][2]*a.x+this._[1][2]*a.y+this._[2][2]*a.z+this._[3][2])},toString:function(){return this.isAffine()?"matrix("+[this._[0][0],this._[0][1],this._[1][0],this._[1][1],this._[3][0],this._[3][1]].join(", ")+")":"matrix3d("+this._.map(function(a){return a.join(", ")}).join(", ")+")"},_setValues:function(a,b){a.forEach(function(a,c){this[a]=b[c]},this)},_isIdentityOrTranslation:function(){return 1==this._[0][0]&&0==this._[0][1]&&0==this._[0][2]&&0==this._[0][3]&&0==this._[1][0]&&1==this._[1][1]&&0==this._[1][2]&&0==this._[1][3]&&0==this._[2][0]&&0==this._[2][1]&&1==this._[2][2]&&0==this._[2][3]&&1==this._[3][3]},_skew:function(a,b){var c=new d;return c._[0][1]=Math.tan(f(b)),c._[1][0]=Math.tan(f(a)),this.multiply(c)},_determinant:function(){var a=this._[0][0],b=this._[0][1],c=this._[0][2],d=this._[0][3],e=this._[1][0],f=this._[1][1],g=this._[1][2],i=this._[1][3],j=this._[2][0],k=this._[2][1],l=this._[2][2],m=this._[2][3],n=this._[3][0],o=this._[3][1],p=this._[3][2],q=this._[3][3];return a*h(f,k,o,g,l,p,i,m,q)-b*h(e,j,n,g,l,p,i,m,q)+c*h(e,j,n,f,k,o,i,m,q)-d*h(e,j,n,f,k,o,g,l,p)}},b.exports=d},{"geometry/point":26}],26:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],27:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],28:[function(a,b,c){function d(a){a?r(a)?this.element=a:"string"==typeof a||a instanceof String?this.element=m(a):"object"==typeof a&&(this.element=n(a)):this.element=document.createElement("div"),this._parent=null,this._children=[],this._opacity=1,this._color="",this._size=new u,this._position=new v,this._transform=new w,this._backgroundImages=[],this._classList=new s(this),this._wantsHardwareCompositing=!1,this._dirtyProperties=[],this._dirtyAttributes={},this._deferredUpdates=[],this._pendingDOMManipulation=F.None}function e(a,b){b?p(B,a):q(B,a),f()}function f(){var a=B.length>0||C.length>0;a&&-1===A?A=x.request(g):a||-1===x||(x.cancel(A),A=-1)}function g(){A=-1,h(),B.forEach(i),B=[],E.forEach(j),E=[],d.updates++,I.dispatchEvent(new t.Event(G))}function h(){++I.frameId,D=C.map(function(a){return a._immediateUpdates=a._deferredUpdates.slice(),a._deferredUpdates=[],a._pastUpdates=[],a}),C=[];for(var a=0;a<D.length;++a){node=D[a];for(var b=0;b<node._immediateUpdates.length;++b){var c=node._immediateUpdates[b];node._pastUpdates.push(c),"function"==typeof c?c():"object"==typeof c&&"function"==typeof c.updateNode&&c.updateNode()}delete node._immediateUpdates}D.forEach(function(a){delete a._pastUpdates}),D=null}function i(a){if(a._pendingDOMManipulation===F.Removal){var b=a.element.parentNode;b&&b.removeChild(a.element)}a._dirtyProperties.forEach(function(b){k(a,b)}),a._dirtyProperties=[],Object.getOwnPropertyNames(a._dirtyAttributes).forEach(function(b){a.element.setAttribute(b,a._dirtyAttributes[b])}),a._dirtyAttributes={},a._pendingDOMManipulation===F.Addition&&p(E,a.parent)}function j(a){for(var b=null,c=a.element,d=a.children.length-1;d>=0;--d){var e=a.children[d],f=e.element;e._pendingDOMManipulation===F.Addition&&(c.insertBefore(f,b),e._pendingDOMManipulation=F.None),b=f}}function k(a,b){var c=a.element,d=c.style;switch(b){case"opacity":d.opacity=a._opacity;break;case"color":d.color=a._color;break;case"size":d.width=a._size.width+"px",d.height=a._size.height+"px";break;case"position":case"transform":var e=(new w).translate(o(a._position.x),o(a._position.y)).transform(a._transform);H&&a._wantsHardwareCompositing&&e.rotate3d(0,0,0,0),d.transform=d.webkitTransform=d.msTransform=e;break;case"backgroundImages":l(a);break;case"classList":c.className=a._classList,a._classList.reset();break;default:return}}function l(a){var b=a.element.style;if(!a._backgroundImages.length)return b.removeProperty("background-image"),b.removeProperty("background-position"),void b.removeProperty("background-size");for(var c=[],d=[],e=[],f=a._backgroundImages,g=f.length-1;g>=0;--g){var h=f[g];c.push("url("+h.url+")"),d.push(h.position.x+"px "+h.position.y+"px"),e.push(h.size.width+"px "+h.size.height+"px")}b.backgroundImage=c.join(","),b.backgroundPosition=d.join(","),b.backgroundSize=e.join(",")}function m(a){var b=document.createElement("div");return b.innerHTML=a,b.firstElementChild}function n(a){var b=a.name;if("#text"===b)return document.createTextNode(a.value);var c=document.createElement(b),d=a.attributes;for(var e in d)c.setAttribute(e,d[e]);return a.children instanceof Array&&a.children.forEach(function(a){c.appendChild(n(a))}),c}function o(a){var b=z();return Math.round(a*b)/b}function p(a,b){return-1!==a.indexOf(b)?!1:(a.push(b),!0)}function q(a,b){var c=a.indexOf(b);return-1===c?!1:(a.splice(c,1),!0)}function r(a){return a instanceof window.Node&&a.nodeType===window.Node.ELEMENT_NODE}function s(a){this._node=a,this.reset()}var t=a("dom-events"),u=a("geometry/size"),v=a("geometry/point"),w=a("css-transform"),x=a("request-animation-frame"),y=a("web-point-converter"),z=a("device-pixel-ratio"),A=-1,B=[],C=[],D=null,E=[],F={None:0,Removal:1,Addition:2},G="update",H=function(){var a=document.createElement("div");return a.style.msTransform="translate3d(2px, 2px, 2px)","none"!==window.getComputedStyle(a).msTransform}();d.updates=0,d.prototype={constructor:d,get classList(){return this._classList},get wantsHardwareCompositing(){return this._wantsHardwareCompositing},set wantsHardwareCompositing(a){a!==this._wantsHardwareCompositing&&(this._wantsHardwareCompositing=a,this._markDirtyProperty("transform"))},get opacity(){return this._opacity},set opacity(a){a=Math.min(Math.max(0,a),1),a!==this._opacity&&(this._opacity=a,this._markDirtyProperty("opacity"))},get color(){return this._color},set color(a){a!==this._color&&(this._color=a,this._markDirtyProperty("color"))},get position(){return this._position},set position(a){this._position=a,this._markDirtyProperty("position")},get transform(){return this._transform},set transform(a){this._transform=a,this._markDirtyProperty("transform")},get backgroundImages(){return this._backgroundImages},set backgroundImages(a){this._backgroundImages=a||[],this._markDirtyProperty("backgroundImages")},get size(){return this._size},set size(a){this._size=a||new u,this._markDirtyProperty("size")},setAttribute:function(a,b){this._dirtyAttributes[a]=b,this._updateNodeDirtiness()},get parent(){return this._parent},get children(){return this._children},set children(a){for(var b=this._children;b.length;)this.removeChild(b[0]);a.forEach(function(a){this.addChild(a)},this)},get childCount(){return this._children.length},get firstChild(){return this._children[0]||null},get lastChild(){return this._children[this._children.length-1]||null},get previousSibling(){if(!this._parent)return null;var a=this._parent._children,b=a.indexOf(this);return b>0?a[b-1]:null},get nextSibling(){if(!this._parent)return null;var a=this._parent._children,b=a.indexOf(this);return-1!==b&&b<a.length-1?a[b+1]:null},addChild:function(a,b){return a.willMoveToParent(this),a._doNotNotifyParentChange=!0,a.remove(),delete a._doNotNotifyParentChange,(void 0===b||0>b||b>this._children.length)&&(b=this._children.length),this._children.splice(b,0,a),a._parent=this,a.didMoveToParent(this),this.didAddChild(a),a._markNodeManipulation(F.Addition),a},insertBefore:function(a,b){return this.addChild(a,this._children.indexOf(b))},insertAfter:function(a,b){var c=this._children.indexOf(b);return this.addChild(a,-1!==c?c+1:0)},removeChild:function(a){if(a._parent===this){var b=this._children.indexOf(a);if(-1!==b)return this.willRemoveChild(a),a._doNotNotifyParentChange||a.willMoveToParent(null),this._children.splice(b,1),a._parent=null,a._doNotNotifyParentChange||a.didMoveToParent(null),a._markNodeManipulation(F.Removal),a}},remove:function(){return this._parent instanceof d?this._parent.removeChild(this):void 0},findNode:function(a,b){if("function"!=typeof a)throw new TypeError("RenderTree.RenderNode.findNode: callback must be a function");var c,d=this;return function e(f){return f!==d&&a.call(b,f)?void(c=f):void f.children.some(function(a){return e(a),c})}(d),c},scheduleUpdate:function(a){a&&(!D||this._pastUpdates&&this._pastUpdates.indexOf(a)>=0?(p(this._deferredUpdates,a),p(C,this),f()):this._immediateUpdates?p(this._immediateUpdates,a):(D.push(this),this._immediateUpdates=[a],this._pastUpdates||(this._pastUpdates=[])))},convertPointFromPage:function(a){return y.fromPageToElement(this.element,a)},convertPointToPage:function(a){return y.fromElementToPage(this.element,a)},willRemoveChild:function(a){},didAddChild:function(a){},willMoveToParent:function(a){},didMoveToParent:function(a){},_markDirtyProperty:function(a,b){var c;c=void 0===b||b?p(this._dirtyProperties,a):q(this._dirtyProperties,a),c&&this._updateNodeDirtiness()},_markNodeManipulation:function(a){this._pendingDOMManipulation=a,this._updateNodeDirtiness()},_updateNodeDirtiness:function(){e(this,this._pendingDOMManipulation!==F.None||this._dirtyProperties.length>0||Object.getOwnPropertyNames(this._dirtyAttributes).length>0)}},s.prototype={constructor:s,add:function(a){this._add(a)},remove:function(a){this._remove(a)},contains:function(a){return-1!==this._classes().indexOf(a)},toggle:function(a,b){return"boolean"==typeof b||b instanceof Boolean?(b?this._add(a):this._remove(a),b):void(this._add(a)||this._remove(a))},toString:function(){return this._classes().join(" ")},_classes:function(){return this._populateClasses&&(this.__classes=this._node.element.className.split(/[ ]+/).filter(Boolean),delete this._populateClasses),this.__classes},reset:function(){this._additions=[],this._removals=[],this.__classes=[],this._populateClasses=!0},_add:function(a){if(!a)return!1;var b=p(this._classes(),a);return b&&(q(this._removals,a)||p(this._additions,a),this._updateNodeDirtiness()),b},_remove:function(a){if(!a)return!1;var b=q(this._classes(),a);return b&&(q(this._additions,a)||p(this._removals,a),this._updateNodeDirtiness()),b},_updateNodeDirtiness:function(){this._node._markDirtyProperty("classList",this._additions.length>0||this._removals.length>0)}};var I=new t.EventTarget;I.frameId=0,I.Node=d,I.Point=v,I.Transform=w,b.exports=I},{"css-transform":29,"device-pixel-ratio":30,"dom-events":33,"geometry/point":35,"geometry/size":36,"request-animation-frame":37,"web-point-converter":38}],29:[function(a,b,c){arguments[4][3][0].apply(c,arguments)},{dup:3}],30:[function(a,b,c){arguments[4][4][0].apply(c,arguments)},{"dom-events":31,dup:4}],31:[function(a,b,c){arguments[4][5][0].apply(c,arguments)},{dup:5,logger:32}],32:[function(a,b,c){arguments[4][6][0].apply(c,arguments)},{dup:6}],33:[function(a,b,c){arguments[4][5][0].apply(c,arguments)},{dup:5,logger:34}],34:[function(a,b,c){arguments[4][6][0].apply(c,arguments)},{dup:6}],35:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],36:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{dup:11}],37:[function(a,b,c){function d(a){0===i.length&&window.setTimeout(f,j),i.push(a);var b=++h;return g[b]=a,b}function e(a){if(a in g){var b=g[a],c=i.indexOf(b);-1!==c&&(i.splice(c,1),delete g[a])}}function f(){if(0!==i.length){var a=i.concat();i=[],g={},a.forEach(function(a){a()})}}var g={},h=0,i=[],j=1e3/60;window.requestAnimationFrame?(b.exports.request=window.requestAnimationFrame.bind(window),b.exports.cancel=window.cancelAnimationFrame.bind(window)):window.webkitRequestAnimationFrame?(b.exports.request=window.webkitRequestAnimationFrame.bind(window),b.exports.cancel=window.webkitCancelAnimationFrame.bind(window)):(b.exports.request=d,b.exports.cancel=e)},{}],38:[function(a,b,c){arguments[4][24][0].apply(c,arguments)},{"css-matrix":39,dup:24,"geometry/point":41}],39:[function(a,b,c){arguments[4][25][0].apply(c,arguments)},{dup:25,"geometry/point":40}],40:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],41:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],42:[function(a,b,c){arguments[4][37][0].apply(c,arguments)},{dup:37}],43:[function(a,b,c){b.exports={version:"2.14.0",build:"16.04-10",cdnUrl:"//cdn.apple-mapkit.com/mk/2.14.0"}},{}],44:[function(a,b,c){function d(){f.addEventListener(f.Events.Changed,this),f.addEventListener(f.Events.Error,this)}function e(){for(var a=[9*Math.random()+1|0],b=19+Math.round(Math.random()),c=1;b>c;c++)a[c]=10*Math.random()|0;return parseInt(a.join(""),10)}var f=a("../configuration"),g=a("../requests/xhr-loader"),h=a("../requests/request-manager").Priority,i=a("../../build.json"),j={MAP_ZOOM_IN:"USER_ACTION_USAGE",MAP_ZOOM_OUT:"USER_ACTION_USAGE",MAP_PAN:"USER_ACTION_USAGE",MAP_OPTIONS_STANDARD:"USER_ACTION_USAGE",MAP_OPTIONS_HYBRID:"USER_ACTION_USAGE",MAP_OPTIONS_SATELLITE:"USER_ACTION_USAGE"},k="reportStats",l="reportAnalytics",m=9e5;d.prototype={_queuedStats:[],_loader:null,_statsUrl:null,_analyticsUrl:null,_sessionId:null,_sessionTimerStart:null,_sessionTimeToExpire:null,_sequenceNumber:null,log:function(a,b){f.analyticsEnabled&&((!this._sessionId||(new Date).getTime()>this._sessionTimeToExpire)&&this._initSession(),this._queuedStats.push(this._createStat(a,b)),this._sequenceNumber++,this._loader||(console.assert(this._statsUrl,"analytics._statsUrl is not set"),this._loader=new g(this._statsUrl,this,{method:"POST",priority:h.LOW,retry:!0}),this._loader.schedule()))},getDataToSend:function(a){var b=JSON.stringify({stats:this._queuedStats});return this._queuedStats=[],a.setRequestHeader("Content-Type","text/plain"),a.responseType="text",b},loaderDidSucceed:function(a){delete this._loader},loaderDidFail:function(a){this._queuedStats=this._queuedStats.concat(JSON.parse(a.xhrData).stats),delete this._loader},_createStat:function(a,b){var c=((new Date).getTime()-this._sessionTimerStart)/1e3,d={statName:a,buildId:i.build,log_message:{log_message_type:"SHORT_SESSION_USAGE",log_message_sub_type:j[a],usage_log_message:{short_session_usage_log_message:{relative_timestamp:c,sequence_number:this._sequenceNumber,session_id:this._sessionId,user_action_log_message:{usage_event_key:a}}}}};if(!b||!b.map)return d;var e=b.map,f=e.region.toBoundingRegion();return d.log_message.app_state={map_region:{eastLng:f.eastLongitude,northLat:f.northLatitude,southLat:f.southLatitude,westLng:f.westLongitude},zoom_level:e._zoomLevel},d},_initSession:function(){this._sessionId={high:e(),low:e()},this._sessionTimerStart=(new Date).getTime(),this._sessionTimeToExpire=this._sessionTimerStart+m,this._sequenceNumber=0},handleEvent:function(a){switch(a.type){case f.Events.Changed:this._configurationBecameAvailable()}},_configurationBecameAvailable:function(){this._statsUrl=f.analyticsBaseUrl+k,this._analyticsUrl=f.analyticsBaseUrl+l}},b.exports=new d},{"../../build.json":43,"../configuration":53,"../requests/request-manager":90,"../requests/xhr-loader":91}],45:[function(a,b,c){function d(a){this._map=a,this.panning=!1}var e=a("geometry/point"),f=1e3,g=4e3,h=1.5,i=3,j=5;d.prototype={constructor:d,update:function(a){if(this._map.scrollable){var b=a._node,c=b.position.x,d=c+b.size.width,f=b.position.y,g=f+b.size.height,h=this._map._ensureVisibleFrame();this._direction=new e,c<=h.minX()?this._direction.x=-1:d>=h.maxX()&&(this._direction.x=1),f<=h.minY()+j?this._direction.y=-1:g>=h.maxY()-j&&(this._direction.y=1);var i=0!==this._direction.x||0!==this._direction.y;!this.panning&&i?(this.panning=!0,this._startTime=Date.now(),this._initialSpeed=Math.floor(1/104.1*(h.size.width+h.size.height)/2),this._map._rootNode.scheduleUpdate(this)):this.panning&&!i&&this.stop()}},stop:function(){this.panning&&(this.panning=!1,delete this._direction,delete this._startTime,delete this._initialSpeed)},updateNode:function(){if(this.panning){console.assert(!!this._startTime&&!!this._initialSpeed);var a=this._initialSpeed,b=Date.now()-this._startTime;b>g?a*=i:b>f&&(a*=h),this._map._translateVisibleMapRectAnimated(new e(this._direction.x*a,this._direction.y*a),!1),this._map._rootNode.scheduleUpdate(this)}}},b.exports=d},{"geometry/point":9}],46:[function(a,b,c){function d(){}var e=a("../utils"),f=a("geometry/point"),g={HIDDEN:"mk-hidden",INVISIBLE:"mk-invisible"};d.CalloutTailSide={Left:"left",Right:"right",Bottom:"bottom"},d.prototype={_shown:!0,_visible:!0,_position:new f,_anchorPoint:new f,_anchorOffset:new DOMPoint,_appearanceAnimation:"",get node(){return this._node},get element(){return this._element},set element(a){console.warn("[MapKit] The `element` property is read-only.")},get anchorOffset(){return this._anchorOffset},set anchorOffset(a){e.checkInstance(a,DOMPoint,"[MapKit] Annotation.anchorOffset expected a DOMPoint, but got `"+a+"` instead."),this._anchorOffset=new DOMPoint(a.x,a.y),this._updatePosition()},get visible(){return this._visible},set visible(a){a=!!a,this._visible!==a&&(this._visible=a,this._updateVisibility())},get appearanceAnimation(){return this._appearanceAnimation},set appearanceAnimation(a){e.checkType(a,"string","[MapKit] Annotation.appearanceAnimation expected a string, but got `"+a+"` instead."),this._appearanceAnimation=a;var b=document.createElement("div");b.style.animation=b.style.webkitAnimation=a,this._appearanceAnimationName=b.style.animationName||b.style.webkitAnimationName},_setShown:function(a){a=!!a,this._shown!==a&&(this._shown=a,e.classList.toggle(this._node.element,g.HIDDEN))},_isShown:function(){return this._shown},_setSize:function(a,b){this._node.size=a,this._anchorPoint=b===d.CalloutTailSide.Left?new f(0,a.height/2):b===d.CalloutTailSide.Right?new f(a.width,a.height/2):new f(a.width/2,a.height),this._updatePosition()},_setPosition:function(a){this._position=new f(a.x,a.y),this._updatePosition()},_updatePosition:function(){this._node.position=new f(this._position.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y)},_updateVisibility:function(){(this._visible||!this._animating)&&(e.classList.toggle(this._node.element,g.INVISIBLE),this._internalDelegate&&this._internalDelegate.annotationPropertyDidChange(this,"visible"))}},b.exports=d},{"../utils":101,"geometry/point":9}],47:[function(a,b,c){function d(a,b,c){e.call(this),j.EventTarget(this),i.checkType(b,"function"),c&&i.checkType(c,"object"),this.coordinate=a;var d=b(a,c);i.checkElement(d,"[MapKit] Annotation element factory must return a DOM element, got `"+d+"` instead."),this._element=d,this._node=new k.Node(i.htmlElement("div",d)),this._node.wantsHardwareCompositing=!0,this._node.element._annotation=this,this._unsized=!0,c&&(m.forEach(function(a){a in c&&(this[a]=c[a])},this),Object.keys(c).forEach(function(a){"map"===a||"element"===a?console.warn("[MapKit] `"+a+"` is read-only and can't be set on an Annotation."):this._isAKnownOption(a)||console.warn("[MapKit] Unknown option for annotation: "+a+" (use the `data` property instead)")},this)),l.addEventListener(l.Events.LocaleChanged,this),this._updateLocalizedText()}var e=a("./annotation-layer-item"),f=a("../types").Coordinate,g=a("geometry/size"),h=a("geometry/point"),i=a("../utils"),j=a("dom-events"),k=a("render-tree"),l=a("../localizer"),m=["title","subtitle","data","accessibilityLabel","anchorOffset","calloutOffset","size","visible","enabled","selected","calloutEnabled","animates","callout","appearanceAnimation","draggable"];d.EVENTS={SELECT:"select",DESELECT:"deselect",DRAG_START:"drag-start",DRAG_END:"drag-end"},d.prototype=i.inheritPrototype(e,d,{_internalDelegate:null,_calloutOffset:new DOMPoint(0,1),_enabled:!0,_selected:!1,_calloutEnabled:!0,_animates:!0,_draggable:!1,_title:"",_subtitle:"",_accessibilityLabel:null,_callout:null,get map(){return this._internalDelegate&&this._internalDelegate.mapForAnnotation(this)},set map(a){console.warn("[MapKit] The `map` property is read-only.")},get coordinate(){return this._coordinate},set coordinate(a){i.checkInstance(a,f,"[MapKit] Annotation.coordinate expected a Coordinate value."),this._coordinate=a.copy(),this._updatedProperty("coordinate")},get title(){return this._title},set title(a){null!=a?(i.checkType(a,"string","[MapKit] Expected a string value for Annotation.title, but got `"+a+"` instead"),this._title=a):delete this._title,this._updateLocalizedText(),this._updatedProperty("title")},get subtitle(){return this._subtitle},set subtitle(a){null!=a?(i.checkType(a,"string","[MapKit] Expected a string value for Annotation.subtitle, but got `"+a+"` instead"),this._subtitle=a):delete this._subtitle,this._updateLocalizedText(),this._updatedProperty("subtitle")},get accessibilityLabel(){return this._accessibilityLabel},set accessibilityLabel(a){null!=a?(i.checkType(a,"string","[MapKit] Expected a string value for Annotation.accessibilityLabel, but got `"+a+"` instead"),this._accessibilityLabel=a):delete this._accessibilityLabel,this._updateLocalizedText()},get data(){return this.hasOwnProperty("_data")||(this._data={}),this._data},set data(a){this._data=a},get enabled(){return this._enabled},set enabled(a){this._enabled=!!a},get calloutEnabled(){return this._calloutEnabled},set calloutEnabled(a){this._calloutEnabled=!!a},get selected(){return this._selected},set selected(a){var b=!!a;b!==this._selected&&(this._selected=b,this.updateElement(),this.dispatchEvent(new j.Event(this._selected?d.EVENTS.SELECT:d.EVENTS.DESELECT)),this._updatedProperty("selected"))},get animates(){return this._animates},set animates(a){this._animates=!!a},get calloutOffset(){return this._calloutOffset},set calloutOffset(a){i.checkInstance(a,DOMPoint,"[MapKit] Annotation.calloutOffset expected a DOMPoint, but got `"+a+"` instead."),this._calloutOffset=new DOMPoint(a.x,a.y),this._updatedProperty("calloutOffset")},get callout(){return this._callout},set callout(a){i.checkType(a,"object","[MapKit] Annotation.callout expected an object, but got `"+a+"` instead."),this._callout=a},get draggable(){return this._draggable},set draggable(a){var b=!!a;b!==this._draggable&&(this._draggable=b,this._updatedProperty("draggable"))},get size(){return this._unsized?void 0:this._node.size.copy()},set size(a){var b="[MapKit] Annotation size expects a size object with width and height properties";i.checkType(a,"object",b).checkType(a.width,"number",b).checkType(a.height,"number",b),this._setSize(new g(a.width,a.height)),this._userSetSize=!0,this._updateSize()},_doesAnimate:function(){return this._animates&&!!this._appearanceAnimationName},willMoveToMap:function(){this._isMoving=this._doesAnimate(),this._userSetSize||(delete this._unsized,this._setSize(this._internalDelegate.sizeForElement(this.element)))},didMoveToMap:function(){this._isMoving&&this._appearanceAnimationName&&this._visible&&(this.element.style.animation=this.element.style.webkitAnimation=this._appearanceAnimation,(this.element.style.animationName||this.element.style.webkitAnimationName)&&(this._animating=!0,this.element.addEventListener("animationend",this),this.element.addEventListener("webkitAnimationEnd",this))),delete this._isMoving},handleEvent:function(a){switch(a.type){case l.Events.LocaleChanged:this._updateLocalizedText();break;case"animationend":case"webkitAnimationEnd":if(a.animationName!==this._appearanceAnimationName)return;this.element.style.animation=this.element.style.webkitAnimation="",this.element.removeEventListener("animationend",this),this.element.removeEventListener("webkitAnimationEnd",this),this._finishedAnimating()}},updateNode:function(){this._liftAnimationStartDate?this._animateLift():this._dropAfterLiftAnimationStartDate&&this._animateDropAfterLift()},updateElement:function(){},_updateSize:function(){delete this._unsized,this._selected&&this._internalDelegate&&this._internalDelegate.selectedAnnotationDidMoveToMap(this)},_updateLocalizedText:function(){this._element.setAttribute("aria-label",this._altText())},_altText:function(){return this._accessibilityLabel||(this._title&&this._subtitle?l.get("Annotation.Generic.AccessibilityLabel",{title:this._title,subtitle:this._subtitle}):this._title||this._subtitle||"")},_draggingDidStart:function(){this.dispatchEvent(new j.Event(d.EVENTS.DRAG_START))},_isDraggable:function(){return this.draggable&&!this._liftAnimationStartDate&&!this._dropAfterLiftAnimationStartDate},_positionForCallout:function(){var a=this._calloutAnchorPoint;return a||(a=new DOMPoint(-this._node.size.width/2,0)),new h(this._node.position.x-a.x-this._calloutOffset.x,this._node.position.y-a.y-this._calloutOffset.y)},_liftDurationMs:200,_liftOpacity:.5,_lift:function(a){this._liftAmount=a,this._draggingTranslation=new h,this._liftAnimationStartDate=Date.now(),this._liftAnimationProgress=0,this.node.scheduleUpdate(this)},_animateLift:function(){var a=Math.min((Date.now()-this._liftAnimationStartDate)/this._liftDurationMs,1);this.node.position=new h(this._position.x+this._draggingTranslation.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y+this._draggingTranslation.y-this._anchorPoint.y-this._anchorOffset.y-this._liftAmount*a),this.node.opacity=1-(1-this._liftOpacity)*a,1>a?(this.node.scheduleUpdate(this),this._liftAnimationProgress=a):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress)},_setDraggingTranslationForMapFrameSize:function(a,b){var c=this._clampDraggingTranslationForMapFrameSize(a,b);this._draggingTranslation=c,this._liftAnimationStartDate||(this._node.position=new h(this._position.x+c.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y+c.y-this._anchorPoint.y-this._anchorOffset.y-this._liftAmount))},_clampDraggingTranslationForMapFrameSize:function(a,b){var c=this._anchorPoint.x+this._anchorOffset.x-this._position.x,d=b.width-this._node.size.width+c,e=this._anchorPoint.y+this._anchorOffset.y+this._liftAmount-this._position.y,f=b.height-this._node.size.height+e;return new h(i.clamp(a.x,c,d),i.clamp(a.y,e,f))},_dropAfterDraggingAndRevertPosition:function(a){this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,
delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,a||this._draggingDidEnd(),this._dropAfterLiftAnimationStartDate=Date.now(),this._dropAnimationRevert=a,this.node.scheduleUpdate(this),delete this._draggingTranslation},_animateDropAfterLift:function(){var a=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this._liftDurationMs,1),0);this._dropAnimationRevert&&(this.node.position=new h(this._position.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y-this._liftAmount*a)),this.node.opacity=1-(1-this._liftOpacity)*a,a>0?this.node.scheduleUpdate(this):(delete this._dropAfterLiftAnimationStartDate,delete this._dropAnimationStartP,delete this._dropAnimationRevert,delete this._isLifted,this.selected&&this._internalDelegate.selectedAnnotationDidMoveToMap(this))},_draggingDidEnd:function(){var a=this.node.convertPointToPage(new h(this._anchorPoint.x+this.anchorOffset.x,this._anchorPoint.y+this.anchorOffset.y));this.coordinate=this._internalDelegate._map.convertPointOnPageToCoordinate(new DOMPoint(a.x,a.y)),this.dispatchEvent(new j.Event(d.EVENTS.DRAG_END))},_distanceToPoint:function(a){var b=this._node.position.x,c=b+this._node.size.width,d=b-a.x,e=c-a.x,f=0>=d&&e>=0?0:Math.min(Math.abs(d),Math.abs(e)),g=this._node.position.y,h=g+this._node.size.height,i=g-a.y,j=h-a.y,k=0>=i&&j>=0?0:Math.min(Math.abs(i),Math.abs(j));return f*f+k*k},_canShowCallout:function(){return this._calloutEnabled&&!this._isWaiting&&!this._isMoving&&!this._isAnimating&&!this._isLifted},_canBePicked:function(){return this._shown&&this._visible&&!this._isMoving&&!this._isAnimating&&!this._isLifted},_finishedAnimating:function(){delete this._isAnimating,this._selected&&this._internalDelegate&&this._internalDelegate.selectedAnnotationDidMoveToMap(this),this.updateElement(),this._visible||this._updateVisibility()},_updatedProperty:function(a){this._internalDelegate&&this._internalDelegate.annotationPropertyDidChange(this,a)},_isAKnownOption:function(a){return m.indexOf(a)>=0}}),b.exports=d},{"../localizer":74,"../types":97,"../utils":101,"./annotation-layer-item":46,"dom-events":7,"geometry/point":9,"geometry/size":11,"render-tree":28}],48:[function(a,b,c){function d(a){g.call(this,a),this._node=new t.Node(q.htmlElement("div",{"class":z.CONTAINER})),this._annotationsNode=this._node.addChild(new t.Node(q.htmlElement("div"))),this._calloutsNode=this._node.addChild(new t.Node(q.htmlElement("div"))),this._sizer=new m,this._map.element.appendChild(this._sizer.element),this._pendingAnnotations=[],this._annotationDraggingMapPanningController=new f(a)}function e(a,b,c){return new s(a.origin.x-b,a.origin.y-c,a.size.width,a.size.height)}var f=a("./annotation-dragging-map-panning-controller"),g=a("../layer-items-controller"),h=a("./annotation"),i=a("./callout"),j=a("../types").CoordinateRegion,k=a("../types").CoordinateSpan,l=a("../services/geocoder"),m=a("../sizer"),n=a("../types").MapRect,o=a("../types").MapPoint,p=a("./user-location-annotation"),q=a("../utils"),r=a("geometry/point"),s=a("geometry/rect"),t=a("render-tree"),u=50,v=3e3,w=3e3,x=new k(.001,.001),y=1e3,z={CONTAINER:"mk-annotation-container",DRAGGING:"mk-dragging",SELECTED:"mk-selected",LIFTED:"mk-lifted"},A=12,B={top:37+A,bottom:A,left:8+A,right:8+A},C=null,D=40;d.prototype=q.inheritPrototype(g,d,{itemConstructor:h,itemName:"annotation",capitalizedItemName:"Annotation",_selectionDistance:Math.pow(g.prototype._selectionDistance,2),isItemExposed:function(a){return a!==this._userLocationAnnotation},_userLocationAnnotation:null,get userLocationAnnotation(){return this._userLocationAnnotation},addItems:function(a){a=g.prototype.addItems.call(this,a);var b=this._shouldAnnotationBePending();if(b)return a;a.sort(function(a,b){return b.coordinate.latitude-a.coordinate.latitude});var c=this._map._renderingMapRect,d=c.size.width,e=c.size.height,f=c.origin.x-d,h=f+3*d,i=c.origin.y-e,j=i+3*e,k=this._map._shouldWaitForTilesAndControls(),l=0;a.forEach(function(a){if(a._doesAnimate()&&a.visible){var b=a._x+(a._x<f?1:0);h>=b&&a._y>=i&&a._y<=j&&(a._delayRank=l,++l)}});var m=Math.min(l*u,v),n=0===l?0:m/l;return a.forEach(function(a){a._delayMs=a._delayRank*n,delete a._delayRank,this._addAnnotationWaitingForTiles(a,k)},this),a},addWaitingAnnotations:function(){this._waitingAnnotations&&(window.clearTimeout(this._tileLoadingTimeout),delete this._tileLoadingTimeout,this._waitingAnnotations.forEach(function(a){a.map&&this._addAnnotationWaitingForTiles(a,!1)},this),delete this._waitingAnnotations)},annotationsInMapRect:function(a){q.checkInstance(a,n,"[MapKit] Map.annotationsInMapRect expects a MapRect as its argument, got `"+a+"` instead.");var b=q.mod(a.origin.x,1),c=b+a.size.width,d=a.origin.y,e=d+a.size.height;return this._items.filter(function(a){if(a===this._userLocationAnnotation)return!1;var f=a._x+(a._x<b?1:0),g=a._y;return f>=b&&c>=f&&g>=d&&e>=g},this)},removeItem:function(a){return a===this._userLocationAnnotation?(console.warn("[MapKit] Map.removeAnnotation: the user location annotation cannot be removed. Set showsUserLocation to false instead."),a):g.prototype.removeItem.call(this,a)},removeUserLocationAnnotation:function(){this._userLocationAnnotation&&(this._userLocationAnnotation._removedFromMap(),g.prototype.removeItem.call(this,this._userLocationAnnotation),delete this._userLocationAnnotation)},showAnnotations:function(a,b){if(q.checkArray(a,"[MapKit] Map.showAnnotations expects an array of annotations"),0===a.length)return void console.warn("[MapKit] showAnnotations: no annotation to show (empty list)");var c=this._map._ensureRenderingFrame().size;if(0===c.width&&0===c.height)return void console.warn("[MapKit] Map.showAnnotations: cannot show annotations before the map frame is set.");var d=!1,e=B,f=x;b&&(q.checkType(b,"object","[MapKit] Map.showAnnotations expects an object as optional second parameter."),"animate"in b&&(d=!!b.animate),"padding"in b&&(e=b.padding),"minimumSpan"in b&&(q.checkInstance(b.minimumSpan,k,"[MapKit] Map.showAnnotations expects a CoordinateSpan for `options.minimumSpan`."),f=b.minimumSpan));var g=j._enclosingRegionForCoordinates(a.map(function(a,b){return q.checkInstance(a,h,"[MapKit] Map.showAnnotations: expects an array of Annotation objects as the first parameter, but got `"+a+"` at index "+b+"."),a.coordinate}));g.span.latitudeDelta=Math.max(g.span.latitudeDelta,f.latitudeDelta),g.span.longitudeDelta=Math.max(g.span.longitudeDelta,f.longitudeDelta);var i=g.span.latitudeDelta/2,l=g.span.longitudeDelta/2,m=new o(q.convertLongitudeToX(g.center.longitude-l),q.convertLatitudeToY(g.center.latitude+i)),p=new o(q.convertLongitudeToX(g.center.longitude+l),q.convertLatitudeToY(g.center.latitude-i)),r=new n(m.x,m.y,q.mod(p.x-m.x,1),p.y-m.y);return this._map.setVisibleMapRectAnimated(this._map._padMapRect(r,e),d),this.addItems(a),this},updateUserLocationAnnotation:function(a){if(a.coordinate){var b=this._userLocationAnnotation||new p(a);if(this._userLocationAnnotation||(this._userLocationAnnotation=b,this.addItem(b)),a.stale)return delete this._lastGeocoderRequestCoordinate,delete this._lastUserLocationAnnotationSubtitle,void(b._stale=!0);if(b._stale=!1,b._setCoordinate(a.coordinate),C){if(this._lastGeocoderRequestCoordinate&&this._lastGeocoderRequestCoordinate.latitude===b.coordinate.latitude&&this._lastGeocoderRequestCoordinate.longitude===b.coordinate.longitude)return void(this._userLocationAnnotation.subtitle=this._lastUserLocationAnnotationSubtitle)}else C=new l;this._lastGeocoderRequestCoordinate=b.coordinate.copy(),E(C,b,this)}},mapSizeDidUpdate:function(){if(0!==this._pendingAnnotations.length){var a=this._map._shouldWaitForTilesAndControls();this._pendingAnnotations.forEach(function(b){b._isPending&&this._addAnnotationWaitingForTiles(b,a)},this),this._pendingAnnotations=[]}},updateVisibleAnnotations:function(){this._updateVisibleAnnotations(this._items)},panningWillStart:function(){this._panning=!0,this._items.forEach(function(a){a._panningReferencePosition=a._position.copy()})},panningDidChange:function(a){this._updateVisibleAnnotations(this._items,a)},panningDidEnd:function(){delete this._panning,this._items.forEach(function(a){delete a._panningReferencePosition})},startDraggingAnnotation:function(a,b){this._map._annotationDraggingWillStart(),this._draggedAnnotation=a,this._pendingDragStart=!0,a._isLifted=!0,a.selected&&this._hideCallout(),q.classList.add(this._node.element,z.DRAGGING),q.classList.add(this._draggedAnnotation._node.element,z.LIFTED),this._draggedAnnotation._lift(D)},handleEvent:function(a){switch(a.type){case"region-change-start":this._nudgeStarted=!0,this._map.addEventListener("region-change-end",this);break;case"region-change-end":(this._nudgeStarted||!this._nudgeMapToShowCallout())&&(delete this._nudgeStarted,this._callout&&this._callout.animateIn(),this._map.removeEventListener(a.type,this))}},addedItem:function(a,b){g.prototype.addedItem.call(this,a,b),a._isWaiting=!0,a._delayRank=0;var c=this._shouldAnnotationBePending(a);c&&(a._isPending=!0,this._pendingAnnotations.push(a)),this._updateAnnotation(a),a.selected&&this._didSelectAnnotation(a),b||c||this._addAnnotationWaitingForTiles(a,this._map._shouldWaitForTilesAndControls())},removedItem:function(a){a.node.remove(),g.prototype.removedItem.call(this,a)},devicePixelRatioDidChange:function(){this._userLocationAnnotation&&this._userLocationAnnotation._devicePixelRatioDidChange()},removedReferenceToMap:function(){this._userLocationAnnotation&&this._userLocationAnnotation._removedFromMap()},pickableItemsCloseToPoint:function(a,b){var c=a.filter(function(a,c){var d=a._distanceToPoint(b);return d<=this._selectionDistance?(a._distance=d,a._index=c,!0):!1},this).sort(function(a,b){return a._distance-b._distance||b._index-a._index});return c.forEach(function(a){delete a._distance,delete a._index}),c},annotationDraggingDidChange:function(a){this._draggedAnnotation&&(this._pendingDragStart&&(delete this._pendingDragStart,this._draggedAnnotation._draggingDidStart(),this._map._dispatchEventWithAnnotation("drag-start",this._draggedAnnotation)),this._draggedAnnotation._setDraggingTranslationForMapFrameSize(a,this._map._ensureRenderingFrame().size),this._annotationDraggingMapPanningController.update(this._draggedAnnotation))},annotationDraggingDidEnd:function(a){this._draggedAnnotation&&(this._annotationDraggingMapPanningController.stop(),this._draggedAnnotation._dropAfterDraggingAndRevertPosition(!a),q.classList.remove(this._draggedAnnotation._node.element,z.LIFTED),q.classList.remove(this._node.element,z.DRAGGING),this._map._annotationDraggingDidEnd(),this._map._dispatchEventWithAnnotation("drag-end",this._draggedAnnotation),delete this._draggedAnnotation)},annotationPropertyDidChange:function(a,b){switch(b){case"selected":a.selected?this._didSelectAnnotation(a):this._didDeselectAnnotation(a);break;case"coordinate":this._updateAnnotation(a);break;case"calloutOffset":this._updateCalloutPosition(a);break;case"visible":this._selectedItem===a&&(this._callout?this._callout.visible=a.visible:a.visible&&this._showCalloutForAnnotation(a,!0));break;case"draggable":this._draggedAnnotation!==a||a.draggable||this._map._stopDraggingAnnotation();break;default:a.selected&&this._updateCalloutInfo(a)}},mapForAnnotation:function(a){return this._map},sizeForElement:function(a){return this._sizer.sizeForElement(a)},selectedAnnotationDidMoveToMap:function(a){this._showCalloutForAnnotation(a)},isElementInCallout:function(a){return!!this._callout&&this._callout.containsElement(a)},isElementInCustomCallout:function(a){return!!this._callout&&this._callout._isCustomCallout()&&this._callout.node.element.contains(a)},_addAnnotationToMap:function(a){return this._shouldAnnotationBePending()?void(a._isPending=!0):(a.willMoveToMap(a._canAnimate),delete a._timeout,delete a._isWaiting,delete a._canAnimate,this._annotationsNode.addChild(a.node),this._updateAnnotation(a),a.selected&&this._showCalloutForAnnotation(a),void a.didMoveToMap())},_addAnnotationWaitingForTiles:function(a,b){return a.hasOwnProperty("_canAnimate")||(a._canAnimate=!a._isPending),delete a._isPending,b&&a!==this._userLocationAnnotation?void(this._waitingAnnotations?this._waitingAnnotations.push(a):(this._waitingAnnotations=[a],this._tileLoadingTimeout=window.setTimeout(this.addWaitingAnnotations.bind(this),w))):void(a._doesAnimate()&&a._delayMs>0?(a._timeout=window.setTimeout(this._addAnnotationToMap.bind(this,a),a._delayMs),delete a._delayMs):this._addAnnotationToMap(a))},_didDeselectAnnotation:function(a){q.classList.remove(a._node.element,z.SELECTED),this.selectedItem=null,this._map._annotationSelectionDidChange(a),this._hideCallout()},_didSelectAnnotation:function(a){q.classList.add(a._node.element,z.SELECTED),this.selectedItem=a,this._map._annotationSelectionDidChange(a),a._visible&&this._showCalloutForAnnotation(a)},_boundingRectForSelectedAnnotationAndCallout:function(){var a=this._callout.boundingRect,b=this._selectedItem._position,c=Math.min(a.minX(),b.x),d=Math.min(a.minY(),b.y),e=Math.max(a.maxX(),b.x)-c,f=Math.max(a.maxY(),b.y)-d;return new s(c,d,e,f)},_nudgeMapToShowCallout:function(){if(this._map._cameraIsPanning||this._map._cameraIsZooming||this._map._animatingVisibleMapRect)return this._map.addEventListener("region-change-end",this),!0;if(!this._selectedItem._isShown())return!1;var a=this._boundingRectForSelectedAnnotationAndCallout().pad(A),b=this._totalMapNudgingTranslation(a,this._map._ensureVisibleFrame()),c=b.x,d=b.y;return 0===c&&0===d?!1:(c+=this._callout.shiftTailBy(c),this._map.addEventListener("region-change-start",this),this._map._translateVisibleMapRectAnimated(new r(c,d),!0),this._map.removeEventListener("region-change-start",this),!!this._nudgeStarted)},_translationToFitInFrame:function(a,b){var c={x:0,y:0};return(a.maxX()>b.maxX()||a.minX()<b.minX()||a.maxY()>b.maxY()||a.minY()<b.minY())&&(c.x=a.minX()<b.minX()?a.minX()-b.minX():a.maxX()>b.maxX()?a.maxX()-b.maxX():0,c.y=a.minY()<b.minY()?a.minY()-b.minY():a.maxY()>b.maxY()?a.maxY()-b.maxY():0),c},_totalMapNudgingTranslation:function(a,b){var c=this._translationToFitInFrame(a,b),d=this._map._controlsLayer.controlBounds(),f=b.midX(),g=b.midY(),h=0,i=0;return a=e(a,c.x,c.y),d.forEach(function(b){a.minX()<b.maxX()&&a.maxX()>b.minX()&&a.minY()<b.maxY()&&a.maxY()>b.minY()&&(h+=a.minX()<f?a.minX()-b.maxX():a.maxX()-b.minX(),i+=a.minY()<g?a.minY()-b.maxY():a.maxY()-b.minY(),0!==i&&Math.abs(h)>Math.abs(i)?h=0:i=0,a=e(a,h,i))},this),c.x+=h,c.y+=i,c},_hideCallout:function(){this._callout&&(q.classList.remove(this._callout._node.element,z.SELECTED),this._callout.animateOut(),delete this._callout)},_shouldAnnotationBePending:function(){return!this._map.element.ownerDocument.body.contains(this._map.element)},_showCalloutForAnnotation:function(a,b){if(this._hideCallout(),a._canShowCallout()&&(!a._callout||"function"!=typeof a._callout.calloutShouldAppearForAnnotation||a._callout.calloutShouldAppearForAnnotation(a))){var c;if(a._callout&&"function"==typeof a._callout.calloutElementForAnnotation&&(c=a._callout.calloutElementForAnnotation(a),q.checkElement(c,"[MapKit] calloutElementForAnnotation() must return a DOM element, but returned `"+c+"` instead.")),!c){var d;if(a._callout&&"function"==typeof a._callout.calloutContentForAnnotation&&(d=a._callout.calloutContentForAnnotation(a),q.checkElement(d,"[MapKit] contentElementForAnnotation() must return a DOM element, but returned `"+d+"` instead.")),!d&&!a.title)return}this._callout=new i(this._sizer,{customElement:c,contentElement:d}),this._callout.animates=b?!1:a._callout&&"function"==typeof a._callout.calloutShouldAnimateForAnnotation?!!a._callout.calloutShouldAnimateForAnnotation(a):!0;var e=this._callout.animates&&a._callout&&"function"==typeof a._callout.calloutAppearanceAnimationForAnnotation?a._callout.calloutAppearanceAnimationForAnnotation(a):"";if(q.checkType(e,"string","[MapKit] calloutAppearanceAnimationForAnnotation() must return a string, but returned `"+e+"` instead."),this._callout.appearanceAnimation=e,c){var f;a._callout&&"function"==typeof a._callout.calloutAnchorOffsetForAnnotation&&(f=a._callout.calloutAnchorOffsetForAnnotation(a,c,this._callout.node.size),q.checkInstance(f,DOMPoint,"[MapKit] calloutAnchorOffsetForAnnotation() must return a DOMPoint, but returned `"+f+"` instead.")),this._callout.setAnchorOffset(f)}this._updateCalloutInfo(a),this._updateCalloutPosition(a);var g=this._nudgeMapToShowCallout();this._callout.willMoveToMap(),q.classList.add(this._callout._node.element,z.SELECTED),this._calloutsNode.addChild(this._callout.node),g||this._callout.animateIn()}},_updateCalloutInfo:function(a){this._callout?this._callout._updateInfo(a)||this._hideCallout():this._showCalloutForAnnotation(a)},_updateCalloutPosition:function(a){this._selectedItem===a&&this._callout&&(this._callout._setShown(a._isShown()),this._callout._setPosition(a._positionForCallout()))},_updateVisibleAnnotations:function(a,b){this._deletePreviousPointForPickingItem();var c=this._map._renderingMapRect,d=this._map._worldSize,e=c.size.width,f=c.size.height,g=c.minX(),h=c.maxX(),i=g-e,j=h+e,k=c.minY(),l=k-f,m=l+3*f;a.forEach(function(a){if(a!==this._draggedAnnotation||!this._annotationDraggingMapPanningController.panning){var c=a._x+(a._x<i?1:0),e=(a._y-k)*d;if(j>=c&&a._y>=l&&a._y<=m){a._setShown(!0);var f=g-c;f>0?Math.abs(h-(c+1))<f&&++c:(f=c-h,f>0&&Math.abs(g-(c-1))<f&&--c);var n=(c-g)*d;if(b&&a._panningReferencePosition){var o=a._panningReferencePosition.x+b.x,p=q.mod(n-o+d/2,d)-d/2;a._setPosition(new r(n-p,a._panningReferencePosition.y+b.y))}else a._setPosition(new r(n,e)),b&&(a._panningReferencePosition=new r(n-b.x,e-b.y))}else a._setShown(!1),a._setPosition(new r((a._x-g)*d,e))}},this),this._updateCalloutPosition(this._selectedItem)},_updateAnnotation:function(a){return a.coordinate?(a._x=q.convertLongitudeToX(q.wrapLongitude(a.coordinate.longitude)),a._y=q.convertLatitudeToY(a.coordinate.latitude),void this._updateVisibleAnnotations([a])):void a._setShown(!1)}});var E=q.debounce(function(a,b,c){c._geocoderRequestId&&a.cancel(c._geocoderRequestId);var d=c._geocoderRequestId=a.reverseLookup(b.coordinate,function(a,e){d===c._geocoderRequestId&&(delete c._geocoderRequestId,a?(console.error("[MapKit] Error getting address for user location: "+a.message),b.subtitle=null):e.results.length>0?c._lastUserLocationAnnotationSubtitle=b.subtitle=e.results[0].formattedAddress:b.subtitle=null)})},y);b.exports=d},{"../layer-items-controller":71,"../services/geocoder":92,"../sizer":96,"../types":97,"../utils":101,"./annotation":47,"./annotation-dragging-map-panning-controller":45,"./callout":49,"./user-location-annotation":52,"geometry/point":9,"geometry/rect":10,"render-tree":28}],49:[function(a,b,c){function d(a,b){this._sizer=a;var c=m.htmlElement("div",{"class":H.CALLOUT});this._node=new k.Node(c),b.customElement?(this._containerElement=this._customElement=c.appendChild(b.customElement),this._setSize(this._sizer.sizeForElement(this._customElement))):(this._tailSide=b.tailSide||n.Bottom,this._tailScale=b.tailScale||1,this._bubbleElement=m.svgElement("path"),this._svgElement=c.appendChild(m.svgElement("svg",{"class":H.CALLOUT_BUBBLE},this._bubbleElement)),this._containerElement=c.appendChild(m.htmlElement("div")),b.contentElement?this._setContentElement(b.contentElement):m.classList.add(this._containerElement,H.STANDARD_CONTENT)),b.position&&this._setPosition(b.position),this._node.wantsHardwareCompositing=!0}function e(a){return(a-w)/(2*s)}function f(a,b){b||(b={});var c=b.tailShift||0,d=b.side||n.Bottom,e=b.scale||1,f=s*e,g=p*e,h=a.height/2-f,i=a.width/2-f,j=t*e,k=u*e;return"M"+(d===n.Left?g:0)+","+o+"c0,"+(r-o)+" "+q+","+-o+" "+o+","+-o+"h"+a.width+"c"+(o-q)+",0 "+o+","+r+" "+o+","+o+(d===n.Right?"v"+h+"c0,"+j+" "+g+","+k+" "+g+","+f+"c0,"+(f-k)+" "+-g+","+(f-j)+" "+-g+","+f+"v"+h:"v"+a.height)+"c0,"+(o-r)+" "+-q+","+o+" "+-o+","+o+(d===n.Bottom?"h"+(-c-i)+"c"+-j+",0 "+-k+","+g+" "+-f+","+g+"c"+(k-f)+",0 "+(j-f)+","+-g+" "+-f+","+-g+"h"+(c-i):"h"+-a.width)+"c"+(q-o)+",0 "+-o+","+-r+" "+-o+","+-o+(d===n.Left?"v"+-h+"c0,"+-j+" "+-g+","+-k+" "+-g+","+-f+"c0,"+(k-f)+" "+g+","+(j-f)+" "+g+","+-f+"v"+-h:"z")}var g=a("./annotation-layer-item"),h=a("geometry/point"),i=a("geometry/rect"),j=a("geometry/size"),k=a("render-tree"),l=a("css-transform"),m=a("../utils"),n=g.CalloutTailSide,o=8,p=13,q=3.5826363,r=3.58028186,s=17,t=10,u=12,v=2*s,w=3,x=272,y=1+2*o,z="mk-fadeout",A="0.1s",B=8e3/60,C=5e3/60,D=5e3/60,E=30/249,F=277/249,G=237/249,H={CALLOUT:"mk-callout",CALLOUT_BUBBLE:"mk-bubble",TITLE:"mk-title",SUBTITLE:"mk-subtitle",NO_SUBTITLE:"mk-no-subtitle",STANDARD_CONTENT:"mk-standard"};d.prototype=m.inheritPrototype(g,d,{_tailShift:0,get node(){return this._node},get boundingRect(){var a=this._node.position;return new i(a.x,a.y,this._node.size.width,this._node.size.height)},willMoveToMap:function(){this._node.transform=(new l).scale(0)},setAnchorOffset:function(a){this._anchorOffset=a?new DOMPoint(a.x,a.y):new DOMPoint},containsElement:function(a){return a!==this._svgElement&&this._containerElement.contains(a)},_isCustomCallout:function(){return!(!this._customElement&&!this._contentElement)},_updateInfo:function(a){if(this._customElement||this._contentElement)return!0;if(!a||!a.title)return!1;this._containerElement.innerHTML="",this._containerElement.style.width="",this._containerElement.appendChild(m.htmlElement("div",{"class":H.TITLE},a.title)),a.subtitle?(this._containerElement.appendChild(m.htmlElement("div",{"class":H.SUBTITLE},a.subtitle)),m.classList.remove(this._containerElement,H.NO_SUBTITLE)):m.classList.add(this._containerElement,H.NO_SUBTITLE);var b=this._sizer.sizeForElement(this._containerElement);return b.width=m.clamp(b.width,v,x),this._updateSize(b),this._updatePosition(),!0},_updatePosition:function(){g.prototype._updatePosition.call(this),this._tailShift&&(this._node.position=new h(this._node.position.x+this._tailShift,this._node.position.y))},_setContentElement:function(a){this._contentElement=a;var b=this._sizer.sizeForElement(a);this._updateSize(b),this._containerElement.appendChild(m.htmlElement("div",a))},_updateSize:function(a){var b=this._tailSide===n.Left||this._tailSide===n.Right?Math.min(e(a.height),this._tailScale):this._tailScale;this._bubbleElement.setAttribute("d",f(a,{side:this._tailSide,scale:b})),this._containerElement.style.width=a.width+"px",this._extraHeight=y+p*b,a.width+=this._tailSide===n.Bottom?y:this._extraHeight,a.height+=this._tailSide===n.Bottom?this._extraHeight:y,this._svgElement.style.width=a.width+"px",this._svgElement.style.height=a.height+"px",this._svgElement.setAttribute("viewBox","-0.5 -0.5 "+a.width+" "+a.height),this._containerElement.style.left=o+(this._tailSide===n.Left?p*b:0)+"px",this._containerElement.style.top=o+"px",this._setSize(a,this._tailSide)},shiftTailBy:function(a){if(this._customElement||0===a)return 0;var b=new j(this._node.size.width-y,this._node.size.height-this._extraHeight),c=(b.width-v-o)/2;return this._tailShift=0>a?Math.min(c,-a):-Math.min(c,a),this._bubbleElement.setAttribute("d",f(b,{side:this._tailSide,scale:this._tailScale,tailShift:this._tailShift})),this._updatePosition(),this._tailShift},handleEvent:function(a){"animationend"!==a.type&&"webkitAnimationEnd"!==a.type||a.animationName!==this._animationName||(this._animationName===this._appearanceAnimationName?(this._containerElement.style.animation=this._containerElement.style.webkitAnimation="",this._containerElement.removeEventListener("animationend",this),this._containerElement.removeEventListener("webkitAnimationEnd",this)):this._node.remove(),delete this._animationName)},animateIn:function(){return!this.animates||this.animates&&this._customElement&&!this.appearanceAnimation?void(this._node.transform=new l):this._appearanceAnimationName?(this._node.transform=new l,this._containerElement.style.animation=this._containerElement.style.webkitAnimation=this._appearanceAnimation,this._svgElement&&(this._svgElement.style.animation=this._svgElement.style.webkitAnimation=this._appearanceAnimation),this._animationName=this._appearanceAnimationName,this._containerElement.addEventListener("animationend",this),void this._containerElement.addEventListener("webkitAnimationEnd",this)):(this._scaleXOffset=this._tailSide===n.Bottom?-this._tailShift:this._tailSide===n.Left?-this._node.size.width/2:this._node.size.width/2,this._scaleYOffset=this._tailSide===n.Bottom?this._node.size.height/2:0,this._scaleAnimationParameterIndex=0,this._scaleAnimationStartDate=Date.now(),void this._node.scheduleUpdate(this))},animateOut:function(){return this.visible?(this._scaleAnimationStartDate&&this._finishAnimatingScale(),this._node.element.style.webkitAnimation=this._node.element.style.animation=z+" "+A+" forwards",void(this._node.element.style.webkitAnimationName||this._node.element.style.animationName?(this._animationName=z,this._node.element.addEventListener("animationend",this),this._node.element.addEventListener("webkitAnimationEnd",this)):this._node.remove())):void this._node.remove()},updateNode:function(){this._scaleAnimationStartDate&&this._animateScale()},_scaleAnimationParameters:[[B,E,F],[C,F,G],[D,G,1]],_animateScale:function(){var a=this._scaleAnimationParameters[this._scaleAnimationParameterIndex],b=a[0],c=a[1],d=a[2],e=Date.now(),f=Math.min((e-this._scaleAnimationStartDate)/b,1),g=c+(d-c)*f;if(this._node.transform=(new l).translate(this._scaleXOffset,this._scaleYOffset).scale(g).translate(-this._scaleXOffset,-this._scaleYOffset),1===f){if(++this._scaleAnimationParameterIndex,!(this._scaleAnimationParameterIndex<this._scaleAnimationParameters.length))return void this._finishAnimatingScale();this._scaleAnimationStartDate=e}this._node.scheduleUpdate(this)},_finishAnimatingScale:function(){delete this._scaleXOffset,delete this._scaleYOffset,delete this._scaleAnimationStartDate,delete this._scaleAnimationParameterIndex}}),b.exports=d},{"../utils":101,"./annotation-layer-item":46,"css-transform":3,"geometry/point":9,"geometry/rect":10,"geometry/size":11,"render-tree":28}],50:[function(a,b,c){function d(a,b){if(e.call(this,a,document.createElement.bind(document,"img"),b),!(b&&"url"in b))throw new Error("[MapKit] No URL for image of ImageAnnotation");this._waitingForImage=!this._userSetSize,this.url=b.url}var e=a("./annotation"),f=a("./pin-annotation"),g=a("../urls"),h=a("../utils"),i=a("geometry/size"),j=a("geometry/point"),k=Math.min(h.devicePixelRatio,3),l=g.createImageUrl("pins/pin-red")+(k>1?"_"+k+"x":"")+".png",m={width:32,height:39};d.prototype=h.inheritPrototype(e,d,{get url(){return this._url},set url(a){if(delete this._ratio,a&&"object"==typeof a){this._url=a;for(var b=Object.keys(a).map(parseFloat).filter(function(a){return!isNaN(a)}).sort(),c=h.devicePixelRatio,d=b.length-1;d>=0&&((!this._ratio||b[d]>=c)&&(this._ratio=b[d]),!(b[d]<=c));--d);}if(!this._ratio)throw new Error("[MapKit] No URL for image of ImageAnnotation");this._element.src=this._url[this._ratio],this._element.complete?this._updateSize():(this._userSetSize||(this._waitingForImage=!0),this._element.addEventListener("load",this),this._element.addEventListener("error",this))},willMoveToMap:function(){this._isMoving=this._doesAnimate()},handleEvent:function(a){switch(this._element.removeEventListener("load",this),this._element.removeEventListener("error",this),a.type){case"load":this._handleImageLoaded();break;case"error":this._handleImageError()}},_updateLocalizedText:function(){this._element.setAttribute("alt",this._altText())},_handleImageLoaded:function(){this._useFallbackImage&&(delete this._updatePosition,delete this._useFallbackImage,delete this._positionForCallout),this._updateSize()},_handleImageError:function(){console.error("[MapKit] Could not load image for ImageAnnotation at URL "+this._element.src),this._useFallbackImage=!0,this._updatePosition=function(){this._node.position=new j(this._position.x-f.prototype._anchorPoint.x,this._position.y-f.prototype._anchorPoint.y)},this._updatePosition(),this._positionForCallout=function(){return new j(this._node.position.x-f.prototype._calloutAnchorPoint.x,this._node.position.y-f.prototype._calloutAnchorPoint.y)},this._element.src=l,this._setElementSize(m)},_updateSize:function(){if(delete this._waitingForImage,!this._useFallbackImage){var a;this._userSetSize?a=this._node.size:(a=new i(this._element.naturalWidth/this._ratio,this._element.naturalHeight/this._ratio),this._setSize(a)),this._useFallbackImage||this._setElementSize(a),e.prototype._updateSize.call(this)}},_canShowCallout:function(){return!this._waitingForImage&&e.prototype._canShowCallout.call(this)},_setElementSize:function(a){this._element.width=a.width,this._element.height=a.height},_isAKnownOption:function(a){return"url"===a||e.prototype._isAKnownOption.call(this,a)}}),b.exports=d},{"../urls":98,"../utils":101,"./annotation":47,"./pin-annotation":51,"geometry/point":9,"geometry/size":11}],51:[function(a,b,c){function d(a,b){f.call(this,a,e,b),this._userSetSize||this._setSize(y),b&&"color"in b&&(this.color=b.color),this.updateElement()}function e(){return i.htmlElement("canvas",{"class":w,width:z*m,height:A*m})}var f=a("./annotation"),g=a("geometry/point"),h=a("geometry/size"),i=a("../utils"),j=a("../urls"),k=a("render-tree"),l=a("../localizer"),m=Math.min(i.devicePixelRatio,3),n=j.createImageUrl("pins/pin"),o=(i.devicePixelRatio>1?"_"+m+"x":"")+".png",p=4,q=.35,r=3,s=[1,2,3,2,1],t=.820304748437335,u=Math.tan(t),v=.25,w="mk-pin-annotation-view",x="mk-pin-shadow",y=new h(15,36),z=32,A=39;d.Colors={Red:"#ff3d38",Green:"#54d669",Purple:"#c969e0"};var B,C={},D=[];d.prototype=i.inheritPrototype(f,d,{_animates:!0,_color:d.Colors.Red,_anchorPoint:new DOMPoint(8,35),_calloutAnchorPoint:new DOMPoint(-8,0),_floatingYOffset:-2,_updatePosition:function(){this._floating||f.prototype._updatePosition.call(this)},get size(){return y.copy()},set size(a){console.warn("[MapKit] The `size` property of a pin annotation cannot be set.")},get color(){return this._color},set color(a){i.checkType(a,"string","[MapKit] Expected a string value for PinAnnotation.color, but got `"+a+"` instead"),a!==this._color&&(this._color=a,this._updateLocalizedText(),this._drawPin())},_doesAnimate:function(){return this._animates},updateElement:function(a){return B?(a=this._floating?"floating":a||"",void(this._state!==a&&(this._state=a,this._drawPin(),"floating"===this._state?(this._shadowNode=new k.Node(i.htmlElement("img",{"class":x,src:n+"-shadow"+o})),this._shadowNode.wantsHardwareCompositing=!0,this._shadowNode.position=this._node.position.copy(),this._node.parent.insertBefore(this._shadowNode,this._node)):this._shadowNode&&(this._shadowNode.remove(),delete this._shadowNode)))):void(D.indexOf(this)<0&&D.push(this))},willMoveToMap:function(a){this._isMoving=a&&this.animates},didMoveToMap:function(){var a=this._isMoving;if(f.prototype.didMoveToMap.call(this),this._internalDelegate&&a&&this.visible&&!this._appearanceAnimation&&this._shown){var b=this._internalDelegate.mapForAnnotation(this);this._isAnimating=!0;var c=this._position.y;this._pinVerticalTranslation=-c-p,this._shadowHorizontalTranslation=u*-this._pinVerticalTranslation,this._shadowVerticalTranslation=this._pinVerticalTranslation;var d=c/b._ensureRenderingFrame().size.height;this._dropDurationMs=1e3*Math.min(q*(d+(1-d)/2),r),this._dropAnimationStartDate=Date.now(),this._floating=!0,this.updateElement(),this._animateDrop(),this._animationQueue=[this._bounce,this._finishedAnimating],this._node.scheduleUpdate(this)}},updateNode:function(){this._dropAnimationStartDate?this._animateDrop():this._bounceAnimationFrameIndex>=0?this._animateBounce():f.prototype.updateNode.call(this)},_altText:function(){return f.prototype._altText.call(this)||(this._color===d.Colors.Green?l.get("Annotation.Pin.Green.AccessibilityLabel"):this._color===d.Colors.Purple?l.get("Annotation.Pin.Purple.AccessibilityLabel"):this._color===d.Colors.Red?l.get("Annotation.Pin.Red.AccessibilityLabel"):l.get("Annotation.Pin.AccessibilityLabel"));
},_dequeueNextAnimation:function(){this._animationQueue.length>0&&this._animationQueue.shift().call(this)},_animateDrop:function(){var a=Math.min((Date.now()-this._dropAnimationStartDate)/this._dropDurationMs,1),b=1-a;this.node.position=new g(this._position.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y+b*this._pinVerticalTranslation),this._shadowNode.position=new g(this._position.x-this._anchorPoint.x-this._anchorOffset.x+b*this._shadowHorizontalTranslation,this._position.y-this._anchorPoint.y-this._anchorOffset.y+b*this._shadowVerticalTranslation),1===a&&(delete this._pinVerticalTranslation,delete this._shadowHorizontalTranslation,delete this._shadowVerticalTranslation,delete this._dropAnimationStartDate,delete this._dropDurationMs,this._floating=!1,this.updateElement(),this._dequeueNextAnimation()),this._node.scheduleUpdate(this)},_bounce:function(){this._bounceAnimationFrameIndex=0},_animateBounce:function(){this._bounceAnimationFrameIndex<s.length?(this.updateElement("down"+s[this._bounceAnimationFrameIndex]),++this._bounceAnimationFrameIndex):(delete this._bounceAnimationFrameIndex,this._dequeueNextAnimation()),this._node.scheduleUpdate(this)},_lift:function(a){this._nominalLiftAmount=a,this._animationQueue=[this._liftAfterBounce],this._bounce(),this._node.scheduleUpdate(this)},_liftAfterBounce:function(){f.prototype._lift.call(this,this._nominalLiftAmount),this._floating=!0,this.updateElement()},_animateLift:function(){var a=Math.min((Date.now()-this._liftAnimationStartDate)/this._liftDurationMs,1),b=this._liftAmount*a,c=this._position.x+this._draggingTranslation.x-this._anchorPoint.x-this._anchorOffset.x,d=this._position.y+this._draggingTranslation.y-this._anchorPoint.y-this._anchorOffset.y-b;this.node.position=new g(c,d),this._shadowLiftDamping&&(b=this._liftAmount*(1+v*a)),this._shadowNode.position=new g(c+u*b,d-b),1>a?(this.node.scheduleUpdate(this),this._liftAnimationProgress=a):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress,delete this._shadowLiftDamping,this._dequeueNextAnimation())},_setDraggingTranslationForMapFrameSize:function(a,b){var c=this._clampDraggingTranslationForMapFrameSize(a,b);if(this._draggingTranslation=c,!(this._bounceAnimationFrameIndex>=0||this._liftAnimationStartDate)){var d=this._position.x+c.x-this._anchorPoint.x-this._anchorOffset.x,e=this._position.y+c.y-this._anchorPoint.y-this._anchorOffset.y-this._floatingYOffset-this._liftAmount;this._node.position=new g(d,e),this._shadowNode.position=new g(d+u*this._liftAmount,e-this._liftAmount)}},_dropAfterDraggingAndRevertPosition:function(a){return this._bounceAnimationFrameIndex>=0?(this._isLifted=!1,void(this._animationQueue=[this._droppedAfterLift])):(this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,a?(this._dropAfterLift(),this._animationQueue=[this._bounce,this._droppedAfterLift]):(this._draggingDidEnd(),f.prototype._lift.call(this,this._nominalLiftAmount),this._shadowLiftDamping=!0,this._animationQueue=[this._dropAfterLift,this._bounce,this._droppedAfterLift]),this._dropAnimationRevert=a,void this.node.scheduleUpdate(this))},_dropAfterLift:function(){delete this._draggingTranslation,this._dropAfterLiftAnimationStartDate=Date.now(),this.node.scheduleUpdate(this)},_animateDropAfterLift:function(){var a=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this._liftDurationMs,1),0),b=this._liftAmount*a,c=this._position.x-this._anchorPoint.x-this._anchorOffset.x,d=this._position.y-this._anchorPoint.y-this._anchorOffset.y-this._floatingYOffset-b;this.node.position=new g(c,d),this._dropAnimationRevert||(b*=1+v),this._shadowNode.position=new g(c+u*b,d-b),0===a&&(delete this._floating,this.updateElement(),delete this._dropAfterLiftAnimationStartDate,delete this._dropAnimationStartP,delete this._dropAnimationRevert,delete this._isLifted,this._dequeueNextAnimation()),this._node.scheduleUpdate(this)},_droppedAfterLift:function(){this.updateElement(),this.selected&&this._internalDelegate.selectedAnnotationDidMoveToMap(this)},_drawPin:function(){if(this.hasOwnProperty("_state")&&B[this._state].base&&B[this._state].head){this._ctx||(this._ctx=this.element.getContext("2d")),C[this._color]||(C[this._color]={});var a=this._element.width,b=this._element.height;if(!C[this._color][this._state]){var c=document.createElement("canvas");c.width=a,c.height=b;var d=c.getContext("2d");d.fillStyle=this._color,d.fillRect(0,0,a,b),d.save(),d.globalCompositeOperation="destination-in",d.drawImage(B[this._state].head,0,0),d.restore(),d.drawImage(B[this._state].base,0,0),C[this._color][this._state]=c}this._ctx.clearRect(0,0,a,b),this._ctx.drawImage(C[this._color][this._state],0,0)}},_isAKnownOption:function(a){return"color"===a||f.prototype._isAKnownOption.call(this,a)}}),function(){function a(){--e,0===e&&(B=d,D.forEach(function(a){a.updateElement()}))}function b(b){console.warn("[MapKit] Error loading pin annotation image "+b.target.src+"; pin annotations may not display correctly."),a()}function c(c,e){var f=n+(c?"-":"")+c+"-"+e+o,g=i.htmlElement("img",{src:f});g.addEventListener("load",function(){d[c][e]=g,a()}),g.addEventListener("error",b)}var d={},e=["","floating","down1","down2","down3"].reduce(function(a,b){return d[b]={},c(b,"base"),c(b,"head"),a+2},0)}(),b.exports=d},{"../localizer":74,"../urls":98,"../utils":101,"./annotation":47,"geometry/point":9,"geometry/size":11,"render-tree":28}],52:[function(a,b,c){function d(a){console.assert(a&&a.location&&"number"==typeof a.location.latitude&&"number"==typeof a.location.longitude),g.call(this,a.coordinate,i.htmlElement.bind(null,"canvas")),this._node.size=new j(2*l,2*l),this.element.style.width=this.element.style.height=o+"px",this._ctx=this.element.getContext("2d"),this._startTime=Date.now(),this._devicePixelRatioDidChange(),this._updateTitleAndSubtitleForLocale(),h.addEventListener(h.Events.LocaleChanged,this),window.top.addEventListener("blur",this),window.top.addEventListener("focus",this)}function e(a){var b=Math.pow(a,2);return b/(b+Math.pow(1-a,2))}function f(a,b,c){return"rgb("+a.map(function(a,d){return Math.round(a+(b[d]-a)*c)}).join(", ")+")"}var g=a("./annotation"),h=a("../localizer"),i=a("../utils"),j=a("geometry/size"),k=8,l=11,m=10,n=l+m,o=2*n,p="white",q="rgb(180, 180, 180)",r="rgba(0, 0, 0, 0.3)",s=3e3,t=s/2,u=1,v=.75,w=[68,152,252],x=[26,129,251];d.prototype=i.inheritPrototype(g,d,{_anchorOffset:new DOMPoint(0,-n),_calloutAnchorPoint:new DOMPoint(-n,-m),handleEvent:function(a){switch(a.type){case h.Events.LocaleChanged:this._updateTitleAndSubtitleForLocale();break;case"blur":this._pauseAnimation();break;case"focus":this._resumeAnimation()}},_stale:!1,_updateTitleAndSubtitleForLocale:function(){this.title=h.get("Location.Title"),this.subtitle=h.get("Location.Subtitle")},_setCoordinate:function(a){Object.getOwnPropertyDescriptor(g.prototype,"coordinate").set.call(this,a)},set coordinate(a){return this.hasOwnProperty("_coordinate")?void console.warn("[MapKit] The `coordinate` property of the user location annotation cannot be set."):void(this._coordinate=a.copy())},get coordinate(){return this._coordinate},get draggable(){return!1},set draggable(a){console.warn("[MapKit] The `draggable` property of the user location annotation cannot be set.")},get size(){return this._node.size.copy()},set size(a){console.warn("[MapKit] The `size` property of the user location annotation cannot be set.")},updateNode:function(){this._draw()},_devicePixelRatioDidChange:function(){var a=Math.max(i.devicePixelRatio,2);a!==this._dpr&&(this._dpr=a,this.element.width=this.element.height=o*a,this._node.scheduleUpdate(this))},_removedFromMap:function(){this._pauseAnimation(),h.removeEventListener(h.Events.LocaleChanged,this),window.top.removeEventListener("blur",this),window.top.removeEventListener("focus",this)},_pauseAnimation:function(){this._pausedTime=Date.now()},_resumeAnimation:function(){this._pausedTime&&(this._startTime+=Date.now()-this._pausedTime,delete this._pausedTime,this._node.scheduleUpdate(this))},_draw:function(){var a=this._ctx;a.clearRect(0,0,this.element.width,this.element.height);var b=(Date.now()-this._startTime)%s,c=e(t>b?1-b/t:(b-t)/t),d=v+(u-v)*c;a.save(),a.scale(this._dpr,this._dpr),a.save(),a.beginPath(),a.arc(n,n,l,0,2*Math.PI),a.fillStyle=p,a.shadowColor=r,a.shadowBlur=m*this._dpr,a.fill(),a.restore(),a.beginPath(),a.arc(n,n,k*d,0,2*Math.PI),a.fillStyle=this._stale?q:f(w,x,c),a.fill(),a.restore(),this._pausedTime||this._node.scheduleUpdate(this)}}),b.exports=d},{"../localizer":74,"../utils":101,"./annotation":47,"geometry/size":11}],53:[function(a,b,c){var d=a("../build.json"),e=a("./language-support"),f=a("./localizer"),g=a("./utils"),h=a("dom-events"),i=a("./requests/xhr-loader"),j=g.isIE9()||g.isIE10()?location.protocol:"https:",k=j+"//cdn.apple-mapkit.com/ma/bootstrap",l={OK:200,MULTIPLE_CHOICES:300,UNAUTHORIZED:401},m=["apiKey","apiBaseUrl","bootstrapUrl","language","countryCode"],n={READY:0,PENDING:1,ERROR:2},o={TILE_SOURCES:{TOMTOM:"TomTom",AUTONAVI:"AutoNavi"},Events:{Changed:"configuration-load",Error:"configuration-error"},States:n,state:n.PENDING,vendorKey:null,tileProvider:"Apple",_countryCode:null,apiBaseUrl:null,supportsPrefetchingForPanning:!1,supportsPrefetchingForZooming:!1,types:{},_acceptLanguage:null,_optionsLanguage:null,init:function(a){if(g.required(a,"[MapKit] mapkit.init(): `options` object is required.",{checkNull:!0}).checkType(a,"object","[MapKit] mapkit.init(): `options` object is invalid."),Object.keys(a).forEach(function(a){-1===m.indexOf(a)&&console.warn("[MapKit] Ignoring invalid option to mapkit.init(): `"+a+"`.")}),null!==this.vendorKey)return void console.warn("[MapKit] Already initialized. Ignoring subsequent call to mapkit.init().");var b=a.apiKey;g.required(b,"[MapKit] mapkit.init(): `options` is missing `apiKey`.",{checkNull:!0}).checkType(b,"string","[MapKit] mapkit.init(): `apiKey` in `options` must be a string."),this.vendorKey=b,a.language&&(g.checkType(a.language,"string","[MapKit] mapkit.init(): `language` in `options` must be a string."),this._optionsLanguage=a.language),this.language=this._optionsLanguage,a.countryCode&&(this._countryCode=a.countryCode),this.apiBaseUrl=a.apiBaseUrl,this.bootstrapUrl=a.bootstrapUrl||k,this._loadFromServer()},get ready(){return this.state===n.READY},get language(){return this._language},set language(a){a!==this._language&&(a?g.checkType(a,"string","[MapKit] `language` must be a string or `null`."):a=this._acceptLanguage||this._getBrowserLanguage(),this._language=e.bestMatch(a,"en"),f.localeId=f.bestMatch(a,"en-US"))},get countryCode(){return this._countryCode},set countryCode(a){a!==this._countryCode&&(a&&(g.checkType(a,"string","[MapKit] `countryCode` must be a string or `null`."),a=a.toUpperCase()),this._countryCode=a,this._loadFromServer())},loaderWillStart:function(a){this.state=n.PENDING},loaderDidSucceed:function(a,b){this._requestDidLoad(b)},loaderDidFail:function(a,b){console.error("[MapKit] Loading the configuration failed after retrying.",b),this._loadFailed()},_loadFailures:0,_loadFromServer:function(){var a={apiVersion:"1",vendorkey:this.vendorKey,countryCode:"CN"===this._countryCode?this._countryCode:null,mkjsVersion:d.version},b=this.bootstrapUrl+"?"+g.toQueryString(a),c=new i(b,this,{retry:!0,delay:0});c.schedule()},_requestDidLoad:function(a){var b,c=a.status;if(!(c>=l.OK&&c<l.MULTIPLE_CHOICES))return b=c===l.UNAUTHORIZED?"[MapKit] Initialization failed because the API key is invalid.":"[MapKit] Initialization failed because the server returned error "+c+" ("+a.statusText+").",console.error(b),void this._loadFailed();try{this._parseData(JSON.parse(a.responseText))}catch(d){return console.error("[MapKit] Parsing the configuration failed.",d),void this._loadFailed()}this.language=this._optionsLanguage,this._loadSucceeded()},_loadSucceeded:function(){this.state=n.READY,this.dispatchEvent(new h.Event(o.Events.Changed))},_loadFailed:function(){this.state=n.ERROR,this.dispatchEvent(new h.Event(o.Events.Error)),this._loadFailures=0},_parseData:function(a){a.apiBaseUrl||console.warn("Configuration: apiBaseUrl not found. Using default."),this._countryCode="unknown"!==a.countryCode?a.countryCode:null,this.environment=a.environment,this.apiBaseUrl=this.apiBaseUrl||a.apiBaseUrl,this.analyticsBaseUrl=a.analyticsBaseUrl,this.analyticsEnabled=a.analyticsEnabled||!1,a.locationShiftUrl&&(this.locationShiftUrl=a.locationShiftUrl),this._acceptLanguage=this._parseAcceptLanguage(a.acceptLanguage),"options"in a&&(this.supportsPrefetchingForPanning=!!a.options.enablePrefetchForPan,this.supportsPrefetchingForZooming=!!a.options.enablePrefetchForZoom),this.tileProvider="Apple";var b={};a.attributions&&a.attributions.forEach(function(a){b[a.attributionId]=a});var c={};a.tileSources.forEach(function(a){var d=a.tileSource;c[d]={name:d,path:a.path,domains:a.domains,protocol:a.protocol||"https:",attribution:b[a.attributionId],minZoomLevel:a.minZoomLevel,maxZoomLevel:a.maxZoomLevel,supportedResolutions:a.supportedResolutions,showPrivacyLink:a.showPrivacyLink,showTermsOfUseLink:a.showTermsOfUseLink},a.needsLocationShift&&(this.tileProvider="AutoNavi"),c[d].attribution&&c[d].attribution.global&&(c[d].attribution.name=c[d].attribution.global[0].name,c[d].attribution.url=c[d].attribution.global[0].url)}.bind(this)),this.types={};for(var d in a.modes){var e=a.modes[d].layers;this.types[d]={name:d,lowResolutionTileSource:c[e[0].lowResTileSource],tileSources:e.map(function(a){return c[a.tileSource]})}}},_getBrowserLanguage:function(){return window.navigator.languages?window.navigator.languages[0]:window.navigator.language},_parseAcceptLanguage:function(a){var b=e.parseAcceptLanguage(a);return b?b[0].langTag.tag:null},_restore:function(){this.vendorKey=null,this._acceptLanguage=null,this._optionsLanguage=null,this.apiBaseUrl=null,this.bootstrapUrl=k,this.state=n.PENDING,delete this._language,this._listeners={}},_debugInfo:function(){var a={};return["ready","state","_countryCode","tileProvider","vendorKey","apiBaseUrl","language","_acceptLanguage","_optionsLanguage","_getBrowserLanguage","_loadFailures","supportsPrefetchingForPanning","supportsPrefetchingForZooming","types"].forEach(function(b){a[b]="function"==typeof this[b]?this[b]():this[b]},this),a}};h.EventTarget(o),b.exports=o},{"../build.json":43,"./language-support":70,"./localizer":74,"./requests/xhr-loader":91,"./utils":101,"dom-events":7}],54:[function(a,b,c){"use strict";function d(){}window.console||(window.console={log:d,warn:d,error:d,assert:d})},{}],55:[function(a,b,c){function d(a){i.call(this,a),h.classList.add(a,k.CONTROL)}function e(a){this._control=a}function f(a){this._control=a}function g(a){this._control=a}var h=a("../utils"),i=a("render-tree").Node,j=a("../localizer"),k={CONTROL:"mk-control",DISABLED:"mk-disabled",FOCUS:"mk-focus"};d.prototype=h.inheritPrototype(i,d,{constructor:d,_enabled:!1,hasFocus:!1,pageHasFocus:!1,isIE:!1,get enabled(){return this._enabled},set enabled(a){var b=!!a;this._enabled!==b&&(b?(this.isIE=h.isIEAndNotEdge(),h.classList.remove(this.element,k.DISABLED),this._createListeners(),this.element.addEventListener(h.touchstartOrMousedown,this._eventListener),this._addFocusAndBlurListeners(),this._addKeyboardListeners()):(h.classList.add(this.element,k.DISABLED),this.element.removeEventListener(h.touchstartOrMousedown,this._eventListener),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners()),this._enabled=b,this.reset())},willMoveToParent:function(a){a?this.parent||(this._createListeners(),j.addEventListener(j.Events.LocaleChanged,this._eventListener),this._addFocusAndBlurListeners(),this._addKeyboardListeners(),this.addEventListeners()):(j.removeEventListener(j.Events.LocaleChanged,this._eventListener),this.removeEventListeners(),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners(),this._destroyListeners())},blurFocusedElement:function(a){try{this.element.contains(document.activeElement)&&document.activeElement.blur()}catch(b){}},reset:function(){},touchesBegan:function(a){},touchesMoved:function(a){},touchesEnded:function(a){},touchesCancelled:function(a){},spaceBarKeyDown:function(a){},spaceBarKeyUp:function(a){},escapeKeyDown:function(a){},escapeKeyUp:function(a){},downArrowKeyUp:function(a){},upArrowKeyUp:function(a){},focused:function(a){},blurred:function(a){},pageDidFocus:function(a){},pageDidBlur:function(a){},updateTintColor:function(a){},removeEventListeners:function(){},addEventListeners:function(){},localeChanged:function(){},_createListeners:function(){this._eventListener||(this._eventListener=new e(this)),this._windowEventListener||(this._windowEventListener=new g(this)),this._cancelFocusEventListener||(this._cancelFocusEventListener=new f(this))},_destroyListeners:function(){this._eventListener&&(this._eventListener.destroy(),delete this._eventListener),this._windowEventListener&&(this._windowEventListener.destroy(),delete this._windowEventListener),this._cancelFocusEventListener&&(this._cancelFocusEventListener.destroy(),delete this._cancelFocusEventListener)},_addFocusAndBlurListeners:function(){this.element.addEventListener("focus",this._eventListener,!0),this.element.addEventListener("blur",this._eventListener,!0),this.isIE?(document.addEventListener("focusin",this._windowEventListener),document.addEventListener("focusout",this._windowEventListener)):(window.addEventListener("focus",this._windowEventListener),window.addEventListener("blur",this._windowEventListener))},_removeFocusAndBlurListeners:function(){this.element.removeEventListener("focus",this._eventListener,!0),this.element.removeEventListener("blur",this._eventListener,!0),this.isIE?(document.removeEventListener("focusin",this._windowEventListener),document.removeEventListener("focusout",this._windowEventListener)):(window.removeEventListener("focus",this._windowEventListener),window.removeEventListener("blur",this._windowEventListener))},_addKeyboardListeners:function(){this.element.addEventListener("keydown",this._eventListener),this.element.addEventListener("keyup",this._eventListener)},_removeKeyboardListeners:function(){this.element.removeEventListener("keydown",this._eventListener),this.element.removeEventListener("keyup",this._eventListener)}}),e.prototype={destroy:function(){delete this._control},handleEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this._touchesBegan(a);break;case"touchmove":case"mousemove":this._control.touchesMoved(a);break;case"touchend":case"mouseup":this._removeEventListeners(),this._control.touchesEnded(a);break;case"touchcancel":this._removeEventListeners(),this._control.touchesCancelled(a);break;case"keydown":this._keyDown(a);break;case"keyup":this._keyUp(a);break;case"focus":this._focus(a);break;case"blur":this._blur(a);break;case j.Events.LocaleChanged:this._control.localeChanged(a)}},_touchesBegan:function(a){a.preventDefault(),a.stopPropagation(),("mousedown"!==a.type||0===a.button&&!a.ctrlKey)&&(h.supportsTouches?(window.addEventListener("touchmove",this,!0),window.addEventListener("touchend",this,!0),window.addEventListener("touchcancel",this,!0)):(window.addEventListener("mousemove",this,!0),window.addEventListener("mouseup",this,!0)),this._control.touchesBegan(a))},_keyDown:function(a){switch(a.keyCode){case h.KeyCodes.Escape:this._control.escapeKeyDown(a);break;case h.KeyCodes.SpaceBar:a.preventDefault(),this._control.spaceBarKeyDown(a);break;case h.KeyCodes.DownArrow:a.preventDefault();break;case h.KeyCodes.UpArrow:a.preventDefault()}},_keyUp:function(a){switch(a.keyCode){case h.KeyCodes.Escape:this._control.escapeKeyUp(a);break;case h.KeyCodes.DownArrow:a.preventDefault(),this._control.downArrowKeyUp(a);break;case h.KeyCodes.UpArrow:a.preventDefault(),this._control.upArrowKeyUp(a);break;case h.KeyCodes.SpaceBar:a.preventDefault(),this._control.spaceBarKeyUp(a)}},_focus:function(a){this._control.hasFocus||(this._control.hasFocus=!0,h.classList.add(this._control.element,k.FOCUS),window.addEventListener(h.touchstartOrMousedown,this._control._cancelFocusEventListener,!0),this._control.focused(a))},_blur:function(a){this._control.hasFocus&&(this._control.hasFocus=!1,window.removeEventListener(h.touchstartOrMousedown,this._control._cancelFocusEventListener,!0),h.classList.remove(this._control.element,k.FOCUS),this._control.blurred(a))},_removeEventListeners:function(){h.supportsTouches?(window.removeEventListener("touchmove",this,!0),window.removeEventListener("touchend",this,!0),window.removeEventListener("touchcancel",this,!0)):(window.removeEventListener("mousemove",this,!0),window.removeEventListener("mouseup",this,!0))}},f.prototype={destroy:function(){delete this._control},handleEvent:function(a){this._control.blurFocusedElement(a)}},g.prototype={destroy:function(){delete this._control},handleEvent:function(a){var b=this._control.isIE;if(a.target instanceof Window||b)switch(a.type){case"focus":case"focusin":this._control.pageHasFocus||(this._control.pageHasFocus=!0,this._control.pageDidFocus(a));break;case"blur":case"focusout":(!b||b&&null===a.relatedTarget)&&(this._control.pageHasFocus=!1,this._control.pageDidBlur(a))}}},b.exports=d},{"../localizer":74,"../utils":101,"render-tree":28}],56:[function(a,b,c){function d(a){m.call(this,e.htmlElement("div",{"class":r})),this._map=a,this._logo=this.addChild(new f),this._topLeftControlsNode=this.addChild(new m(e.htmlElement("div",{"class":s}))),this._bottomRightControlsNode=this.addChild(new m(e.htmlElement("div",{"class":t}))),this._topRightControlsNode=this.addChild(new m(e.htmlElement("div",{"class":u}))),this._legalControl=this._bottomRightControlsNode.addChild(new g),this._controlsPending=!1,o.addEventListener(o.Events.LocaleChanged,this)}var e=a("../utils"),f=a("./logo"),g=a("./legal-control"),h=a("./map-type-control"),i=a("./zoom-control"),j=a("./user-location-control"),k=a("geometry/size"),l=a("render-tree"),m=a("render-tree").Node,n=a("../user-location/user-location"),o=a("../localizer"),p=a("geometry/rect"),q=new k(262,222),r="mk-controls-container",s="mk-top-left-controls-container",t="mk-bottom-right-controls-container",u="mk-top-right-controls-container",v="mk-shows-map-type-control";d.prototype=e.inheritPrototype(m,d,{_rtl:!1,get controlsPending(){return this._controlsPending},mapPaddingDidChange:function(){var a=this._map.padding,b=this.element.style;b.top=a.top+"px",b.left=a.left+"px",b.bottom=a.bottom+"px",b.right=a.right+"px",this.sizeDidChange()},sizeDidChange:function(){var a=this._shouldHideControls();this._toggleControl(this._map.showsZoomControl&&!a,this._zoomControl,this.updateZoomControl),this._toggleControl(this._map.showsMapTypeControl&&!a,this._mapTypeControl,this.updateMapTypeControl),this._toggleControl(this._map.showsUserLocationControl&&!a,this._userLocationControl,this.updateUserLocationControl)},zoomLevelDidChange:function(){this._zoomControl&&(this._zoomControl.zoomOutEnabled=this._map._zoomLevel!==this._map._minZoomLevel,this._zoomControl.zoomInEnabled=this._map._zoomLevel!==this._map._maxZoomLevel)},update:function(){this._map&&(this._setPendingControls(),this._shouldHideControls()?(this._removeZoomControl(),this._removeMapTypeControl(),this._removeUserLocationControl()):(this.updateZoomControl(),this.updateMapTypeControl(),this.updateUserLocationControl()),this._logo.updateWithMapType(this._map.mapType),this._legalControl.updateWithMapType(this._map.mapType),this._legalControl.updateTintColor(this._map.tintColor))},updateZoomControl:function(){this._map.showsZoomControl&&!this._shouldHideControls()?(this._addZoomControl(),this._updatePlacementOfTopControl(this._zoomControl,this._map._zoomControlPlacement,this._userLocationControl),this._zoomControl.enabled=this._map._zoomable,this._zoomControl.zoomOutEnabled=this._map._zoomLevel!==this._map._minZoomLevel,this._zoomControl.zoomInEnabled=this._map._zoomLevel!==this._map._maxZoomLevel,this._zoomControl.placement=this._map._zoomControlPlacement,this._zoomControl.updateTintColor(this._map.tintColor)):this._removeZoomControl()},updateMapTypeControl:function(){this._map._showsMapTypeControl&&!this._shouldHideControls()?(this._addMapTypeControl(),this._mapTypeControl.mapType=this._map.mapType,this._mapTypeControl.enabled=!0,this._mapTypeControl.updateTintColor(this._map.tintColor)):this._removeMapTypeControl()},updateUserLocationControl:function(){if(this._map._showsUserLocationControl&&!this._shouldHideControls()){switch(this._addUserLocationControl(),this._userLocationControl.enabled=!0,this._updatePlacementOfTopControl(this._userLocationControl,this._map._userLocationControlPlacement),this._userLocationControl.placement=this._map._userLocationControlPlacement,this._userLocationControl.state){case j.States.Default:this._map.tracksUserLocation&&this._userLocationControl.toWaitingState();break;case j.States.Waiting:n&&(n.errorCode>0?this._userLocationControl.toDefaultState():n.location&&this._userLocationControl.toTrackingState());break;case j.States.Tracking:this._map.tracksUserLocation||this._userLocationControl.toDefaultState()}this._userLocationControl.updateTintColor(this._map.tintColor)}else this._removeUserLocationControl()},devicePixelRatioDidChange:function(a){this._userLocationControl&&this._userLocationControl.updateIcons(a.value)},handleEvent:function(a){switch(a.type){case h.EVENTS.MAPTYPE_CHANGE:this._mapTypeControl&&(this._map.mapType=this._mapTypeControl.mapType);break;case"focus":this._legalControl.element.contains(a.target)?(this._mapTypeControl._clearPressedState(),this._mapTypeControl._shouldFocusOnClose=!1,this._mapTypeControl._close()):this._mapTypeControl.element.contains(a.target)&&this._legalControl._close();break;case o.Events.LocaleChanged:this._handleLocaleChanged(a);break;case"update":this._unsetPendingControls(),this._map._addWaitingAnnotations()}},mapWasDestroyed:function(){this._unsetPendingControls(),o.removeEventListener(o.Events.LocaleChanged,this),this._destroyZoomControl(),this._destroyMapTypeControl(),this._destroyUserLocationControl(),this._legalControl.remove(),delete this._legalControl,this._logo.remove(),delete this._logo,this.remove(),delete this._map},_handleLocaleChanged:function(a){this._rtl!==a.locale.rtl&&(this._rtl=a.locale.rtl,this._rtlChanged=!0,this.update(),this._rtlChanged=!1)},_updatePlacementOfTopControl:function(b,c,d){if(b.placement!==c||this._rtlChanged){this._setPendingControls();var e,f=a("../map");e=c===f.ControlsPlacement.Standard?this._rtl?this._topRightControlsNode:this._topLeftControlsNode:this._rtl?this._topLeftControlsNode:this._topRightControlsNode,e.insertBefore(b,d)}},_addZoomControl:function(){!this._map.showsZoomControl||this._zoomControl||this._shouldHideControls()||(this._setPendingControls(),this._zoomControl=new i,this._zoomControl.enabled=this._zoomable,this._zoomControl.addEventListener(i.EVENTS.ZOOM_START,this._map),this._zoomControl.addEventListener(i.EVENTS.ZOOM_END,this._map))},_removeZoomControl:function(){!this._shouldHideControls()&&this._map.showsZoomControl||!this._zoomControl||(this._setPendingControls(),this._zoomControl.enabled=!1,this._destroyZoomControl())},_destroyZoomControl:function(){this._zoomControl&&(this._zoomControl.removeEventListener(i.EVENTS.ZOOM_START,this._map),this._zoomControl.removeEventListener(i.EVENTS.ZOOM_END,this._map),this._zoomControl.remove(),delete this._zoomControl)},_addMapTypeControl:function(){!this._map.showsMapTypeControl||this._mapTypeControl||this._shouldHideControls()||(this._setPendingControls(),this._mapTypeControl=this._bottomRightControlsNode.addChild(new h(a("../map").MapTypes,this._map.mapType)),this._mapTypeControl.addEventListener(h.EVENTS.MAPTYPE_CHANGE,this),this._bottomRightControlsNode.element.addEventListener("focus",this,!0),e.classList.add(this._bottomRightControlsNode.element,v))},_removeMapTypeControl:function(){this._mapTypeControl&&(this._setPendingControls(),this._mapTypeControl.enabled=!1,this._destroyMapTypeControl(),e.classList.remove(this._bottomRightControlsNode.element,v))},_destroyMapTypeControl:function(){this._mapTypeControl&&(this._mapTypeControl.removeEventListener(h.EVENTS.MAPTYPE_CHANGE,this),this._mapTypeControl.remove(),delete this._mapTypeControl,this._bottomRightControlsNode.element.removeEventListener("focus",this,!0))},_toggleControl:function(a,b,c){(b&&!a||!b&&a)&&c.call(this)},_shouldHideControls:function(){var a=this._map._ensureVisibleFrame().size;return a.width<q.width||a.height<q.height},_addUserLocationControl:function(){!this._map.showsUserLocationControl||this._userLocationControl||this._shouldHideControls()||(this._setPendingControls(),this._userLocationControl=new j,this._userLocationControl.addEventListener(j.EVENTS.STATE_CHANGE,this._map))},_removeUserLocationControl:function(){!this._shouldHideControls()&&this._map.showsUserLocationControl||!this._userLocationControl||(this._setPendingControls(),this._destroyUserLocationControl())},_destroyUserLocationControl:function(){this._userLocationControl&&(this._userLocationControl.removeEventListener(j.EVENTS.STATE_CHANGE,this._map),this._userLocationControl.remove(),delete this._userLocationControl)},_setPendingControls:function(){this._controlsPending=!0,l.addEventListener("update",this)},_unsetPendingControls:function(){this._controlsPending=!1,l.removeEventListener("update",this)},controlBounds:function(){return this.children.filter(function(a){return a.children.length>0}).map(function(a){try{return p.rectFromClientRect(a.element.getBoundingClientRect())}catch(b){return new p}})}}),b.exports=d},{"../localizer":74,"../map":75,"../user-location/user-location":100,"../utils":101,"./legal-control":57,"./logo":58,"./map-type-control":59,"./user-location-control":60,"./zoom-control":61,"geometry/rect":10,"geometry/size":11,"render-tree":28}],57:[function(a,b,c){function d(){var a=j.htmlElement("div",{"class":p.CONTROL});this._elLegal=a.appendChild(j.htmlElement("div",{"class":p.LEGAL,role:"button",tabindex:0})),this._elLegal.textContent=n.get("Legal.Label"),l.call(this,a);var b=j.htmlElement("div",{"class":p.LEGAL_INFO,"aria-hidden":!0});this._legalInfoNode=new m.Node(b);var c=b.appendChild(j.htmlElement("div",{"class":p.LEGAL_INFO_CONTAINER}));this._elCloseButton=j.htmlElement("div",{"class":p.CLOSE,role:"button"},h()),c.appendChild(j.htmlElement("header")).appendChild(this._elCloseButton),this._elInfoItems=c.appendChild(j.htmlElement("div",{"class":p.LEGAL_INFO_ITEMS,role:"menu"})),this.enabled=!0,this._updateAccessibilityState()}function e(a,b){var c=g(a);return c.textContent=n.get(b),c}function f(a,b,c){var d,e,f=g(a);return j.classList.add(f,p.LEGAL_ATTRIBUTION_ITEM),c?(d='<img width="68" height="22" class="mk-attribution-logo" src="'+j.imagePathForDevice([1,2,3],o.createImageUrl("legal/tomtom"))+'" alt="TomTom">',e=j.htmlElement("span",{"class":"mk-right-caret"},i()),f.innerHTML=n.get("Legal.Attribution.HTML.Label",{logo:d,chevron:e.outerHTML})):f.textContent=n.get("Legal.Attribution.Plain.Label",{attribution:b}),f}function g(a){var b=j.htmlElement("div",{"class":p.LEGAL_INFO_ITEM,role:"menuitem",tabindex:-1});return a&&b.setAttribute(q.MAP_ATTRIBUTION_URL,a),b}function h(){return j.createSVGIcon(j.svgElement("path",{d:"M6.20710678,5.5 L10.3535534,9.6464466 L9.6464466,10.3535534 L5.5,6.20710678 L1.35355339,10.3535534 L0.646446609,9.64644661 L4.79289322,5.5 L0.646446602,1.35355338 L1.35355338,0.646446602 L5.5,4.79289322 L9.64644661,0.646446609 L10.3535534,1.35355339 L6.20710678,5.5 Z"}),{viewBox:"0 0 11 11"})}function i(){return j.createSVGIcon(j.svgElement("path",{d:"M1,1 L5,4.5 L1,7.5"}),{viewBox:"0 0 7 9"})}var j=a("../utils"),k=a("../configuration"),l=a("./control"),m=a("render-tree"),n=a("../localizer"),o=a("../urls");b.exports=d;var p={CONTROL:"mk-legal-controls",OPEN:"mk-open",CLOSE:"mk-close",DIVIDER:"mk-divider",LEGAL:"mk-legal",
LEGAL_SATELLITE:"mk-legal-satellite",LEGAL_INFO:"mk-legal-info",LEGAL_INFO_CONTAINER:"mk-legal-info-container",LEGAL_INFO_ITEMS:"mk-legal-info-items",LEGAL_INFO_ITEM:"mk-legal-info-item",LEGAL_ATTRIBUTION_ITEM:"mk-legal-attribution-item",PRESSED:"mk-pressed"},q={MAP_ATTRIBUTION_URL:"data-map-attribution-url"};d.prototype=j.inheritPrototype(l,d,{_isOpen:!1,_shouldFocusOnLegalButton:!1,_canShowFocusOutline:!0,_hadFocusOutline:!1,_pageLostFocus:!1,updateWithMapType:function(b){var c=a("../map");if(k.ready){this.mapType=b,this._elLegal.className=p.LEGAL,this._elLegal.textContent=n.get("Legal.Label"),this._elLegal.removeAttribute(q.MAP_ATTRIBUTION_URL),b!==c.MapTypes.Standard&&j.classList.add(this._elLegal,p.LEGAL_SATELLITE),this._elCloseButton.setAttribute("aria-label",n.get("Legal.Menu.Close.Label"));var d=k.types[this.mapType].tileSources[0];d.showTermsOfUseLink||d.showPrivacyLink?(this.updateLegalInfo(d),this.addChild(this._legalInfoNode)):(this._elLegal.setAttribute(q.MAP_ATTRIBUTION_URL,d.attribution&&d.attribution.url),this._legalInfoNode.remove()),this._updateAccessibilityState()}},updateLegalInfo:function(a){console.assert(a);var b=[];if(this._elInfoItems.innerHTML="",a.showTermsOfUseLink&&b.push(e(n.get("Legal.TermsOfUse.URL"),"Legal.TermsOfUse.Label")),a.showPrivacyLink&&b.push(e(n.get("Legal.Privacy.URL"),"Legal.Privacy.Label")),a.attribution){var c=a.attribution.url,d=a.attribution.name,g=a.attribution.name===k.TILE_SOURCES.TOMTOM;b.push(f(c,d,g))}b.forEach(function(a,c){this._elInfoItems.appendChild(a),c<b.length-1&&this._elInfoItems.appendChild(j.htmlElement("div",{"class":p.DIVIDER}))},this)},handleEvent:function(a){switch(a.type){case j.transitionend:this._handleTransitionend(a);break;case j.touchstartOrMousedown:this._isOpen&&!this.element.contains(a.target)&&this._close()}},localeChanged:function(a){this.mapType&&(this.updateWithMapType(this.mapType),this.updateTintColor(this.tintColor))},touchesBegan:function(a){this._setPressedElement(a.target)},touchesMoved:function(a){if(this._isOpen&&this._isDown){var b=j.parentNodeForSvgTarget(a.target);this._clearPressedElement(),this._setPressedElement(b)}},touchesEnded:function(a){this._pressed(a)},spaceBarKeyDown:function(a){this._setPressedElement(a.target)},spaceBarKeyUp:function(a){this._pressed(a)},escapeKeyDown:function(a){this._isOpen&&(this._shouldFocusOnLegalButton=!0,this._canShowFocusOutline=!0,this._close())},focused:function(a){if(this._isOpen&&a.target===this._elLegal)return this._shouldFocusOnLegalButton=!0,void this._close();var b=this._canShowFocusOutline&&!this._pageLostFocus||this._canShowFocusOutline&&this._pageLostFocus&&this._hadFocusOutline;this._hadFocusOutline=b,j.classList.toggle(this.element,"mk-focus",b),this._isDown&&b&&(this._clearPressedElement(),this._setPressedElement(a.target))},pageDidFocus:function(a){setTimeout(function(){delete this._pageLostFocus}.bind(this),0)},pageDidBlur:function(a){this._pageLostFocus=!0,l.prototype.blurFocusedElement.call(this,a),this._close()},blurFocusedElement:function(a){l.prototype.blurFocusedElement.call(this,a),this._isOpen&&!this.element.contains(a.target)&&this._close()},updateTintColor:function(a){if(this.tintColor=a,this._elInfoItems)for(var b=this._elInfoItems.querySelectorAll("."+p.LEGAL_INFO_ITEM+":not(."+p.LEGAL_ATTRIBUTION_ITEM+")"),c=0;c<b.length;c++)b[c].style.color=a},reset:function(){this._close()},_open:function(){window.addEventListener(j.touchstartOrMousedown,this,!0),this._legalInfoNode.element.addEventListener("transitionend",this),j.classList.add(this._legalInfoNode.element,p.OPEN),this._isOpen=!0,j.isIE9()&&this._handleTransitionend()},_close:function(){this._isOpen=!1,this._updateAccessibilityState(),window.removeEventListener(j.touchstartOrMousedown,this,!0),j.classList.remove(this._legalInfoNode.element,p.OPEN),j.isIE9()&&this._handleTransitionend()},_tabbable:function(){for(var a=this.element.querySelectorAll("."+p.LEGAL_INFO_ITEM),b=0;b<a.length;b++)a[b].setAttribute("tabindex",this._isOpen?0:-1);this._elCloseButton.setAttribute("tabindex",this._isOpen?0:-1)},_pressed:function(a){var b=j.parentNodeForSvgTarget(a.target),c="keyup"===a.type&&a.keyCode===j.KeyCodes.SpaceBar;delete this._isDown,this._clearPressedElement(),j.classList.contains(b,"mk-attribution-logo")&&(b=b.parentNode),b.getAttribute(q.MAP_ATTRIBUTION_URL)?window.open(b.getAttribute(q.MAP_ATTRIBUTION_URL)):j.classList.contains(b,p.CLOSE)?(this._shouldFocusOnLegalButton=!0,this._canShowFocusOutline=c,this._elCloseButton.blur(),this._close()):j.classList.contains(this._legalInfoNode.element,p.OPEN)||(this._canShowFocusOutline=c,this._open())},_handleTransitionend:function(a){this._isOpen?(this._updateAccessibilityState(),this._elLegal.blur(),this._elInfoItems.children.item(0).focus()):(this._legalInfoNode.element.removeEventListener("transitionend",this),this._shouldFocusOnLegalButton&&this._elLegal.focus(),this._shouldFocusOnLegalButton=!1),j.isIEAndNotEdge()?setTimeout(function(){this._canShowFocusOutline=!0}.bind(this),0):this._canShowFocusOutline=!0},_updateAccessibilityState:function(){this._legalInfoNode.parent?(this._elLegal.setAttribute("aria-haspopover",!0),this._elLegal.setAttribute("aria-expanded",this._isOpen),this._legalInfoNode.element.setAttribute("aria-hidden",!this._isOpen),this._tabbable()):(this._elLegal.removeAttribute("aria-haspopover"),this._elLegal.removeAttribute("aria-expanded"))},_setPressedElement:function(a){a=j.parentNodeForSvgTarget(a),this._isDown=!0,this._clearPressedElement(),(j.classList.contains(a,p.LEGAL_INFO_ITEM)||j.classList.contains(a,p.CLOSE))&&j.classList.add(a,p.PRESSED)},_clearPressedElement:function(){var a=this.element.querySelector("."+p.PRESSED);a&&j.classList.remove(a,p.PRESSED)}})},{"../configuration":53,"../localizer":74,"../map":75,"../urls":98,"../utils":101,"./control":55,"render-tree":28}],58:[function(a,b,c){function d(){this._logoElement=e.htmlElement("img",{"class":n.LOGO}),h.call(this,e.htmlElement("div",{"class":n.CONTROL},this._logoElement)),i.addEventListener(i.Events.LocaleChanged,this)}var e=a("../utils"),f=a("../configuration"),g=a("../urls"),h=a("render-tree").Node,i=a("../localizer");b.exports=d;var j=g.createImageUrl("logos/logo"),k="satellite",l="autonavi",m="rtl",n={CONTROL:"mk-logo-control",LOGO:"mk-logo",LOGO_AUTONAVI:"mk-logo-autonavi"};d.prototype=e.inheritPrototype(h,d,{updateWithMapType:function(b){var c=a("../map"),d=b.toLowerCase()===c.MapTypes.Standard;this.mapType=b,this._logoElement.className=n.LOGO;var g=[j];"AutoNavi"===f.tileProvider&&(e.classList.add(this._logoElement,n.LOGO_AUTONAVI),g.push(l)),d||g.push(k),this.rtl&&g.push(m),this._logoElement.src=e.imagePathForDevice([1,2,3],g.join("-")),this._logoElement.setAttribute("alt",i.get("Logo."+f.tileProvider+".Tooltip"))},handleEvent:function(a){switch(a.type){case i.Events.LocaleChanged:this.rtl=a.locale.rtl,this._handleLocaleChange(a)}},_handleLocaleChange:function(a){this.mapType&&this.updateWithMapType(this.mapType)}})},{"../configuration":53,"../localizer":74,"../map":75,"../urls":98,"../utils":101,"render-tree":28}],59:[function(a,b,c){function d(a,b){j.call(this,i.htmlElement("div",{"class":q.CONTROL})),k.EventTarget(this),this._caretIcon=e(),this._checkmarkIcon=f();for(var c in a){var d=new l.Node(i.htmlElement("div",{"class":q.MAP_TYPE})),g="Mode."+c;d.element.setAttribute(o.MAP_TYPE,a[c]),d.element.setAttribute(o.L10N,g),d.element.textContent=m.get(g),a[c]===b&&(this._mapType=b,this._updateActiveNode(d)),this.addChild(d)}this._updateAccessibilityState(),this.enabled=!0}function e(){return i.createSVGIcon(i.svgElement("path",{d:"M1,1 L4.5,4.5 L8,1"}),{viewBox:"0 0 9 6"})}function f(){return i.createSVGIcon(i.svgElement("path",{d:"M3.76776695,8.47487373 L3.41421356,8.82842712 L2.70710678,8.12132034 L0.707106781,6.12132034 L0,5.41421356 L1.41421356,4 L2.12132034,4.70710678 L3.41421356,6 L8.70710678,0.707106781 L9.41421356,0 L10.8284271,1.41421356 L10.1213203,2.12132034 L4.12132034,8.12132034 L3.76776695,8.47487373 Z"}),{viewBox:"0 0 11 9"})}function g(a){a.focus(),a.setAttribute("tabindex",0),a.setAttribute("aria-checked",!0)}function h(a){a.blur(),a.setAttribute("tabindex",-1),a.setAttribute("aria-checked",!1)}var i=a("../utils"),j=a("./control"),k=a("dom-events"),l=a("render-tree"),m=a("../localizer"),n=a("../analytics/analytics");b.exports=d;var o={MAP_TYPE:"data-map-type",L10N:"data-l10n-key"},p=200,q={CONTROL:"mk-map-type-control",MAP_TYPES:"mk-map-types",MAP_TYPE:"mk-map-type",ACTIVE:"mk-active",PRESSED:"mk-pressed",OPEN:"mk-open",OPENING:"mk-opening",FOCUS:"mk-focus",SHOW_FOCUS:"mk-show-focus"};d.EVENTS={MAPTYPE_CHANGE:"map-type-change"},d.prototype=i.inheritPrototype(j,d,{constructor:d,_transitioning:!1,_shouldFocusOnClose:!0,_canShowFocusOutline:!0,_hadFocusOutline:!1,_pageLostFocus:!1,_activeMapTypeNode:null,_activeIcon:null,get mapType(){return this._mapType},set mapType(a){a!==this._mapType&&(this._mapType=a,this._updateDisplay(),this.dispatchEvent(new k.Event(d.EVENTS.MAPTYPE_CHANGE)),n.log("MAP_OPTIONS_"+a.toUpperCase()))},handleEvent:function(a){switch(a.type){case i.touchstartOrMousedown:this.element.contains(a.target)?this._shouldFocusOnClose=!0:(this._shouldFocusOnClose=!1,this._close());break;case i.transitionend:this._handleTransitionend(a)}},localeChanged:function(a){this.children.forEach(function(a){key=a.element.getAttribute(o.L10N),a.element.textContent=m.get(key)}),this._updateActiveIcon()},touchesBegan:function(a){if(!this._transitioning){var b=i.parentNodeForSvgTarget(a.target);this._updatePressedMapType(b),this._clearOutline(),this._isDown=!0,this._canShowFocusOutline=!1,this._open()}},touchesMoved:function(a){if(this._isOpen&&this._isDown){var b=i.parentNodeForSvgTarget(a.target);this._updatePressedMapType(b)}},touchesEnded:function(a){var b=i.parentNodeForSvgTarget(a.target);if(a.stopPropagation(),this._isDown=!1,this._clearPressedState(),Date.now()-this._openTime<p)return void(this._openTime=0);if(this._isOpen&&!this._transitioning){this._shouldFocusOnClose=!0,this._canShowFocusOutline=!1;var c=b.getAttribute(o.MAP_TYPE);c&&(this.mapType=c),this.reset()}},touchesCancelled:function(a){this.reset()},spaceBarKeyDown:function(a){var b=i.parentNodeForSvgTarget(a.target);this._isOpen||(b=this._activeMapTypeNode.element),this._updatePressedMapType(b),this._isDown=!0},spaceBarKeyUp:function(a){var b=i.parentNodeForSvgTarget(a.target);this._isDown=!1,this._clearPressedState(),this._isOpen&&i.classList.contains(b,q.MAP_TYPE)?(this.mapType=b.getAttribute(o.MAP_TYPE),this.resetWithFocusOutline()):this._isOpen||(this._canShowFocusOutline=!0,this._open())},escapeKeyDown:function(a){this._isOpen&&this.resetWithFocusOutline()},downArrowKeyUp:function(a){this._handleUpAndDownArrows("down")},upArrowKeyUp:function(a){this._handleUpAndDownArrows("up")},focused:function(a){var b=i.parentNodeForSvgTarget(a.target),c=this._canShowFocusOutline&&!this._pageLostFocus||this._canShowFocusOutline&&this._pageLostFocus&&this._hadFocusOutline;this._hadFocusOutline=c,i.classList.toggle(this.element,q.SHOW_FOCUS,c),this._outlinedMapTypeNode||(this._outlinedMapTypeNode=this._activeMapTypeNode),g(this._outlinedMapTypeNode.element),this._isDown&&c&&this._updatePressedMapType(b)},pageDidFocus:function(a){setTimeout(function(){this._pageLostFocus=!1}.bind(this),0)},pageDidBlur:function(a){this._pageLostFocus=!0,this._clearPressedState(),this._close()},updateTintColor:function(a){this.tintColor=a,this._activeMapTypeNode.element.style.color=this.tintColor,this._checkmarkIcon.style.fill=this.tintColor,this._caretIcon.style.stroke=this.tintColor,this._activeIcon.style[this._isOpen?"fill":"stroke"]=this.tintColor},reset:function(){this._close()},resetWithFocusOutline:function(){this._shouldFocusOnClose=!0,this._canShowFocusOutline=!0,this.reset()},removeEventListeners:function(){this.element.removeEventListener(i.transitionend,this)},addEventListeners:function(){this.element.addEventListener(i.transitionend,this)},_open:function(){this._isOpen||(window.addEventListener(i.touchstartOrMousedown,this,!0),this._isOpen=!0,this._openTime=Date.now(),this._transitioning=!0,i.classList.add(this.element,q.OPEN),this._updateActiveIcon(),i.isIE9()?this._handleTransitionend():i.classList.add(this.element,q.OPENING))},_close:function(){this._isOpen&&(window.removeEventListener(i.touchstartOrMousedown,this,!0),delete this._isOpen,delete this._isDown,delete this._openTime,this._transitioning=!0,i.classList.remove(this.element,q.OPEN),this._updateActiveIcon(),i.isIE9()&&this._handleTransitionend(),this._clearOutline())},_updateDisplay:function(){this.localeChanged();var a=this.findNode(function(a){return a.element.getAttribute(o.MAP_TYPE)===this._mapType},this);a&&(this._updateActiveNode(a),this._updateAccessibilityState())},_updateActiveNode:function(a){a!==this._activeMapTypeNode&&(this._activeMapTypeNode&&(this._activeMapTypeNode.element.style.removeProperty("color"),i.classList.remove(this._activeMapTypeNode.element,q.ACTIVE)),this._activeMapTypeNode=a,i.classList.add(a.element,q.ACTIVE),this._updateActiveIcon())},_updateActiveIcon:function(){return this._activeIcon&&this._activeIcon.parentNode&&this._activeIcon.parentNode.removeChild(this._activeIcon),this._activeMapTypeNode?(this._activeIcon=this._isOpen?this._checkmarkIcon:this._caretIcon,void this._activeMapTypeNode.element.appendChild(this._activeIcon)):void(this._activeIcon=null)},_updatePressedMapType:function(a){this._clearPressedState(),i.classList.contains(a,q.MAP_TYPE)&&i.classList.add(a,q.PRESSED)},_handleLocaleChange:function(){this.children.forEach(function(a){key=a.element.getAttribute(o.L10N),a.element.textContent=m.get(key)}),this._updateActiveIcon()},_handleTransitionend:function(){this._updateAccessibilityState(),this._focusWhenClosed(),this.updateTintColor(this.tintColor),this._isOpen&&this._activeMapTypeNode&&g(this._activeMapTypeNode.element),delete this._transitioning,i.isIEAndNotEdge()?setTimeout(function(){this._canShowFocusOutline=!0}.bind(this),0):this._canShowFocusOutline=!0},_handleUpAndDownArrows:function(a){if(this._isOpen){var b=this.children.indexOf(this._outlinedMapTypeNode||this._activeMapTypeNode);i.classList.contains(this.element,q.SHOW_FOCUS)?index="up"===a?Math.max(0,b-1):Math.min(b+1,this.children.length-1):(index=b,this._canShowFocusOutline=!0),this._clearOutline(),this._outlinedMapTypeNode=this.children[index],g(this._outlinedMapTypeNode.element)}},_clearOutline:function(){this._outlinedMapTypeNode&&(h(this._outlinedMapTypeNode.element),this._outlinedMapTypeNode=null)},_clearPressedState:function(){this._clearState(q.PRESSED)},_clearState:function(a){var b=this.findNode(function(b){return i.classList.contains(b.element,a)});b&&i.classList.remove(b.element,a)},_focusWhenClosed:function(){this._isOpen?i.classList.remove(this.element,q.OPENING):(this._shouldFocusOnClose&&this.element.focus(),this._shouldFocusOnClose=!1)},_updateAccessibilityState:function(){this._isOpen?(this.element.setAttribute("role","menu"),this.element.setAttribute("aria-expanded",!0),this.element.setAttribute("tabindex",-1)):(this.element.setAttribute("role","button"),this.element.setAttribute("aria-expanded",!1),this.element.setAttribute("tabindex",0)),this.children.forEach(function(a){var b=i.classList.contains(a.element,q.ACTIVE);a.element.setAttribute("tabindex",b?0:-1),a.element.setAttribute("aria-checked",b),this._isOpen?(a.element.setAttribute("role","menuitem"),a.element.removeAttribute("aria-hidden")):(a.element.removeAttribute("role"),b||a.element.setAttribute("aria-hidden",!0))},this)}})},{"../analytics/analytics":44,"../localizer":74,"../utils":101,"./control":55,"dom-events":7,"render-tree":28}],60:[function(a,b,c){function d(){h.call(this,g.htmlElement("div",{"class":n.CONTROL,role:"button",tabindex:"0"})),i.EventTarget(this),this._arrowIconNode=new k.Node(e()),this._waitingIconNode=new k.Node(f()),this.element.appendChild(this._arrowIconNode.element),this.element.appendChild(this._waitingIconNode.element),this._updateLabels(),this.updateIcons(g.devicePixelRatio)}function e(){var a=g.svgElement("path"),b=g.createSVGIcon(a);return a.parentNode.appendChild(g.svgElement("path")),b.setAttribute("class",b.getAttribute("class")+" "+n.ARROW_ICON),b}function f(){var a=g.svgElement("path");a.setAttribute("d","M14.5732357,10 C13.5436447,12.9129809 10.7655471,15 7.5,15 C3.35786438,15 0,11.6421356 0,7.5 C0,3.35786438 3.35786438,0 7.5,0 C10.7655471,0 13.5436447,2.08701907 14.5732357,5 L13.5018367,5 C12.522277,2.65104815 10.20395,1 7.5,1 C3.91014913,1 1,3.91014913 1,7.5 C1,11.0898509 3.91014913,14 7.5,14 C10.20395,14 12.522277,12.3489518 13.5018367,10 L14.5732357,10 L14.5732357,10 Z");var b=g.createSVGIcon(a,{viewBox:"0 0 15 15"});return b.setAttribute("class",b.getAttribute("class")+" "+n.WAITING_ICON),b}var g=a("../utils"),h=a("./control"),i=a("dom-events"),j=a("../localizer"),k=a("render-tree");b.exports=d;var l=14,m={"1x":["M0,6 L8,6 L8,14 L14,0 Z","M3.65,5.25 L8.75,5.25 L8.75,10.35 L12.6,1.4 Z"],"2x":["M0,12 L16,12 L16,28 L28,0 Z","M7.3,10.5 L17.5,10.5 L17.5,20.7 L25.2,2.8 Z"],"3x":["M0,18 L24,18 L24,42 L42,0 Z","M10.95,15.75 L26.25,15.75 L26.25,31.05 L37.8,4.2 Z"]},n={CONTROL:"mk-user-location-control",BUTTON_USER_LOCATION:"mk-user-location-button",PRESSED:"mk-pressed",TRACKING:"mk-tracking",WAITING:"mk-waiting",WAITING_ICON:"mk-icon-waiting",ARROW_ICON:"mk-icon-arrow",OPPOSITE_PLACEMENT:"mk-placement-opposite"};d.States={Default:"default",Waiting:"waiting",Tracking:"tracking"},d.EVENTS={STATE_CHANGE:"state-change"},d.prototype=g.inheritPrototype(h,d,{_state:d.States.Default,_tintColor:"",_arrowIconDurationMs:200,_waitingIconDurationMs:200,_waitingIconCycleTimeMs:1500,get placement(){return this._placement},set placement(b){if(this._placement!==b){this._placement=b;var c=a("../map");g.classList.toggle(this.element,n.OPPOSITE_PLACEMENT,b===c.ControlsPlacement.Opposite)}},get state(){return this._state},set state(a){this._state!==a&&(this._state=a,g.classList.toggle(this.element,n.TRACKING,this.isTrackingState()),g.classList.toggle(this.element,n.WAITING,this.isWaitingState()),this.updateTintColor(this.tintColor),!this.isWaitingState()&&this._waitingIconInStart&&(this._waitingIconOutStart=Date.now(),this._waitingIconNode.scheduleUpdate(this)),this.isWaitingState()&&(this._arrowIconOutStart=Date.now(),this._arrowIconNode.scheduleUpdate(this)),this.dispatchEvent(new i.Event(d.EVENTS.STATE_CHANGE)))},isDefaultState:function(){return this.state===d.States.Default},toDefaultState:function(){this.state=d.States.Default},isTrackingState:function(){return this.state===d.States.Tracking},toTrackingState:function(){this.state=d.States.Tracking},isWaitingState:function(){return this.state===d.States.Waiting},toWaitingState:function(){this.state=d.States.Waiting},touchesBegan:function(a){this._pressed(a)},touchesEnded:function(a){this.reset()},touchesCancelled:function(a){this.reset()},spaceBarKeyDown:function(a){this._pressed(a)},spaceBarKeyUp:function(a){this.reset(a)},updateTintColor:function(a){this._tintColor=a,this._arrowIconNode.element.querySelector("g").style.fill=this.isTrackingState()?"":a,this._waitingIconNode.element.querySelector("g").style.fill=a,this.element.style.backgroundColor=this.isTrackingState()?a:""},updateIcons:function(a){a=a||1;var b=l*a;this._arrowIconNode.element.setAttribute("viewBox",[0,0,b,b].join(" "));for(var c=this._arrowIconNode.element.querySelectorAll("path"),d=0,e=c.length;e>d;++d)c[d].setAttribute("d",m[a+"x"][d])},reset:function(){var a=g.classList.contains(this.element,n.PRESSED);a&&(g.classList.remove(this.element,n.PRESSED),this.isTrackingState()?this.toDefaultState():this.toWaitingState()),delete this._mousedown,window.removeEventListener(g.touchendOrMouseup,this),g.supportsTouches&&window.removeEventListener("touchcancel",this)},localeChanged:function(a){this._updateLabels()},updateNode:function(){this._arrowIconOutStart&&this._animateArrowIconOut(),this._waitingIconInStart&&this._animateWaitingIconIn(),this._waitingIconOutStart&&this._animateWaitingIconOut(),this._waitingIconSpinStart&&this._animateWaitingIconSpin()},_updateLabels:function(){var a=j.get("Track.User.Location.Tooltip");this.element.setAttribute("title",a),this.element.setAttribute("aria-label",a)},_pressed:function(a){var b=g.parentNodeForSvgTarget(a.target);g.classList.add(b,n.PRESSED)},_animateArrowIconOut:function(){var a=Math.min((Date.now()-this._arrowIconOutStart)/this._arrowIconDurationMs,1),b=Math.max(0,1-a);this._arrowIconNode.opacity=b,this._arrowIconNode.transform="scale("+b+")",this.isWaitingState()&&!this._waitingIconInStart&&a>.15&&(this._waitingIconInStart=Date.now(),this._waitingIconNode.scheduleUpdate(this)),this.isWaitingState()||(delete this._arrowIconOutStart,this._arrowIconNode.opacity=1,this._arrowIconNode.transform="scale(1)"),1>a?this._arrowIconNode.scheduleUpdate(this):delete this._arrowIconOutStart},_animateWaitingIconIn:function(){var a=Math.min((Date.now()-this._waitingIconInStart)/this._waitingIconDurationMs,1),b=Math.min(1,a);this._waitingIconNode.opacity=b,this._waitingIconNode.transform="scale("+b+")",1>a?this._waitingIconNode.scheduleUpdate(this):(delete this._waitingIconInStart,this.isWaitingState()&&(this._waitingIconSpinStart=Date.now(),this._waitingIconNode.scheduleUpdate(this)))},_animateWaitingIconOut:function(){var a=Math.min((Date.now()-this._waitingIconOutStart)/this._waitingIconDurationMs,1),b=Math.max(0,1-a);this._waitingIconNode.opacity=b,this._waitingIconNode.transform="scale("+b+")",1>a?this._waitingIconNode.scheduleUpdate(this):(delete this._waitingIconOutStart,this._arrowIconNode.opacity=1,this._arrowIconNode.transform="scale(1)")},_animateWaitingIconSpin:function(){var a=Date.now()-this._waitingIconSpinStart,b=a%this._waitingIconCycleTimeMs/this._waitingIconCycleTimeMs,c=2*Math.PI*b;this._waitingIconNode.transform="rotate("+c+"rad)",this.isWaitingState()?this._waitingIconNode.scheduleUpdate(this):(delete this._waitingIconSpinStart,this._waitingIconOutStart=Date.now(),this._waitingIconNode.scheduleUpdate(this))}})},{"../localizer":74,"../map":75,"../utils":101,"./control":55,"dom-events":7,"render-tree":28}],61:[function(a,b,c){function d(){j.EventTarget(this);var a=h.htmlElement("div",{"class":l.CONTROL});this._zoomInButton=a.appendChild(h.htmlElement("div",{"class":l.BUTTON_ZOOM_IN,role:"button",tabindex:"0"})),this._zoomInButton.appendChild(f()),a.appendChild(h.htmlElement("div",{"class":l.BUTTON_DIVIDER})),this._zoomOutButton=a.appendChild(h.htmlElement("div",{"class":l.BUTTON_ZOOM_OUT,role:"button",tabindex:"0"})),this._zoomOutButton.appendChild(g()),this._updateLabels(),i.call(this,a)}function e(a,b){b?(h.classList.remove(a,l.DISABLED),a.removeAttribute("aria-disabled"),a.setAttribute("tabindex",0)):(h.classList.add(a,l.DISABLED),a.setAttribute("aria-disabled","true"),a.setAttribute("tabindex",-1))}function f(){var a=h.svgElement("path");return a.setAttribute("d","M7,6 L7,0 L6,0 L6,6 L0,6 L0,7 L6,7 L6,13 L7,13 L7,7 L13,7 L13,6 L7,6 Z"),h.createSVGIcon(a,{viewBox:"0 0 13 13"})}function g(){var a=h.svgElement("rect",{x:0,y:6,width:13,height:1});return h.createSVGIcon(a,{viewBox:"0 0 13 13"})}var h=a("../utils"),i=a("./control"),j=a("dom-events"),k=a("../localizer");b.exports=d;var l={CONTROL:"mk-zoom-controls",BUTTON_DIVIDER:"mk-divider",BUTTON_ZOOM_IN:"mk-zoom-in",BUTTON_ZOOM_OUT:"mk-zoom-out",PRESSED:"mk-pressed",DISABLED:"mk-disabled",OPPOSITE_PLACEMENT:"mk-placement-opposite"};d.EVENTS={ZOOM_START:"zoom-start",ZOOM_END:"zoom-end"},d.prototype=h.inheritPrototype(i,d,{_zoomInEnabled:!0,_zoomOutEnabled:!0,get zoomInEnabled(){return this._zoomInEnabled},set zoomInEnabled(a){this._enabled&&a===this._zoomInEnabled||(this._zoomInEnabled=this._enabled&&a,e(this._zoomInButton,this._zoomInEnabled))},get zoomOutEnabled(){return this._zoomOutEnabled},set zoomOutEnabled(a){this._enabled&&a===this._zoomOutEnabled||(this._zoomOutEnabled=this._enabled&&a,e(this._zoomOutButton,this._zoomOutEnabled))},get placement(){return this._placement},set placement(b){if(this._placement!==b){this._placement=b;var c=a("../map");h.classList.toggle(this.element,l.OPPOSITE_PLACEMENT,b===c.ControlsPlacement.Opposite)}},localeChanged:function(a){this._updateLabels()},touchesBegan:function(a){this._pressed(a)},touchesEnded:function(a){this.reset(a)},touchesCancelled:function(a){this.reset(a)},focused:function(a){this.updateTintColor(this.tintColor),a.target.style.fill=h.focusColor},blurred:function(a){this.updateTintColor(this.tintColor)},spaceBarKeyDown:function(a){this._pressed(a)},spaceBarKeyUp:function(a){this.reset(a)},updateTintColor:function(a){this.tintColor=a,this._zoomInButton.querySelector(".mk-icon").style.fill=a,this._zoomOutButton.querySelector(".mk-icon").style.fill=a},reset:function(a){var b=this.element.querySelector("."+l.PRESSED);if(b){var c=Date.now()-this._zoomStartTimestamp;h.classList.remove(b,l.PRESSED);var e=new j.Event(d.EVENTS.ZOOM_END);e.dt=c,this.dispatchEvent(e)}a&&a.keyCode!==h.KeyCodes.SpaceBar&&this.blurFocusedElement(),delete this._zoomStartTimestamp,window.removeEventListener(h.touchendOrMouseup,this),h.supportsTouches&&window.removeEventListener("touchcancel",this)},_updateLabels:function(){var a=k.get("Zoom.In.Tooltip");this._zoomInButton.setAttribute("title",a),this._zoomInButton.setAttribute("aria-label",a),a=k.get("Zoom.Out.Tooltip"),this._zoomOutButton.setAttribute("title",a),this._zoomOutButton.setAttribute("aria-label",a)},_pressed:function(a){var b=h.parentNodeForSvgTarget(a.target);h.classList.add(b,l.PRESSED),this._zoomStartTimestamp=Date.now();var c=new j.Event(d.EVENTS.ZOOM_START);c.zoomIn=h.classList.contains(b,l.BUTTON_ZOOM_IN),this.dispatchEvent(c)}})},{"../localizer":74,"../map":75,"../utils":101,"./control":55,"dom-events":7}],62:[function(a,b,c){"use strict";function d(a,b,c){function d(a,b){return a?void c(new Error):void(b&&b.shiftedPixelPoint?c(null,g(b.shiftedPixelPoint)):c(new Error))}e(JSON.stringify({pixelPoint:f(a)}),b,d)}function e(a,b,c){var d={getDataToSend:function(){return a},loaderDidSucceed:function(a,b){if(b.status<200||b.status>=300)return void c(new Error("HTTP error:"+b.status));try{c(null,JSON.parse(b.responseText))}catch(d){return void c(new Error("Failed to parse response: "+b.responseText))}},loaderDidFail:function(a,b){c(new Error("Network error"))}},e=new j(b,d,{method:"POST"});e.schedule()}function f(a){var b=a.toMapPoint(),c=l*h.tileSize;return{x:Math.floor(b.x*c),y:Math.floor(b.y*c),z:k}}function g(a){function b(a){return a/l/h.tileSize}var c=new i(b(a.x),b(a.y));return c.toCoordinate()}var h=a("./utils"),i=a("./types").MapPoint,j=a("./requests/xhr-loader"),k=21,l=Math.pow(2,k);c.shift=d},{"./requests/xhr-loader":91,"./types":97,"./utils":101}],63:[function(a,b,c){var d=a("./configuration"),e=a("../build.json"),f=a("./utils"),g={init:function(a){this.options=a||{}},infoForMap:function(a){return f.required(a,"[MapKit] Missing `map` parameter in call to `mapkit.debugInfoForMap()`.").checkInstance(a,mapkit.Map,"[MapKit] The parameter passed to `mapkit.debugInfoForMap()` is not a Map."),JSON.stringify({userAgent:navigator.userAgent,build:e,mapSize:a._ensureRenderingFrame().size.toString(),devicePixelRatio:f.devicePixelRatio,zoomLevel:a._zoomLevel,visibleMapRect:a.visibleMapRect.toString(),tileRange:{min:a._tileRange&&a._tileRange.min.toString(),max:a._tileRange&&a._tileRange.max.toString()},pendingTiles:a._tileGrid._pendingTileCount,screenSize:{width:window.screen.width,height:window.screen.height},rootNode:a._rootNode.element.outerHTML,configuration:d._debugInfo()},null,"    ")},drawTileOverlay:function(b,c,d,e,g){if(this.options.showsTileOverlays){var h=g.type===a("./map").MapTypes.Standard,i=1;b.save(),b.fillStyle=h?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.75)",b.fillRect(c,d,e,i),b.fillRect(c,d+e-i,e,i),b.fillRect(c,d,i,e),b.fillRect(c+e-i,d,i,e);var j=10,k=c+i,l=d+i,m=14*f.devicePixelRatio,n=m+j,o=["x","y","z"].map(function(a){return a+" = "+g[a]});b.font=m+"px -apple-system-font",b.beginPath(),b.moveTo(k,l);var p=k,q=l;o.forEach(function(a,c){var d=b.measureText(a).width;p=k+d+2*j,b.lineTo(p,q),q+=n,0===c&&(q+=j),b.lineTo(p,q)}),b.lineTo(k,q),b.closePath(),b.fill(),b.fillStyle=h?"white":"black",b.textBaseline="hanging",o.forEach(function(a,c){b.fillText(a,k+j,l+j+c*n,e)}),b.restore()}}};b.exports=g},{"../build.json":43,"./configuration":53,"./map":75,"./utils":101}],64:[function(a,b,c){var d=a("../build.json"),e=a("./configuration"),f=a("./debug"),g=a("./urls"),h=a("./utils");window.DOMPoint||a("geometry-interfaces"),b.exports={init:function(a,b){e.init(a),f.init(b)},get version(){return d.version},get build(){return d.build},get language(){return e.language},set language(a){e.language=a},addEventListener:e.addEventListener.bind(e),removeEventListener:e.removeEventListener.bind(e),toString:function(){return["MapKit JS",this.version,"("+this.build+")"].join(" ")},get _tileProvider(){return e.tileProvider},get _countryCode(){return e.countryCode},set _countryCode(a){e.countryCode=a},_restore:function(){e._restore()},get _environment(){return e.environment},debugInfoForMap:f.infoForMap,CoordinateRegion:a("./types").CoordinateRegion,CoordinateSpan:a("./types").CoordinateSpan,Coordinate:a("./types").Coordinate,BoundingRegion:a("./types").BoundingRegion,MapPoint:a("./types").MapPoint,MapRect:a("./types").MapRect,MapSize:a("./types").MapSize,Padding:a("./types").Padding,Style:a("./overlays/style"),CircleOverlay:a("./overlays/circle-overlay"),PolylineOverlay:a("./overlays/polyline-overlay"),PolygonOverlay:a("./overlays/polygon-overlay"),Annotation:a("./annotations/annotation"),Geocoder:a("./services/geocoder"),Map:a("./map"),PinAnnotation:a("./annotations/pin-annotation"),ImageAnnotation:a("./annotations/image-annotation")};var i,j=g.getMapKitScriptParts();j.search&&(i=h.parseQueryString(j.search.substr(1)),i.features&&-1!==i.features.split(",").indexOf("search")&&(b.exports.Search=a("./services/search")))},{"../build.json":43,"./annotations/annotation":47,"./annotations/image-annotation":50,"./annotations/pin-annotation":51,"./configuration":53,"./debug":63,"./map":75,"./overlays/circle-overlay":77,"./overlays/polygon-overlay":80,"./overlays/polyline-overlay":81,"./overlays/style":82,"./services/geocoder":92,"./services/search":94,"./types":97,"./urls":98,"./utils":101,"geometry-interfaces":8}],65:[function(a,b,c){function d(a,b,c){this._node=a,this._delegate=c,this._snapsToIntegralZoomLevels=b}var e=a("../utils"),f=a("../analytics/analytics"),g=.01,h=.03,i=.06,j=250;d.prototype={constructor:d,_speed:h,_startTime:0,_shouldStop:!0,_animating:!1,start:function(a,b){var c=Date.now();return this._gasPedalValue=0,this._startTime=c,this._shouldStop=!1,this.zoomsIn=!!b,e.supportsForceTouch&&window.addEventListener("webkitmouseforcechanged",this),this._animating?!1:(this._animating=!0,this._zoomLevel=a,this._timeAtLastFrame=c,this._node.scheduleUpdate(this),!0)},stop:function(){this._shouldStop=!0,e.supportsForceTouch&&(window.removeEventListener("webkitmouseforcechanged",this),delete this._speed)},updateNode:function(){var a=!0,b=Date.now(),c=b-this._timeAtLastFrame,d=this._speed*(this.zoomsIn?1:-1);this._zoomLevel+=60*c*e.log2(1+d)/1e3,this._timeAtLastFrame=b,this._shouldStop&&b-this._startTime>=j&&(this._zoomLevelAtWhichToStop?(a=this.zoomsIn&&this._zoomLevel<this._zoomLevelAtWhichToStop||!this.zoomsIn&&this._zoomLevel>this._zoomLevelAtWhichToStop,a||(this._zoomLevel=this._zoomLevelAtWhichToStop)):this._snapsToIntegralZoomLevels?this._zoomLevelAtWhichToStop=this.zoomsIn?Math.ceil(this._zoomLevel):Math.floor(this._zoomLevel):a=!1),this._delegate&&this._delegate.linearZoomControllerDidZoom(this._zoomLevel),a?this._node.scheduleUpdate(this):(this._animating=!1,delete this._zoomLevelAtWhichToStop,this._delegate&&(this._delegate.linearZoomControllerDidStop(),f.log(this.zoomsIn?"MAP_ZOOM_IN":"MAP_ZOOM_OUT",{map:this._delegate})))},handleEvent:function(a){this._handleForceChangedEvent(a)},_handleForceChangedEvent:function(a){
var b=e.clamp(a.webkitForce,MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN,MouseEvent.WEBKIT_FORCE_AT_FORCE_MOUSE_DOWN)-MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN;Math.abs(b-this._gasPedalValue)>.01&&(this._gasPedalValue=b),this._speed=g+this._gasPedalValue*(i-g)}},b.exports=d},{"../analytics/analytics":44,"../utils":101}],66:[function(a,b,c){function d(){g.LongPress.call(this),this.minimumPressDuration=125}var e=a("../utils"),f=a("geometry/point"),g=a("gesture-recognizers");d.prototype=e.inheritPrototype(g.LongPress,d,{touchesBegan:function(a){g.LongPress.prototype.touchesBegan.call(this,a),this.translation=new f,this._translationOrigin=this._lastTouchLocation=this.locationInElement()},enterRecognizedState:function(){g.LongPress.prototype.enterBeganState.call(this)},touchesMoved:function(a){a.preventDefault();var b=this.locationInElement();this.state===g.States.Possible?g.LongPress.prototype.touchesMoved.call(this,a):(this.state===g.States.Began||this.state===g.States.Changed)&&(this.translation.x+=b.x-this._lastTouchLocation.x,this.translation.y+=b.y-this._lastTouchLocation.y,this.enterChangedState()),this._lastTouchLocation=b},touchesCancelled:function(a){this.interruptGesture()},touchesEnded:function(a){return this.state!==g.States.Changed?void this.enterFailedState():(a.preventDefault(),void this.enterEndedState())},interruptGesture:function(){this.state===g.States.Changed?this.enterEndedState():this.state===g.States.Began&&this.enterFailedState()},reset:function(){g.LongPress.prototype.reset.call(this),delete this._translationOrigin,delete this._lastTouchLocation}}),b.exports=d},{"../utils":101,"geometry/point":9,"gesture-recognizers":12}],67:[function(a,b,c){function d(a){this._delegate=a,this._animationCallback=this._stepThroughAnimation.bind(this)}var e=a("geometry/point"),f=a("request-animation-frame"),g=62500,h=.995,i=10;d.prototype={constructor:d,decelerating:!1,startWithVelocity:function(a){return this._velocity=a,Math.pow(a.x,2)+Math.pow(a.y,2)<g?!1:(this.decelerating=!0,this._timeAtPreviousFrame=Date.now(),this._timer=f.request(this._animationCallback),!0)},stop:function(){this.decelerating&&(f.cancel(this._timer),this._animationEnded())},_stepThroughAnimation:function(){console.assert(this.decelerating);var a=Date.now(),b=a-this._timeAtPreviousFrame,c=Math.exp(Math.log(h)*b),d=h*((1-c)/(1-h));this._delegate.panDecelerationDidPan(new e(this._velocity.x/1e3*d,this._velocity.y/1e3*d)),this._velocity.x*=c,this._velocity.y*=c;var g=Math.abs(this._velocity.x)<=i,j=Math.abs(this._velocity.y)<=i;return g&&j?void this._animationEnded():(this._timeAtPreviousFrame=a,void(this._timer=f.request(this._animationCallback)))},_animationEnded:function(){this.decelerating=!1,this._delegate.panDecelerationDidEnd()}},b.exports=d},{"geometry/point":9,"request-animation-frame":42}],68:[function(a,b,c){function d(a){this._delegate=a,this._animationCallback=this._stepThroughAnimation.bind(this)}var e=a("request-animation-frame"),f=1,g=.01125,h=Math.pow(1e-4,2.5);d.prototype={constructor:d,decelerating:!1,startWithVelocity:function(a){return Math.abs(a)<f?!1:(this.decelerating=!0,this._startTime=Date.now(),this._initialScale=this._scale=1,this._initialVelocity=a/1e3,this._decelerationFactor=1-g,this._decelerationDuration=Math.log(h/Math.pow(this._initialVelocity,2))/(2*Math.log(this._decelerationFactor)),this._scaleAtDecelerationEnd=this._scaleAtTime(this._decelerationDuration),this._adjustedScaleAtDecelerationEnd=this._delegate.pinchDecelerationWillScale(this._scaleAtDecelerationEnd/this._scale),this._scaleAdjustment=this._adjustedScaleAtDecelerationEnd-this._scaleAtDecelerationEnd,this._timer=e.request(this._animationCallback),!0)},stop:function(){this.decelerating&&(e.cancel(this._timer),this._animationEnded())},_stepThroughAnimation:function(){console.assert(this.decelerating);var a=Date.now()-this._startTime;if(a>=this._decelerationDuration)return this._delegate.pinchDecelerationDidScale(this._adjustedScaleAtDecelerationEnd/this._scale),void this._animationEnded();var b=this._scaleAtTime(a),c=(b-this._initialScale)/(this._scaleAtDecelerationEnd-this._initialScale);b+=this._scaleAdjustment*c,this._delegate.pinchDecelerationDidScale(b/this._scale),this.decelerating&&(this._scale=b,this._timer=e.request(this._animationCallback))},_scaleAtTime:function(a){return this._initialScale+this._decelerationFactor*this._initialVelocity*(Math.pow(this._decelerationFactor,a)-1)/(this._decelerationFactor-1)},_animationEnded:function(){this.decelerating=!1,this._delegate.pinchDecelerationDidEnd()}},b.exports=d},{"request-animation-frame":42}],69:[function(a,b,c){function d(a,b){this._target=a,this._delegate=b,this.initialEventTargetForCurrentInteraction=null,this._panRecognizer=this._addGestureRecognizer(e.Pan),this._panRecognizer.maximumNumberOfTouches=2,this._pinchRecognizer=this._addGestureRecognizer(e.Pinch),this._pinchRecognizer.scaleThreshold=.1,this._doubleTapWithOneFingerRecognizer=this._addGestureRecognizer(e.Tap),this._doubleTapWithOneFingerRecognizer.numberOfTouchesRequired=1,this._doubleTapWithOneFingerRecognizer.numberOfTapsRequired=2,this._singleTapWithTwoFingersRecognizer=this._addGestureRecognizer(e.Tap),this._singleTapWithTwoFingersRecognizer.numberOfTouchesRequired=2,this._singleTapWithTwoFingersRecognizer.numberOfTapsRequired=1,this._singleTapWithOneFingerRecognizer=this._addGestureRecognizer(e.Tap),this._longPressAndPanRecognizer=this._addGestureRecognizer(f),this._longPressAndPanRecognizer.delegate=this,a.addEventListener(h.touchstartOrMousedown,this),window.addEventListener(h.touchendOrMouseup,this),this._target.addEventListener("dragstart",this)}var e=a("gesture-recognizers"),f=a("./long-press-and-pan-gesture-recognizer"),g=a("geometry/point"),h=a("../utils"),i="auto"===h.htmlElement("div",{style:"pointer-events: auto"}).style.pointerEvents,j=350;d.prototype={constructor:d,cancelPanGesture:function(){this._singleTapWithOneFingerRecognizer.enabled=!0;var a=this._panRecognizer.state;return a!==e.States.Began&&a!==e.States.Changed?!1:(this._panRecognizer.enabled=!1,this._panRecognizer.enabled=!0,!0)},cancelPinchGesture:function(){this._singleTapWithTwoFingersRecognizer.enabled=!0;var a=this._pinchRecognizer.state;return a!==e.States.Began&&a!==e.States.Changed?!1:(this._pinchRecognizer.enabled=!1,this._pinchRecognizer.enabled=!0,!0)},handleEvent:function(a){switch(a.type){case"dragstart":this._delegate.elementShouldPreventDragstart(a.target)&&a.preventDefault();break;case"mousedown":if(this.initialEventTargetForCurrentInteraction=a.target,!i&&"none"===window.getComputedStyle(this.initialEventTargetForCurrentInteraction).pointerEvents){var b=this.initialEventTargetForCurrentInteraction.style,c=b.display;b.display="none",this.initialEventTargetForCurrentInteraction=document.elementFromPoint(a.clientX,a.clientY),b.display=c}this._delegate.userDidStartInteraction();var d=a.target.ownerDocument.defaultView!==window.top;d||this._delegate.elementAllowsTextSelection(this.initialEventTargetForCurrentInteraction)||a.preventDefault();break;case"mouseup":this.initialEventTargetForCurrentInteraction=null;break;case"touchstart":a.touches.length===a.changedTouches.length&&(this.initialEventTargetForCurrentInteraction=a.touches[0].target,this._delegate.userDidStartInteraction(),this._firstTouchId=a.touches[0].identifier);break;case"touchend":0===a.touches.length&&(this.initialEventTargetForCurrentInteraction=null);break;case"statechange":this._handleStatechange(a)}},_handleStatechange:function(a){switch(a.target){case this._panRecognizer:this._handlePanChange(a);break;case this._pinchRecognizer:this._handlePinchChange(a);break;case this._doubleTapWithOneFingerRecognizer:this._handleDoubleTapWithOneFingerChange(a);break;case this._singleTapWithTwoFingersRecognizer:this._handleSingleTapWithTwoFingersChange(a);break;case this._singleTapWithOneFingerRecognizer:this._handleSingleTapWithOneFingerChange(a);break;case this._longPressAndPanRecognizer:this._handleLongPressAndPanChange(a)}},gestureRecognizerShouldBegin:function(a){return this._delegate.userDidLongPress(a.locationInElement())},mapWasDestroyed:function(){window.removeEventListener(h.touchendOrMouseup,this),this._target.removeEventListener(h.touchstartOrMousedown,this),this._target.removeEventListener("dragstart",this),delete this._target,delete this._delegate},_addGestureRecognizer:function(a){var b=new a;return b.target=this._target,b.addEventListener("statechange",this),b},_handlePanChange:function(a){var b=a.target;b.state===e.States.Began?(this._singleTapWithOneFingerRecognizer.enabled=!1,this._delegate.userWillStartPanning()):(b.state===e.States.Ended||b.state===e.States.Changed)&&(this._delegate.userDidPan(b.translation),b.translation=new g),(b.state===e.States.Ended||b.state===e.States.Failed)&&(this._singleTapWithOneFingerRecognizer.enabled=!0,b.state===e.States.Ended&&this._delegate.userDidStopPanning(b.velocity))},_handlePinchChange:function(a){var b=a.target;b.state===e.States.Began?(this._singleTapWithTwoFingersRecognizer.enabled=!1,this._delegate.userWillStartScaling()):(b.state===e.States.Ended||b.state===e.States.Changed)&&(this._delegate.userDidScale(b.scale,b.locationInElement()),b.scale=1),(b.state===e.States.Ended||b.state===e.States.Failed)&&(this._singleTapWithTwoFingersRecognizer.enabled=!0,this._delegate.userDidStopScaling(b.velocity))},_handleDoubleTapWithOneFingerChange:function(a){var b=a.target;if(b.state===e.States.Recognized){this._delayedSingleTapRecognizerTimeoutID&&(this._delegate.userCancelledTap(),window.clearTimeout(this._delayedSingleTapRecognizerTimeoutID),delete this._delayedSingleTapRecognizerTimeoutID),this._singleTapWithOneFingerRecognizer.enabled=!1;var c=b.locationInElement();b.modifierKeys.alt?this._delegate.userDidZoomOut(c):this._delegate.userDidZoomIn(c)}},_handleSingleTapWithTwoFingersChange:function(a){var b=a.target;b.state===e.States.Recognized&&this._delegate.userDidZoomOut(b.locationInElement())},_handleSingleTapWithOneFingerChange:function(a){var b=a.target;this._singleTapWithOneFingerRecognizer.enabled&&b.state===e.States.Recognized&&(this._delegate.userWillTap(b.locationInElement()),this._delayedSingleTapRecognizerTimeoutID=window.setTimeout(function(){delete this._delayedSingleTapRecognizerTimeoutID,this._delegate.userDidTap()}.bind(this),j))},_handleLongPressAndPanChange:function(a){var b=a.target;switch(b.state){case e.States.Began:this._panRecognizer.enabled=!1,this._pinchRecognizer.enabled=!1,this._singleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer.enabled=!0;break;case e.States.Changed:this._delegate.userDidPanAfterLongPress(b.translation);break;case e.States.Ended:case e.States.Failed:this._panRecognizer.enabled=!0,this._pinchRecognizer.enabled=!0,this._singleTapWithOneFingerRecognizer.enabled=!0,this._delegate.userDidStopPanningAfterLongPress(b.state!==e.States.Failed)}},_stopDraggingAnnotation:function(){this._longPressAndPanRecognizer.interruptGesture()}},b.exports=d},{"../utils":101,"./long-press-and-pan-gesture-recognizer":66,"geometry/point":9,"gesture-recognizers":12}],70:[function(a,b,c){"use strict";function d(){h.forEach(function(a){var b=g.parse(a);e(b)})}function e(a){console.assert(a,"LanguageSupport.add: `langTag` is null.");var b=a.language,c=a.region,d=a.script;k[b]||(k[b]={regions:[],scripts:[]}),c&&k[b].regions.push(c),d&&k[b].scripts.push(d)}function f(a){var b=a.language,c=a.region,d=a.script;console.assert(b,"LanguageSupport._bestMatch: required: `language`"),"iw"===b&&(b="he");var e=k[b];if(!e)return null;if(c){console.assert(!d,"LanguageSupport._bestMatch: can't match on `region` + `script`");var f=e.regions.filter(function(b){return b.toUpperCase()===a.region.toUpperCase()})[0];if(f)return new g(b,f);var h=i[b];if(!h)return new g(b);a.script=d=h[c.toUpperCase()],c=null}if(d){console.assert(!c,"LanguageSupport._bestMatch: can't match on `region` + `script`");var j=e.scripts.filter(function(b){return b.toUpperCase()===a.script.toUpperCase()})[0];return new g(b,null,j)}return new g(b)}function g(a,b,c){this.language=a,b&&(this.region=b,console.assert(!this.script,"Can't have `region` and `script`.")),c&&(this.script=c,console.assert(!this.region,"Can't have `region` and `script`."))}var h=a("../locales/supported-tile-locales.json"),i=a("../locales/region-to-script-map.json"),j=/((([a-zA-Z]+(-[a-zA-Z]+)?)|\*)(;q=[0-1](\.[0-9]+)?)?)*/g,k=Object.create(null);g.prototype={constructor:g,get tag(){var a=this.language;return this.region?a+"-"+this.region:this.script?a+"-"+this.script:a},toString:function(){var a="{ language: "+this.language;return this.region&&(a+=", region: "+this.region),this.script&&(a+=", script: "+this.script),a+" }"}},g.parse=function(a){var b,c,d;if(a&&"string"==typeof a){if(-1!==a.indexOf("_"))return console.warn("Invalid character: '_'"),null;var e=a.split("-");if(b=e[0],2!==b.length)return console.warn("Invalid language:",a),null;if(2===e.length){var f=e[1],h=f.length;if(4===h)d=f;else{if(!(h>1&&4>h))return console.warn("Don't know how to parse:",a),null;c=f}}else if(e.length>2)return console.warn("Don't know how to parse language tags with more than 2 parts:",a),null;return new g(b,c,d)}return null},d(),b.exports={LangTag:g,bestMatch:function(a,b){var c=g.parse(a),d=null;return b=b||null,c&&(d=f(c)),d?d.tag:b},parseAcceptLanguage:function(a){if(!a)return null;var b=a.match(j);return b.map(function(a){if(!a)return null;var b=a.split(";");return{langTag:g.parse(b[0]),quality:b[1]?parseFloat(b[1].split("=")[1]):1}}).filter(function(a){return a}).sort(function(a,b){return b.quality-a.quality})}}},{"../locales/region-to-script-map.json":105,"../locales/supported-tile-locales.json":108}],71:[function(a,b,c){function d(a){this._map=a,this._items=[]}function e(a,b){var c=a.toCoordinateRegion();if(c.span.latitudeDelta>=b.latitudeDelta&&c.span.longitudeDelta>=b.longitudeDelta)return a;c.span.latitudeDelta=Math.max(c.span.latitudeDelta,b.latitudeDelta),c.span.longitudeDelta=Math.max(c.span.longitudeDelta,b.longitudeDelta);var d=c.span.latitudeDelta/2,e=c.span.longitudeDelta/2,h=new i(f.convertLongitudeToX(c.center.longitude-e),f.convertLatitudeToY(c.center.latitude+d)),j=new i(f.convertLongitudeToX(c.center.longitude+e),f.convertLatitudeToY(c.center.latitude-d));return new g(h.x,h.y,Math.min(j.x-h.x,1),j.y-h.y)}var f=a("./utils"),g=a("./types").MapRect,h=a("./types").CoordinateSpan,i=a("./types").MapPoint,j=a("./types").Padding,k=new h(.001,.001),l=new j(12,12,12,12);d.showItems=function(a,b,c){if(0===b.length)return console.warn("[MapKit] showItems: no items to show (empty list)"),[];if(a._ensureRenderingFrame().size.height<=0||a._ensureRenderingFrame().size.width<=0)return console.warn("[MapKit] Map.showItems: cannot show items before the map is added to the document."),[];var d=!1,i=l,m=k;c&&("animate"in c&&(d=!!c.animate),"padding"in c&&(f.checkInstance(c.padding,j,"[MapKit] Map.showItems expects a Padding object for `options.padding`."),i=c.padding),"minimumSpan"in c&&(f.checkInstance(c.minimumSpan,h,"[MapKit] Map.showItems expects a CoordinateSpan for `options.minimumSpan`."),m=c.minimumSpan));var n=0,o=0,p=0,q=0,r=b.map(function(a){if(a._boundingRect){var b=a.style._halfStrokeWidthAtResolution();return n=Math.max(n,b),o=Math.max(o,b),p=Math.max(p,b),q=Math.max(q,b),a._boundingRect}return n=Math.max(n,a._anchorPoint.y),o=Math.max(o,a.size.width-a._anchorPoint.x),p=Math.max(p,a.size.height-a._anchorPoint.y),q=Math.max(q,a._anchorPoint.x),new g(a._x,a._y,0,0)}).sort(function(a,b){return a.minX()-b.minX()});i=new j(i.top+n,i.right+o,i.bottom+p,i.left+q);var s=e(g._boundingRectForSortedRects(r),m);return a.setVisibleMapRectAnimated(a._padMapRect(s,i),d),this},d.prototype={constructor:d,_map:null,_selectedItem:null,_selectionDistance:10,get node(){return this._node},get items(){return this._items.filter(this.isItemExposed,this)},set items(a){f.checkArray(a,"[MapKit] Map."+this.itemName+"s expected an array of "+this.itemName+"s, but got `"+a+"` instead."),this._items.forEach(function(a){this.isItemExposed(a)&&this.removedItem(a)},this),this._items=a.filter(function(a,b){return f.checkInstance(a,this.itemConstructor,"[MapKit] Map."+this.itemName+"s expected an "+this.itemName+" at index "+b+", but got `"+a+"` instead."),this.isItemExposed(a)&&this.shouldAddItem(a,!0)?(this.addedItem(a),!0):!1},this)},get selectedItem(){return this._selectedItem},set selectedItem(a){if(a!==this._selectedItem){if(null!=a&&(f.checkInstance(a,this.itemConstructor,"[MapKit] Map.selected"+this.capitalizedItemName+" expected an "+this.itemName+" or `null`, but got `"+a+"` instead."),a.map!==this._map))throw new Error("[MapKit] Map.selected"+this.capitalizedItemName+" cannot be set to an "+this.itemName+" that is not in the map.");if(this._selectedItem){var b=this._selectedItem;this._selectedItem=null,b.selected=!1}a&&(this._selectedItem=a,a.selected=!0)}},addItem:function(a){return f.checkInstance(a,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+a+"` instead."),this.addItemToList(a),a},addItems:function(a){f.checkArray(a,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+a+"` instead.");var b=a.filter(function(a,b){return f.checkInstance(a,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+b+", but got `"+a+"` instead."),!!this.addItemToList(a,!0)},this);return b},shouldAddItem:function(a,b){return a.map?(a.map!==this._map&&console.warn("[MapKit] Map."+this.capitalizedItemName+(b?"s":"")+": "+this.itemName+" is already in another map."),!1):!0},removeItem:function(a){if(f.checkInstance(a,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+a+"` instead."),a.map!==this._map)console.warn("[MapKit] Map.remove"+this.capitalizedItemName+": cannot remove "+this.itemName+" as it is not attached to this map.");else{var b=this._items.indexOf(a);console.assert(b>=0),b>=0&&(this._items.splice(b,1),this.removedItem(a))}return a},removeItems:function(a){return f.checkArray(a,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+a+"` instead."),a.forEach(function(a,b){f.checkInstance(a,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+b+", but got `"+a+"` instead."),a.map===this._map?a._toBeRemoved=!0:console.warn("[MapKit] Map.remove"+this.capitalizedItemName+"s: cannot remove "+this.itemName+" at index "+b+" as it is not attached to this map.")},this),this._items=this._items.filter(function(a){return a._toBeRemoved?(delete a._toBeRemoved,this.removedItem(a),!1):!0},this),a},itemCloseToPoint:function(a,b){if(this._previousPointForPickingItem&&this._previousPointForPickingItem.equals(a))return b?this._closeItems[this._closeItemIndex]:(this._closeItemIndex=(this._closeItemIndex+1)%this._closeItems.length,this._closeItems[this._closeItemIndex]);this._previousPointForPickingItem=a;var c=this._itemsCloseToPoint(a),d=c.filter(function(a){return a.enabled});return this._closeItems=d.length>0?d:c,this._closeItemIndex=!b&&this._closeItems.length>1&&this._closeItems[0].selected?1:0,this._closeItems[this._closeItemIndex]},addItemToList:function(a,b){return this.shouldAddItem(a,b)?(this._items.push(a),this.addedItem(a,b),a):void 0},addedItem:function(a,b){a._internalDelegate=this},removedItem:function(a){a.selected=!1,delete a._internalDelegate},devicePixelRatioDidChange:function(){},mapWasDestroyed:function(){delete this._map,this.removedReferenceToMap()},_node:null,_deletePreviousPointForPickingItem:function(){delete this._previousPointForPickingItem,delete this._closeItems,delete this._closeItemIndex},_itemsCloseToPoint:function(a){var b=this._items.filter(function(a){return a._canBePicked()});return 0===b.length?[]:this.pickableItemsCloseToPoint(b,a)}},b.exports=d},{"./types":97,"./utils":101}],72:[function(a,b,c){var d=1;b.exports={preprocessPoints:function(a,b){function c(a){var b=j.length;a._index=b,j.push(a),e(b)}function d(a,b){var c=j[a];return j[a]=j[b],j[b]=c,j[a]._index=a,j[b]._index=b,b}function e(a){for(;a>0;){var b=Math.floor((a-1)/2);if(j[b]._area<=j[a]._area)return;a=d(a,b)}}function f(a){for(;;){var b=2*a+1,c=2*a+2,e=j[a]._area,f=j[b]?j[b]._area:1/0,g=j[c]?j[c]._area:1/0;if(f>=e&&g>=e)return;a=d(a,e>=f&&g>=f?b:c)}}function g(){var a=j[0],b=j.pop();return j.length>0&&(j[0]=b,b._index=0,f(0)),a}function h(a){var b=a._prev,c=a,d=a._next;return Math.abs((b.x-d.x)*(c.y-b.y)-(b.x-c.x)*(d.y-b.y))/2}function i(a,b){var c=a._area;a._area=Math.max(h(a),b),a._area<c?e(a._index):f(a._index)}var j=[],k=a.length-1;if(b&&k>1){if(!a[k].equals(a[0])){a.push(a[0].copy());var l=!0;++k}var m=!0;a.unshift(a[k-1].copy()),++k}a[0]._area=a[k]._area=1/0;for(var n=1;k>n;++n){var o=a[n];o._prev=a[n-1],o._next=a[n+1],o._area=h(o),c(o)}for(m&&a.shift(),l&&a.pop();j.length>0;){var p=g(),q=p._prev,r=p._next;q._prev&&(q._next=r,i(q,p._area)),r._next&&(r._prev=q,i(r,p._area)),delete p._index,delete p._next,delete p._prev}},filterPointsAtScale:function(a,b){var c=d/(b*b),e=a.filter(function(a){return a._area>c});if(2===e.length){var f=e[0].x-e[1].x,g=e[0].y-e[1].y,h=f*f+g*g,i=c*d;if(i>h)return[]}return e}}},{}],73:[function(a,b,c){"use strict";function d(a,b){this.localeId=a,this._dict=b||{},this.ready=!!b,this.rtl=h.indexOf(a)>-1}var e=a("./urls"),f=a("./utils"),g=a("./requests/xhr-loader"),h=a("../locales/rtl-locales.json"),i="locales/{{locale}}/strings.json";d.prototype={constructor:d,get:function(a,b){var c=this._dict[a];return c?(b=b||{},f.fillTemplate(c,b,!0)):"["+a+"]"},load:function(a){console.assert("function"==typeof a);var b=this,c=e.createUrl(i).replace(/{{(.*?)}}/,function(){return b.localeId}),d={loaderDidSucceed:function(c,d){var e;if(d.status<200||d.status>=300)return e="HTTP error "+d.status+" loading strings for locale: "+b.localeId,void a(new Error(e));try{b._dict=JSON.parse(d.responseText)}catch(f){return e="Failed to parse response for locale: "+b.localeId,void a(new Error(e))}b.ready=!0,a(null,b)},loaderDidFail:function(c,d){var e="Network error loading strings for locale: "+b.localeId;a(new Error(e))}},f=new g(c,d);f.schedule()}},b.exports=d},{"../locales/rtl-locales.json":106,"./requests/xhr-loader":91,"./urls":98,"./utils":101}],74:[function(a,b,c){"use strict";function d(){m.forEach(function(a){var b=s.parse(a);f(b)})}function e(){Object.keys(o).forEach(function(a){v[a]=Object.create(null),Object.keys(o[a]).forEach(function(b){var c=o[a][b].toLowerCase();v[a][c]=b})})}function f(a){console.assert(a),console.assert(a.region);var b=a.language,c=a.region;u[b]||(u[b]=[]),-1!==n.indexOf(a.tag)?u[b].splice(0,0,c):u[b].push(c)}function g(a){var b,c=a.language,d=a.region,e=a.script;console.assert(c,"Localizer._bestMatch: required: `language`"),"he"===c&&(c="iw");var f=u[c];if(!f)return null;if(d)b=f.filter(function(b){return b.toUpperCase()===a.region.toUpperCase()})[0],b||(b=f[0]);else if(e){var g=v[c];if(!g)return null;b=g[e.toLowerCase()]}else b=f[0];return new s(c,b)}function h(a,b){return console.assert(k(a)),console.assert(!(a in t)),new r(a,b)}function i(a){if(!l||l.localeId!==a){k(a)||(console.warn("Localizer: not a valid locale ID:",a),a=w);var b=t[a];return b||(b=h(a),b.ready)?void j(b):void b.load(function(a,b){return a?(console.error(a.toString()),void j(t[w])):void j(b)})}}function j(a){t[a.localeId]||(t[a.localeId]=a),l=a;var b=new q.Event(x.Events.LocaleChanged);b.locale=a,x.dispatchEvent(b)}function k(a){return-1!==m.indexOf(a)}var l,m=a("../locales/supported-locales.json"),n=a("../locales/primary-locales.json"),o=a("../locales/region-to-script-map.json"),p=a("../locales/en-US/strings.json"),q=a("dom-events"),r=a("./locale"),s=a("./language-support").LangTag,t=Object.create(null),u=Object.create(null),v=Object.create(null),w="en-US",x={get:function(a,b){return console.assert(!!l,"Localizer: no active locale"),l.get(a,b)},get localeId(){return l.localeId},set localeId(a){i(a)},get localeIds(){return Object.keys(t)},get supportedLocaleIds(){return m},bestMatch:function(a,b){var c=s.parse(a),d=null;return b=b||null,c&&(d=g(c)),d?d.tag:b}};x.Events={LocaleChanged:"locale-changed"},q.EventTarget(x),j(h(w,p)),d(),e(),b.exports=x},{"../locales/en-US/strings.json":103,"../locales/primary-locales.json":104,"../locales/region-to-script-map.json":105,"../locales/supported-locales.json":107,"./language-support":70,"./locale":73,"dom-events":7}],75:[function(a,b,c){function d(a,b){b=b||{},this._checkOptions(b),G.EventTarget(this),this._tileRange=null,this._prefetchingZoomLevels=[],this._prefetchedTilesForPanning=[],this._prefetchedTilesForZooming=[],this._cameraIsPanning=!1,this._cameraIsZooming=!1,this._scrollable="scrollable"in b?b.scrollable===!0:!0,this._zoomable="zoomable"in b?b.zoomable===!0:!0,this._showsZoomControl="showsZoomControl"in b?b.showsZoomControl===!0:!P,this._showsMapTypeControl="showsMapTypeControl"in b?b.showsMapTypeControl===!0:!P,this._showsUserLocationControl="showsUserLocationControl"in b?b.showsUserLocationControl===!0:!1,this._zoomControlPlacement=d.ControlsPlacement.Standard,b.zoomControlPlacement&&(this.zoomControlPlacement=b.zoomControlPlacement);var c=d.MapTypes.Standard;if(b.mapType){if(!g.checkValueIsInEnum(b.mapType,d.MapTypes))throw new Error("[MapKit] Unknown value for `mapType`. Choose from Map.MapTypes.");c=b.mapType}this._mapType=c;var e=document.createElement("div");e.className=aa,this._rootNode=new H.Node(e),this._backgroundGrid=new j,this._updateBackgroundGridMode(),this._rootNode.addChild(this._backgroundGrid.node),this._tileGridContainer=this._rootNode.addChild(new H.Node),this._overlaysController=new y(this),this._annotationsController=new z(this),this._rootNode.addChild(this._annotationsController.node),this._userLocationController=new C(this),this._controlsLayer=this._rootNode.addChild(new D(this)),this._visibleMapRect=R,this._renderingMapRect=new p,this._animatingVisibleMapRect=!1,this._userLocationControlPlacement=d.ControlsPlacement.Standard,b.userLocationControlPlacement&&(this.userLocationControlPlacement=b.userLocationControlPlacement),h.addEventListener(h.Events.Changed,this),h.addEventListener(h.Events.Error,this),h.state===h.States.READY?this._configurationDidBecomeAvailable():h.state===h.States.ERROR&&this._dispatchErrorEvent(),this._padding=new r,b.padding&&(this.padding=b.padding),this._addMapToParent(a),b.visibleMapRect?this.visibleMapRect=b.visibleMapRect:b.region?this.region=b.region:b.center&&(this.center=b.center),b.overlays&&(this.overlays=b.overlays),b.selectedOverlay&&(this.selectedOverlay=b.selectedOverlay),b.annotations&&(g.checkArray(b.annotations,"[MapKit] Map constructor annotations option expected an array of annotations, but got `"+b.annotations+"` instead."),b.visibleMapRect||b.region||b.center||!a?this.annotations=b.annotations:this.showAnnotations(b.annotations)),b.selectedAnnotation&&(this.selectedAnnotation=b.selectedAnnotation),this.tintColor=b.tintColor,this.showsUserLocation=b.showsUserLocation,this.tracksUserLocation=b.tracksUserLocation,this._linearZoomController=new t(this._tileGridContainer,T,this),this._mapUserInteractionController=new u(this._rootNode.element,this),this._panDeceleration=new v(this),this._pinchDeceleration=new w(this),x.addEventListener(x.Events.LocaleChanged,this),I.addEventListener("device-pixel-ratio-change",this)}function e(a,b){for(var c=0,d=a.length;d>c;++c)i.releaseTile(a[c],b)}function f(a){this.selected=a}var g=a("./utils"),h=a("./configuration"),i=a("./rendering/tile-manager"),j=a("./rendering/background-grid"),k=a("./types").CoordinateRegion,l=a("./types").CoordinateSpan,m=a("./types").Coordinate,n=a("./types").MapPoint,o=a("./types").MapSize,p=a("./types").MapRect,q=a("./visible-map-rect-animation"),r=a("./types").Padding,s=a("./rendering/tile-grid"),t=a("./interaction/linear-zoom-controller"),u=a("./interaction/map-user-interaction-controller"),v=a("./interaction/map-pan-deceleration"),w=a("./interaction/map-pinch-deceleration"),x=a("./localizer"),y=a("./overlays/overlays-controller"),z=a("./annotations/annotations-controller"),A=a("./controls/zoom-control"),B=a("./controls/user-location-control"),C=a("./user-location/user-location-controller"),D=a("./controls/controls-layer"),E=a("geometry/point"),F=a("geometry/rect"),G=a("dom-events"),H=a("render-tree"),I=a("device-pixel-ratio"),J=a("./analytics/analytics"),K=a("./layer-items-controller"),L=a("./overlays/overlay"),M=a("./annotations/annotation"),N=1-Math.pow(2,-52),O=250,P=g.supportsTouches,Q=4,R=new p(0,0,1,1),S=new l(.15,.15),T=!0,U=!g.supportsTouches,V="mk-panning",W="mk-dragging-annotation",X="mk-rtl",Y=9.5,Z=14,$=5,_={padding:"rw",scrollable:"rw",zoomable:"rw",center:"rw",region:"rw",visibleMapRect:"rw",tintColor:"rw",annotations:"rw",selectedAnnotation:"rw",overlays:"rw",selectedOverlay:"rw",showsUserLocation:"rw",tracksUserLocation:"rw",mapType:"rw",showsMapTypeControl:"rw",showsZoomControl:"rw",zoomControlPlacement:"rw",showsUserLocationControl:"rw",userLocationControlPlacement:"rw",element:"ro",userLocationAnnotation:"ro"},aa="mk-map-view",ba={ERROR:"error",LOAD:"load",ZOOM_START:"zoom-start",ZOOM_END:"zoom-end",SELECT:"select",DESELECT:"deselect",DRAG_START:"drag-start",DRAG_END:"drag-end",REGION_CHANGE_START:"region-change-start",REGION_CHANGE_END:"region-change-end",SCROLL_START:"scroll-start",SCROLL_END:"scroll-end",MAP_TYPE_CHANGE:"map-type-change"};d.MapTypes={Satellite:"satellite",Hybrid:"hybrid",Standard:"standard"},d.ControlsPlacement={Standard:"standard",Opposite:"opposite"},d.prototype={constructor:d,_showsUserLocation:!1,_tracksUserLocation:!1,_minZoomLevel:3,_maxZoomLevel:20,_tintColor:"",_shouldSuspendTrackingUserLocation:!0,get padding(){return this._padding.copy()},set padding(a){if(g.checkInstance(a,r,"[MapKit] The `padding` parameter passed to `Map.padding` is not a Padding."),!this._padding.equals(a)){this._padding=a.copy();var b=this._ensureRenderingFrame();if(!b.equals(F.ZeroRect)){this._setRenderingFrameValue(b);var c,d=this._visibleFrame,e=this._renderingMapRect;c=b.equals(d)?e.copy():new p(e.minX()+a.left/b.size.width*e.size.width,e.minY()+a.top/b.size.height*e.size.height,e.size.width*(d.size.width/b.size.width),e.size.height*(d.size.height/b.size.height)),this.setVisibleMapRectAnimated(c,!1)}this._controlsLayer.mapPaddingDidChange()}},get scrollable(){return this._scrollable},set scrollable(a){if(a!==this.scrollable){if(g.checkType(a,"boolean"),a)this._cameraIsPanning||this._cameraIsZooming||this._prefetchTilesForPanning();else{e(this._prefetchedTilesForPanning),this._prefetchedTilesForPanning=[];var b=this._mapUserInteractionController.cancelPanGesture();b&&this.userDidStopPanning()}this._scrollable=a}},get zoomable(){return this._zoomable},set zoomable(a){if(a!==this._zoomable)if(g.checkType(a,"boolean"),this._zoomable=a,this._controlsLayer.updateZoomControl(),a)this._cameraIsPanning||this._cameraIsZooming||this._prefetchTilesForZooming();else{e(this._prefetchedTilesForZooming),this._prefetchedTilesForZooming=[];var b=this._mapUserInteractionController.cancelPinchGesture();b&&this.userDidStopScaling(),this._linearZoomController.stop()}},get showsZoomControl(){return this._showsZoomControl},set showsZoomControl(a){a!==this._showsZoomControl&&(g.checkType(a,"boolean","[MapKit] Value passed to `Map.showsZoomControl` setter is not a boolean."),this._showsZoomControl=a,this._controlsLayer.updateZoomControl())},get zoomControlPlacement(){return this._zoomControlPlacement},set zoomControlPlacement(a){return a!==d.ControlsPlacement.Standard&&a!==d.ControlsPlacement.Opposite?void console.warn("[MapKit] value passed to `Map.zoomControlPlacement` setter must be either `Map.ControlsPlacement.Standard` or `Map.ControlsPlacement.Opposite`"):void(a!==this._zoomControlPlacement&&(this._zoomControlPlacement=a,
this._controlsLayer&&this._controlsLayer.updateZoomControl()))},get mapType(){return this._mapType},set mapType(a){if(a!==this._mapType){if(!g.checkValueIsInEnum(a,d.MapTypes))throw new Error("[MapKit] Unknown value for `mapType`. Choose from Map.MapTypes.");this._shouldPreserveCurrentTileGrid=this._mapType!==d.MapTypes.Standard&&a!==d.MapTypes.Standard,this._mapType=a,this._removePreviousTileGrids(),this._updateDisplay(),this._controlsLayer.update(),this._updateMinAndMaxZoomLevels(),this._updateBackgroundGridMode(),this._overlaysController.mapTypeWasSet(this._mapType),this._prefetchTiles(),this.dispatchEvent(new G.Event(ba.MAP_TYPE_CHANGE))}},get showsMapTypeControl(){return this._showsMapTypeControl},set showsMapTypeControl(a){a!==this._showsMapTypeControl&&(g.checkType(a,"boolean","[MapKit] Value passed to `Map.showsMapTypeControl` setter is not a boolean."),this._showsMapTypeControl=a,this._controlsLayer.updateMapTypeControl())},get showsUserLocationControl(){return this._showsUserLocationControl},set showsUserLocationControl(a){a!==this._showsUserLocationControl&&(g.checkType(a,"boolean","[MapKit] Value passed to `Map.showsUserLocationControl` setter is not a boolean."),this._showsUserLocationControl=a,this._controlsLayer.updateUserLocationControl())},get userLocationControlPlacement(){return this._userLocationControlPlacement},set userLocationControlPlacement(a){return a!==d.ControlsPlacement.Standard&&a!==d.ControlsPlacement.Opposite?void console.warn("[MapKit] value passed to `Map.userLocationControlPlacement` setter must be either `Map.ControlsPlacement.Standard` or `Map.ControlsPlacement.Opposite`"):void(a!==this._userLocationControlPlacement&&(this._userLocationControlPlacement=a,this._controlsLayer.updateUserLocationControl()))},get element(){return this._rootNode.element},set element(a){console.warn("[MapKit] The `element` property is read-only.")},get visibleMapRect(){return this._visibleMapRect},set visibleMapRect(a){this.setVisibleMapRectAnimated(a,!1)},setVisibleMapRectAnimated:function(a,b){g.required(a,"[MapKit] Missing `visibleMapRect` parameter in call to `Map.setVisibleMapRectAnimated()`.").checkInstance(a,p,"[MapKit] The `visibleMapRect` parameter passed to `Map.setVisibleMapRectAnimated()` is not a MapRect."),b=void 0===b?!0:!!b;var c=this._ensureRenderingFrame();if(a!==R&&(this._defaultVisibleMapRectHasBeenOverriden=!0),0===c.size.width||0===c.size.height)return void(this._visibleMapRect=a);var d=this._visibleFrame,e=a,f=this._padding;if(!f.equals(r.Zero)){var h=c.size.width/d.size.width,i=c.size.height/d.size.height;e=new p(a.minX()-f.left*h*a.size.width,a.minY()-f.top*i*a.size.height,a.size.width*h,a.size.height*i)}var j=g.zoomLevelForMapRectInViewport(e,c.size,g.tileSize);this._setZoomAndAxes(T?Math.floor(j):j);var k=new n(a.midX(),a.midY()),l=new o(d.size.width/this._worldSize,d.size.height/this._worldSize);return this._setVisibleMapRect(new p(k.x-l.width/2,k.y-l.height/2,l.width,l.height),b),this},get region(){return this._visibleMapRect.toCoordinateRegion()},set region(a){this.setRegionAnimated(a,!1)},setRegionAnimated:function(a,b){return g.required(a,"[MapKit] Tried to set `Map.region` property to a non-existent value.").checkInstance(a,k,"[MapKit] Region passed to `Map.region` setter is not a CoordinateRegion."),this.setVisibleMapRectAnimated(a.toMapRect(),b),this},get center(){return new n(this._visibleMapRect.midX(),this._visibleMapRect.midY()).toCoordinate()},set center(a){this.setCenterAnimated(a,!1)},setCenterAnimated:function(a,b){g.required(a,"[MapKit] Tried to set `Map.center` property to a non-existent value.").checkInstance(a,m,"[MapKit] Value passed to `Map.center` setter is not a Coordinate object.");var c=a.toMapPoint(),d=this._visibleMapRect.size;return this.setVisibleMapRectAnimated(new p(c.x-d.width/2,c.y-d.height/2,d.width,d.height),b),this},get overlays(){return this._overlaysController.items},set overlays(a){this._overlaysController.items=a},get selectedOverlay(){return this._overlaysController.selectedItem},set selectedOverlay(a){this._overlaysController.selectedItem=a},addOverlay:function(a){return this._overlaysController.addItem(a)},addOverlays:function(a){return this._overlaysController.addItems(a),a},removeOverlay:function(a){return this._overlaysController.removeItem(a)},removeOverlays:function(a){return this._overlaysController.removeItems(a)},get annotations(){return this._annotationsController.items},set annotations(a){this._annotationsController.items=a},get selectedAnnotation(){return this._annotationsController.selectedItem},set selectedAnnotation(a){this._annotationsController.selectedItem=a},addAnnotation:function(a){return this._annotationsController.addItem(a),this},addAnnotations:function(a){return this._annotationsController.addItems(a),this},removeAnnotation:function(a){return this._annotationsController.removeItem(a),this},removeAnnotations:function(a){return this._annotationsController.removeItems(a),this},showAnnotations:function(a,b){return this._annotationsController.showAnnotations(a,b),this},showItems:function(a,b){return g.checkArray(a,"[MapKit] Map.showItems expects an array of items as its first parameter."),b&&g.checkType(b,"object","[MapKit] Map.showItems expects an object as optional second parameter."),this._addItems(a),K.showItems(this,a,b),a},annotationsInMapRect:function(a){return this._annotationsController.annotationsInMapRect(a)},updateSize:function(a){this._ensureContainerIsPositioned();var b=!this._renderingFrame;if(a||(this._updateFrameFromElement(),this._renderingFrame)){a&&(g.checkType(a,"object","[MapKit] Map.updateSize(size) expects an object with `width` and `height` number properties as its argument, got `"+a+"` instead."),g.checkType(a.width,"number","[MapKit] Map.updateSize(size) expects a number for size.width, got `"+a.width+"` instead."),g.checkType(a.height,"number","[MapKit] Map.updateSize(size) expects a number for size.height, got `"+a.height+"` instead."),this._setRenderingFrameValue(new F(0,0,a.width,a.height)));var c=this._backgroundGrid.size=this._ensureRenderingFrame().size;return this._shouldSuspendTrackingUserLocation=!1,b&&this.setVisibleMapRectAnimated(this._visibleMapRect,!1),this._updateMinAndMaxZoomLevels(),this._frameOrZoomDidChange(),this._controlsLayer.sizeDidChange(),this._overlaysController.mapSizeDidUpdate(c),this._annotationsController.mapSizeDidUpdate(),this._shouldSuspendTrackingUserLocation=!0,this}},convertCoordinateToPointOnPage:function(a){g.checkInstance(a,m,"[MapKit] Map.convertCoordinateToPointOnPage expected a Coordinate, but got `"+a+"` instead.");var b=this._ensureRenderingFrame(),c=a.toMapPoint(),d=this._renderingMapRect,e=this._rootNode.convertPointToPage(new E((c.x-d.minX())/d.size.width*b.size.width,(c.y-d.minY())/d.size.height*b.size.height));return new DOMPoint(e.x,e.y)},convertPointOnPageToCoordinate:function(a){g.checkInstance(a,DOMPoint,"[MapKit] Map.convertPointOnPageToCoordinate expected a DOMPoint, but got `"+a+"` instead.");var b=this._rootNode.convertPointFromPage(new E(a.x,a.y)),c=this._renderingMapRect.origin;return new m(g.convertYToLatitude(c.y+b.y/this._worldSize),g.convertXToLongitude(c.x+b.x/this._worldSize))},get showsUserLocation(){return this._userLocationController.showsUserLocation},set showsUserLocation(a){a=!!a,a!==this.showsUserLocation&&(this._userLocationController.showsUserLocation=a,a||(this._removeUserLocationDisplay(),this.tracksUserLocation=!1))},get userLocationAnnotation(){return this._annotationsController.userLocationAnnotation},get tracksUserLocation(){return this._userLocationController.tracksUserLocation},set tracksUserLocation(a){a=!!a,a!==this.tracksUserLocation&&(this._userLocationController.tracksUserLocation=a,a&&(this.showsUserLocation=!0),this._firstCameraUpdateToTrackUserLocationPending=a,this._updateCameraToTrackUserLocation(this._userLocationController.userLocation),this._controlsLayer.updateUserLocationControl(),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange&&this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange(this))},get tintColor(){return this._tintColor},set tintColor(a){if(a!==this._tintColor){if(null!=a){if(g.checkType(a,"string","[MapKit] Expected a string value for Map.tintColor, but got `"+a+"` instead"),""!==a&&!g.isValidCSSColor(a))return void console.warn("[MapKit] value passed to `Map.tintColor` is not a valid color value. Ignoring: "+a);this._tintColor=a}else delete this._tintColor;this._controlsLayer&&this._controlsLayer.update()}},destroy:function(){this._visibleMapRectAnimation&&(this._visibleMapRectAnimation.cancel(),delete this._visibleMapRectAnimation),this._linearZoomController.stop(),this.showsUserLocation&&this._removeUserLocationDisplay(),this._controlsLayer.mapWasDestroyed(),this._mapUserInteractionController.mapWasDestroyed(),this._overlaysController.mapWasDestroyed(),this._annotationsController.mapWasDestroyed(),this._userLocationController.mapWasDestroyed(),this._linearZoomController._delegate=null,this._panDeceleration._delegate=null,this._pinchDeceleration._delegate=null,h.removeEventListener(h.Events.Changed,this),h.removeEventListener(h.Events.Error,this),x.removeEventListener(x.Events.LocaleChanged,this),I.removeEventListener("device-pixel-ratio-change",this);var a=this._tileGrid();a&&a.removeEventListener(s.Events.FullRender,this),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)},handleEvent:function(a){switch(a.type){case h.Events.Changed:this._configurationDidBecomeAvailable();break;case h.Events.Error:this._dispatchErrorEvent();break;case A.EVENTS.ZOOM_START:this._handleZoomStartEvent(a);break;case A.EVENTS.ZOOM_END:this._handleZoomEndEvent(a);break;case s.Events.FullRender:this._tileGridDidFullyRender();break;case x.Events.LocaleChanged:this._handleLocaleChange(a);break;case"device-pixel-ratio-change":this._devicePixelRatioDidChange(a);break;case B.EVENTS.STATE_CHANGE:this._handleUserLocationControlStateChange(a)}},updateNode:function(){this._createNodeForOverlaysController()},elementShouldPreventDragstart:function(a){return!this._annotationsController.isElementInCustomCallout(a)},elementAllowsTextSelection:function(a){return this._annotationsController.isElementInCallout(a)},userDidStartInteraction:function(){this._panDeceleration.stop(),this._pinchDeceleration.stop()},userWillTap:function(a){if(this._isInitialInteractionTargetInUIElement())return void(g.supportsTouches&&(this._delayedTapFunction=this._elementWasTapped.bind(this,this._mapUserInteractionController.initialEventTargetForCurrentInteraction)));var b=this._rootNode.convertPointFromPage(a),c=this._annotationsController.itemCloseToPoint(b);if(c)return void(c.enabled&&(this._delayedTapFunction=f.bind(c,!0)));var d=this._overlaysController.itemCloseToPoint(b);return d?void(d.enabled&&(this._delayedTapFunction=f.bind(d,!0))):void(this._delayedTapFunction=function(){this._annotationsController.selectedItem=null,this._overlaysController.selectedItem=null}.bind(this))},userDidTap:function(a){this._delayedTapFunction&&(this._delayedTapFunction(),delete this._delayedTapFunction)},userCancelledTap:function(a){delete this._delayedTapFunction},userDidLongPress:function(a){if(this._isInitialInteractionTargetInUIElement())return!1;var b=this._annotationsController.itemCloseToPoint(this._rootNode.convertPointFromPage(a),!0);if(!b)return!1;if(b.enabled){if(b._isDraggable()&&!this._cameraIsPanning&&!this._cameraIsZooming)return this._annotationsController.startDraggingAnnotation(b,a),!0;if(g.supportsTouches)return b.selected=!0,!0}return g.supportsTouches},userDidPanAfterLongPress:function(a){this._annotationsController.annotationDraggingDidChange(a)},userDidStopPanningAfterLongPress:function(a){this._annotationsController.annotationDraggingDidEnd(a)},userWillStartPanning:function(a){return!this._scrollable||this.tracksUserLocation&&this._cameraIsZooming||this._isInitialInteractionTargetInUIElement()||!this.dispatchEvent(new G.Event(ba.SCROLL_START))?void this._mapUserInteractionController.cancelPanGesture():void this._interactivePanDidStart()},userDidPan:function(a){this._animatingVisibleMapRect||this._applyPanningTranslation(a)},userDidStopPanning:function(a){var b=this._panDeceleration.startWithVelocity(a);b||this._interactivePanDidEnd()},userWillStartScaling:function(){return this._zoomable&&this.dispatchEvent(new G.Event(ba.ZOOM_START))?(this._addTileGridsForZoomOut(!0),void this._interactiveZoomDidStart()):void this._mapUserInteractionController.cancelPinchGesture()},userDidScale:function(a,b){if(!this._animatingVisibleMapRect){var c=this.tracksUserLocation?new E(this._ensureVisibleFrame().midX(),this._ensureVisibleFrame().midY()):this._rootNode.convertPointFromPage(b);this._lastScaleCentroid=c,this._scaleAroundPoint(a,c,!1)}},userDidStopScaling:function(a){var b=this._pinchDeceleration.startWithVelocity(a);b||(T&&(this._visibleMapRectAnimationDuration=O,this._notifyOfInteractiveZoomCompletionWhenVisibleMapRectAnimationCompletes=!0,this._setZoom(Math.round(this._zoomLevel))),this._animatingVisibleMapRect||this._interactiveZoomDidEnd())},userDidZoomIn:function(a){this._isInitialInteractionTargetInUIElement()||this._userDidZoom(a,!1)},userDidZoomOut:function(a){this._isInitialInteractionTargetInUIElement()||this._userDidZoom(a,!0)},panDecelerationDidPan:function(a){this._applyPanningTranslation(a)},panDecelerationDidEnd:function(){this._interactivePanDidEnd()},pinchDecelerationWillScale:function(a){if(!T)return a;var b=this._zoomLevel,c=b+g.log2(a),d=Math.round(c);c>b&&b>=d?d=Math.ceil(c):b>c&&d>=b&&(d=Math.floor(c));var e=g.clamp(d,this._minZoomLevel,this._maxZoomLevel);return Math.pow(2,e-b)},pinchDecelerationDidScale:function(a){this._scaleAroundPoint(a,this._lastScaleCentroid,!1),(this._zoomLevel===this._minZoomLevel||this._zoomLevel===this._maxZoomLevel)&&this._pinchDeceleration.stop()},pinchDecelerationDidEnd:function(){T&&this._setZoom(Math.round(this._zoomLevel)),this._interactiveZoomDidEnd()},linearZoomControllerDidZoom:function(a){this._setZoom(a),(this._zoomLevel<=this._minZoomLevel&&!this._linearZoomController.zoomsIn||this._zoomLevel>=this._maxZoomLevel&&this._linearZoomController.zoomsIn)&&this._interactiveZoomDidEnd()},linearZoomControllerDidStop:function(){this._interactiveZoomDidEnd()},visibleMapRectAnimationDidProgress:function(a){this._setVisibleMapRectValue(a),this._setZoomAndAxes(g.zoomLevelForMapRectInViewport(a,this._ensureVisibleFrame().size,g.tileSize)),this._updateDisplay()},visibleMapRectAnimationDidEnd:function(a){this._setVisibleMapRectValue(a),this._animatingVisibleMapRect=!1,this._tileUpdatesSuspensionMayHaveEnded(!this._shouldUpdateTilesDuringVisibleMapRectAnimation),this._dispatchRegionChangeEndEvent(),this._notifyOfInteractiveZoomCompletionWhenVisibleMapRectAnimationCompletes&&(this._interactiveZoomDidEnd(),delete this._notifyOfInteractiveZoomCompletionWhenVisibleMapRectAnimationCompletes),delete this._shouldUpdateTilesDuringVisibleMapRectAnimation,delete this._visibleMapRectAnimation},userLocationDidChange:function(a){this._updateUserLocationDisplay(a.target),this._controlsLayer.updateUserLocationControl(),this.tracksUserLocation&&this._updateCameraToTrackUserLocation(a.target),this.dispatchEvent(a)},userLocationDidError:function(a){this._updateUserLocationDisplay(a.target),this._controlsLayer.updateUserLocationControl(),this.dispatchEvent(a)},_stopDraggingAnnotation:function(){this._mapUserInteractionController._stopDraggingAnnotation()},_translateVisibleMapRectAnimated:function(a,b){var c=this._visibleMapRect;this._setVisibleMapRect(new p(c.minX()+a.x/this._worldSize,c.minY()+a.y/this._worldSize,c.size.width,c.size.height),!!b)},_addItems:function(a){a.forEach(function(a,b){if(!(a instanceof L||a instanceof M))throw new Error("[MapKit] Map.showItems expected an Annotation or Overlay at index "+b+", but got `"+a+"` instead.");a.map||(a instanceof L?this.addOverlay(a):this.addAnnotation(a))},this)},_userDidZoom:function(a,b){if(this._zoomable&&this.dispatchEvent(new G.Event(ba.ZOOM_START))){var c,d=this._zoomLevel%1;b?(this._addTileGridsForZoomOut(!0),c=Math.floor(this._zoomLevel),.5>d&&c--):(c=Math.ceil(this._zoomLevel),(0===d||d>.5)&&c++);var e=this._ensureRenderingFrame().size.width/(Math.pow(2,c)*g.tileSize),f=this._renderingMapRect.size.width/e;this._scaleAroundPoint(f,this._rootNode.convertPointFromPage(a),!0),this.dispatchEvent(new G.Event(ba.ZOOM_END))}},_applyPanningTranslation:function(a){if(this._setVisibleMapRect(new p(this._visibleMapRect.origin.x-a.x/this._worldSize,this._visibleMapRect.origin.y-a.y/this._worldSize,this._visibleMapRect.size.width,this._visibleMapRect.size.height)),this._panningReferenceTile){var b=this._positionForPanningTile();this._layersPanningDidChange(new E(b.x-this._panningReferencePosition.x,b.y-this._panningReferencePosition.y))}},_shouldWaitForTilesAndControls:function(){var a=this._tileGrid();return!!a&&a.pendingTileCount>0||this._controlsLayer.controlsPending},_configurationDidBecomeAvailable:function(){this._updateMinAndMaxZoomLevels(),this._dispatchLoadEvent(),this._updateDisplay(),this._controlsLayer.update(),h.location&&!this._defaultVisibleMapRectHasBeenOverriden&&(this.region=new k(new m(h.location.lat,h.location.lng),S))},_ensureRenderingFrame:function(){return this._renderingFrame||this._updateFrameFromElement(),this._renderingFrame||new F},_ensureVisibleFrame:function(){return this._renderingFrame||this._updateFrameFromElement(),this._visibleFrame||new F},_checkOptions:function(a){g.checkType(a,"object","[MapKit] The `options` object is invalid."),Object.keys(a).forEach(function(a){var b=_[a];if("rw"!==b)throw"ro"===b?new Error("[MapKit] `"+a+"` is read-only and can't be set on a Map."):new Error("[MapKit] `"+a+"` is not a valid property of Map.")})},_addMapToParent:function(a){if(void 0!==a&&null!==a){var b="string"==typeof a?document.getElementById(a):a;if(!b||!g.isElement(b))throw new Error("[MapKit] `parent` must either be a DOM element or its ID.");b.appendChild(this.element),this.updateSize()}},_updateUserLocationDisplay:function(a){this._annotationsController.updateUserLocationAnnotation(a),this._overlaysController.updateUserLocationAccuracyRingOverlay(a)},_removeUserLocationDisplay:function(){this._annotationsController.removeUserLocationAnnotation(),this._overlaysController.removeUserLocationAccuracyRingOverlay()},_handleUserLocationControlStateChange:function(a){a.target.isWaitingState()?this.tracksUserLocation=!0:this.tracksUserLocation=a.target.isTrackingState(),this._controlsLayer.updateUserLocationControl()},_updateCameraToTrackUserLocation:function(a){var b,c;if(this.tracksUserLocation&&this.showsUserLocation&&a.coordinate&&!this._animatingVisibleMapRect){if(this._shouldSuspendTrackingUserLocation=!1,this._firstCameraUpdateToTrackUserLocationPending&&this._zoomLevel<Y){var d=Z;if(a.location.accuracy>0){var e=$*a.location.accuracy*g.mapUnitsPerMeterAtLatitude(a.location.latitude),f=new p(0,0,e,e),h=this._visibleFrame.size;d=Math.max(this._zoomLevel,g.zoomLevelForMapRectInViewport(f,h,g.tileSize))}b=this._mapRectForCenterAndZoomLevel(a.coordinate.toMapPoint(),d),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation&&(c=b.toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this,c),b=c.toMapRect()),this.setVisibleMapRectAnimated(b)}else this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation?(b=this._mapRectForCenterAndZoomLevel(a.coordinate.toMapPoint(),this._zoomLevel),c=b.toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this,c),this.setRegionAnimated(c)):this.setCenterAnimated(a.coordinate);this._shouldSuspendTrackingUserLocation=!0,delete this._firstCameraUpdateToTrackUserLocationPending}},_scaleAroundPoint:function(a,b,c){var d=this._zoom();this._setZoomAndAxes(d+g.log2(a));var e=this._zoom();if(e!==d){var f=this._ensureRenderingFrame(),h=this._renderingMapRect,i=f.size.width/(Math.pow(2,e)*g.tileSize);a=i/h.size.width;var j=new n(h.minX()+(b.x-f.minX())/f.size.width*h.size.width,h.minY()+(b.y-f.minY())/f.size.height*h.size.height);this._setVisibleMapRect(this._visibleMapRect.scale(a,j),c)}},_updateFrameFromElement:function(){var a=this._rootNode.element,b=a.offsetWidth,c=a.offsetHeight;0!==b&&0!==c&&this._setRenderingFrameValue(new F(0,0,b,c))},_setRenderingFrameValue:function(a){this._renderingFrame=a,this._visibleFrame=a;var b=this._padding;b.equals(r.Zero)||(this._visibleFrame=new F(a.origin.x+b.left,a.origin.y+b.top,a.size.width-b.left-b.right,a.size.height-b.top-b.bottom))},_frameOrZoomDidChange:function(){var a=new n(this._visibleMapRect.midX(),this._visibleMapRect.midY());this._setVisibleMapRect(this._mapRectForCenterAndZoomLevel(a,this._zoom()))},_mapRectForCenterAndZoomLevel:function(a,b){var c=this._ensureVisibleFrame().size,d=Math.pow(2,b)*g.tileSize,e=c.width/d,f=c.height/d;return new p(a.x-e/2,a.y-f/2,e,f)},_updateDisplay:function(){this._updateTiles(),this._updateCamera(),(!this._cameraIsPanning||this._cameraIsZooming||this._animatingVisibleMapRect&&this._panDeceleration&&!this._panDeceleration.decelerating)&&(this._overlaysController.updateRendering(),this._annotationsController.updateVisibleAnnotations())},_updateTiles:function(){if(!this._shouldSuspendTileUpdates()){var a=i.tileRangeForMapPointFrameAndZoom(this._renderingMapRect.origin,this._ensureRenderingFrame(),Math.ceil(this._zoom())),b=a.usesSameTileSourceAs(this._tileRange)&&this._tileRange._mapType===this._mapType;if(!(this._tileRange&&this._tileRange.equals(a)&&b)){var c=!!this._shouldPreserveCurrentTileGrid||b&&a.min.z!==this._tileRange.min.z,d=this._tileGrid();c&&d.removeEventListener(s.Events.FullRender,this),this._tileGridContainer.children.forEach(function(a){e(a.tileData.tiles,!0)}),(c||!d)&&(d=this._tileGridContainer.addChild(new s),d.addEventListener(s.Events.FullRender,this)),d.tileData&&e(d.tileData.tiles),d.setTileDataAnimated(i.tileDataForRangeAndMapType(a,this._mapType),c),a._mapType=this._mapType,this._tileRange=a,delete this._shouldPreserveCurrentTileGrid}}},_updateCamera:function(){var a=this._zoomLevel,b=this._renderingMapRect.origin,c=this._ensureRenderingFrame().size.width;this._tileGridContainer.children.forEach(function(d){function e(a){return Math.max(Math.min(a+m,c)-Math.max(a,0),0)}var f=d.tileData.range.min,h=f.z,i=Math.pow(2,h),j=Math.pow(2,a-h),k=Math.pow(2,h)*(g.tileSize*j),l=new E(g.mod(f.x/i-b.x,1)*k,(f.y/i-b.y)*k),m=d.size.width*j,n=e(l.x);c/2>n&&(e(l.x+k)>n?l.x+=k:e(l.x-k)>n&&(l.x-=k)),d.position=l,d.scale=j}),this._backgroundGrid.update(b,a)},_positionForPanningTile:function(){function a(a){return Math.round(a*j)/j}var b=this._panningReferenceTile;if(b){var c=this._zoomLevel,d=this._renderingMapRect.origin,e=b.z,f=Math.pow(2,e),h=Math.pow(2,c-e),i=Math.pow(2,e)*(g.tileSize*h),j=g.devicePixelRatio;return new E(a((b.x/f-d.x)*i),a((b.y/f-d.y)*i))}},_isInitialInteractionTargetInUIElement:function(){var a=this._mapUserInteractionController.initialEventTargetForCurrentInteraction;return a?this._annotationsController.isElementInCallout(a)?!0:this._controlsLayer.element.contains(a)?!0:!1:!1},_zoom:function(){return this._zoomLevel||this._setZoomAndAxes(g.zoomLevelForMapRectInViewport(this._visibleMapRect,this._ensureRenderingFrame().size,g.tileSize)),this._zoomLevel},_setZoom:function(a){var b=this._zoom();this._setZoomAndAxes(a),this._zoomLevel!==b&&this._frameOrZoomDidChange()},_setZoomAndAxes:function(a){var b=g.clamp(a,this._minZoomLevel,this._maxZoomLevel);if(isNaN(b))throw new TypeError("Zoom step is not a number");if(b!==this._zoomLevel){var c=Math.pow(2,b-Math.ceil(b));this._worldSize=Math.pow(2,Math.ceil(b))*(g.tileSize*c),this._zoomLevel=b}this._controlsLayer.zoomLevelDidChange()},_updateMinAndMaxZoomLevels:function(){h.ready&&(this._minZoomLevel=0,this._maxZoomLevel=Number.MAX_VALUE,h.types[this._mapType].tileSources.forEach(function(a){this._minZoomLevel=Math.max(this._minZoomLevel,a.minZoomLevel),this._maxZoomLevel=Math.min(this._maxZoomLevel,a.maxZoomLevel)},this));var a=this._ensureRenderingFrame().size,b=Math.max(a.width,a.height),c=Math.ceil(b/g.tileSize)+1;this._minZoomLevel=Math.max(this._minZoomLevel,g.log2(c)),T&&(this._minZoomLevel=Math.ceil(this._minZoomLevel)),this._prefetchingZoomLevels=[];for(var d=Math.ceil(this._minZoomLevel);d<this._maxZoomLevel;d+=Q)this._prefetchingZoomLevels.push(d);this._setZoom(this._zoom())},_handleZoomStartEvent:function(a){if(!(a.zoomIn&&this._zoomLevel>=this._maxZoomLevel||!a.zoomIn&&this._zoomLevel<=this._minZoomLevel)&&(this._cameraIsZooming||this.dispatchEvent(new G.Event(ba.ZOOM_START)))){var b=this._linearZoomController.start(this._zoomLevel,a.zoomIn);b&&(this._interactiveZoomDidStart(this._zoomLevel),J.log("MAP_ZOOM_IN",{map:this}),a.zoomIn||this._addTileGridsForZoomOut())}},_handleZoomEndEvent:function(a){this._linearZoomController.stop()},_interactiveZoomDidStart:function(){this._cameraIsZooming||(this._shouldSuspendTrackingUserLocation=!1,this._cameraIsZooming=!0,this._cameraIsPanning&&this._layersPanningWillEnd(),this._startCoalescingRegionChangeEvents())},_interactiveZoomDidEnd:function(){this._cameraIsZooming&&(this._cameraIsZooming=!1,this._cameraIsPanning&&this._layersPanningWillStart(),this._stopCoalescingRegionChangeEvents(),this._tileUpdatesSuspensionMayHaveEnded(!0),this._shouldSuspendTrackingUserLocation=!0,this.dispatchEvent(new G.Event(ba.ZOOM_END)))},_interactivePanDidStart:function(){this._cameraIsPanning=!0,g.classList.add(this._rootNode.element,V),this._cameraIsZooming||this._layersPanningWillStart(),this._startCoalescingRegionChangeEvents()},_interactivePanDidEnd:function(){this._cameraIsPanning=!1,g.classList.remove(this._rootNode.element,V),this._layersPanningWillEnd(),this._stopCoalescingRegionChangeEvents(),this.dispatchEvent(new G.Event(ba.SCROLL_END))},_layersPanningWillStart:function(){var a=this._tileGrid();this._panningReferenceTile=a.tileData.range.min,this._panningReferencePosition=a.position.copy(),this._overlaysController.panningWillStart(),this._annotationsController.panningWillStart()},_layersPanningDidChange:function(a){this._overlaysController.panningDidChange(a),this._annotationsController.panningDidChange(a)},_layersPanningWillEnd:function(){delete this._panningReferenceTile,delete this._panningReferencePosition,this._overlaysController.panningDidEnd(),this._annotationsController.panningDidEnd()},_annotationDraggingWillStart:function(){g.classList.add(this._rootNode.element,W)},_annotationDraggingDidEnd:function(){g.classList.remove(this._rootNode.element,W)},_setVisibleMapRect:function(a,b){a.origin.x=g.mod(a.minX(),1),a.origin.y=g.clamp(a.minY(),0,N-a.size.height);var c=this._visibleMapRectAnimationDuration;if(delete this._visibleMapRectAnimationDuration,!this._visibleMapRect.equals(a)){if(b||c>0)return void this._animateMapRectTo(a,c);this._dispatchRegionChangeStartEvent(),this._setVisibleMapRectValue(a),this._updateDisplay(),this._dispatchRegionChangeEndEvent()}},_setVisibleMapRectValue:function(a){this._visibleMapRect=a,this._renderingMapRect=a;var b=this._padding,c=this._ensureRenderingFrame(),d=this._ensureVisibleFrame();return b.equals(r.Zero)||d.equals(F.ZeroRect)||(this._renderingMapRect=new p(a.minX()-b.left/d.size.width*a.size.width,a.minY()-b.top/d.size.height*a.size.height,a.size.width*(c.size.width/d.size.width),a.size.height*(c.size.height/d.size.height))),a},_animateMapRectTo:function(a,b){this._visibleMapRectAnimation?(this._visibleMapRectAnimation.cancel(),delete this._visibleMapRectAnimation):this._dispatchRegionChangeStartEvent();var c=this._visibleMapRect,d=this._visibleFrame.size;this._animatingVisibleMapRect=!0;var e=g.zoomLevelForMapRectInViewport(c,d,g.tileSize),f=g.zoomLevelForMapRectInViewport(a,d,g.tileSize);this._shouldUpdateTilesDuringVisibleMapRectAnimation=e===f,this._visibleMapRectAnimation=new q({delegate:this,node:this._rootNode,duration:b||O,from:c,to:a})},_padMapRect:function(a,b){return g.checkType(b,"object","[MapKit] padding must be an object with any of `top`, `left`, `bottom`, `right`"),["top","left","bottom","right"].forEach(function(a){if(a in b){var c=b[a];if("number"!=typeof c||0>c)throw new Error("[MapKit] property `"+a+"` of padding must be a number >= 0; got `"+c+"`")}else b[a]=0}),this._setZoomAndAxes(g.zoomLevelForMapRectInViewport(a,this._ensureRenderingFrame().size,g.tileSize)),a._pad({top:b.top/this._worldSize,left:b.left/this._worldSize,bottom:b.bottom/this._worldSize,right:b.right/this._worldSize})},_ensureContainerIsPositioned:function(){var a=this._rootNode.element,b=a.ownerDocument.defaultView.getComputedStyle(a).position;"static"===b&&(a.style.position="relative")},_dispatchLoadEvent:function(){this.dispatchEvent(new G.Event(ba.LOAD))},_dispatchErrorEvent:function(){this.dispatchEvent(new G.Event(ba.ERROR))},_overlaysControllerShouldCreateNode:function(){this._rootNode.scheduleUpdate(this)},_createNodeForOverlaysController:function(){var a=this._overlaysController.node;a&&a.parent!==this._rootNode&&(this._rootNode.insertBefore(a,this._annotationsController.node),this._overlaysController.mapSizeDidUpdate(this._ensureRenderingFrame().size))},_overlaySelectionDidChange:function(a){a.selected&&(this._annotationsController.selectedItem=null);var b=new G.Event(a.selected?ba.SELECT:ba.DESELECT);b.overlay=a,this.dispatchEvent(b)},_annotationSelectionDidChange:function(a){a.selected&&(this._overlaysController.selectedItem=null),this._dispatchEventWithAnnotation(a.selected?ba.SELECT:ba.DESELECT,a)},_dispatchEventWithAnnotation:function(a,b){var c=new G.Event(a);c.annotation=b,this.dispatchEvent(c)},_dispatchRegionChangeStartEvent:function(){this._regionChangeEventsCoalescingData&&this._regionChangeEventsCoalescingData.startEventDispatched||(this._shouldSuspendTrackingUserLocation&&(this.tracksUserLocation=!1),this.dispatchEvent(new G.Event(ba.REGION_CHANGE_START)),this._releasePrefetchedTiles(),this._regionChangeEventsCoalescingData&&(this._regionChangeEventsCoalescingData.startEventDispatched=!0))},_dispatchRegionChangeEndEvent:function(){return this._regionChangeEventsCoalescingData?void(this._regionChangeEventsCoalescingData.endEventShouldDispatch=!0):(this.dispatchEvent(new G.Event(ba.REGION_CHANGE_END)),void this._prefetchTiles())},_startCoalescingRegionChangeEvents:function(){this._regionChangeEventsCoalescingData={startEventDispatched:!1,endEventShouldDispatch:!1}},_stopCoalescingRegionChangeEvents:function(){this._regionChangeEventsCoalescingData&&this._regionChangeEventsCoalescingData.endEventShouldDispatch&&(delete this._regionChangeEventsCoalescingData,this._dispatchRegionChangeEndEvent())},_tileUpdatesSuspensionMayHaveEnded:function(a){this._shouldSuspendTileUpdates()||(this._shouldPreserveCurrentTileGrid=a,this._updateDisplay())},_shouldSuspendTileUpdates:function(){return this._cameraIsZooming||this._animatingVisibleMapRect&&!this._shouldUpdateTilesDuringVisibleMapRectAnimation},_addWaitingAnnotations:function(){this._shouldWaitForTilesAndControls()||this._annotationsController.addWaitingAnnotations()},_tileGridDidFullyRender:function(){this._addWaitingAnnotations(),this._removePreviousTileGrids()},_handleLocaleChange:function(a){var b=this._ensureRenderingFrame();0!==b.size.width&&0!==b.size.height&&(this._shouldPreserveCurrentTileGrid=!0,this._updateDisplay(),g.classList.toggle(this._controlsLayer.element,X,a.locale.rtl))},_updateBackgroundGridMode:function(){this._backgroundGrid.mode=j.Modes[this._mapType===d.MapTypes.Standard?"Light":"Dark"]},_removeTileGrid:function(a){a.remove(),a.tileData&&e(a.tileData.tiles)},_removePreviousTileGrids:function(){for(;this._tileGridContainer.children.length>1;)this._removeTileGrid(this._tileGridContainer.firstChild)},_tileGrid:function(){return this._tileGridContainer.lastChild;
},_addTileGridsForZoomOut:function(a){this._supportsPrefetchingForZooming()&&(this._iterateDecrementedZoomLevels(function(b){var c=i.cachedTilesForRangeAndMapType(b,this._mapType,!0),d=this._tileGridContainer.insertBefore(new s,this._tileGridContainer.firstChild);return d.tileData={range:b,tiles:c},!a}),this._releasePrefetchedTiles())},_releasePrefetchedTiles:function(){e(this._prefetchedTilesForPanning),e(this._prefetchedTilesForZooming),this._prefetchedTilesForPanning=[],this._prefetchedTilesForZooming=[]},__forcesPrefetchingForPanningSupport:!1,__forcesPrefetchingForZoomingSupport:!1,_supportsPrefetchingForPanning:function(){return this.__forcesPrefetchingForPanningSupport||U&&h.supportsPrefetchingForPanning},_supportsPrefetchingForZooming:function(){return this.__forcesPrefetchingForZoomingSupport||U&&h.supportsPrefetchingForZooming},_prefetchTiles:function(){(this._supportsPrefetchingForPanning()||this._supportsPrefetchingForZooming())&&(this._releasePrefetchedTiles(),this._scrollable&&this._prefetchTilesForPanning(),this._zoomable&&this._prefetchTilesForZooming())},_prefetchTilesForPanning:function(){if(this._supportsPrefetchingForPanning()){var a=i.tileRangeForMapPointFrameAndZoom(this._visibleMapRect.scale(2).origin,this._ensureRenderingFrame(),Math.ceil(this._zoom()));this._prefetchedTilesForPanning=i.lowPriorityTilesForRangeAndMapType(a,this._mapType)}},_prefetchTilesForZooming:function(){this._supportsPrefetchingForZooming()&&this._iterateDecrementedZoomLevels(function(a){var b=i.lowPriorityTilesForRangeAndMapType(a,this._mapType,!0);return this._prefetchedTilesForZooming=this._prefetchedTilesForZooming.concat(b),!0})},_iterateDecrementedZoomLevels:function(a){if(0!==this._prefetchingZoomLevels.length)for(var b=this._zoom(),c=this._ensureRenderingFrame(),d=this._prefetchingZoomLevels.length-1;d>=0;--d){var e=this._prefetchingZoomLevels[d];if(!(e>=b)){var f=this._visibleMapRect.scale(Math.pow(2,b-e)),g=i.tileRangeForMapPointFrameAndZoom(f.origin,c,e),h=a.call(this,g);if(!h)return}}},_elementWasTapped:function(a){function b(a){return"a"===a.localName||"button"===a.localName||"input"===a.localName&&"button"===a.type}for(;null!==a;a=a.parentNode)if(b(a))return void a.click()},_devicePixelRatioDidChange:function(a){this._shouldPreserveCurrentTileGrid=!0,this._annotationsController.devicePixelRatioDidChange(),this._overlaysController.devicePixelRatioDidChange(),this._updateDisplay(),this._controlsLayer.devicePixelRatioDidChange(a)}},b.exports=d},{"./analytics/analytics":44,"./annotations/annotation":47,"./annotations/annotations-controller":48,"./configuration":53,"./controls/controls-layer":56,"./controls/user-location-control":60,"./controls/zoom-control":61,"./interaction/linear-zoom-controller":65,"./interaction/map-pan-deceleration":67,"./interaction/map-pinch-deceleration":68,"./interaction/map-user-interaction-controller":69,"./layer-items-controller":71,"./localizer":74,"./overlays/overlay":78,"./overlays/overlays-controller":79,"./rendering/background-grid":83,"./rendering/tile-grid":86,"./rendering/tile-manager":87,"./types":97,"./user-location/user-location-controller":99,"./utils":101,"./visible-map-rect-animation":102,"device-pixel-ratio":4,"dom-events":7,"geometry/point":9,"geometry/rect":10,"render-tree":28}],76:[function(a,b,c){function d(a){f.call(this,a.coordinate,e(a),{style:i})}function e(a){return!a.stale&&a.location.accuracy>0&&a.location.accuracy<j?a.location.accuracy:0}var f=a("./circle-overlay"),g=a("./style"),h=a("../utils"),i=new g({strokeColor:null}),j=3e4;d.prototype=h.inheritPrototype(f,d,{updateForUserLocation:function(a){this.coordinate=a.coordinate,this.radius=e(a)}}),b.exports=d},{"../utils":101,"./circle-overlay":77,"./style":82}],77:[function(a,b,c){function d(a,b,c){e.call(this,c),this.coordinate=a,this.radius=b}var e=a("./overlay"),f=a("../types").Coordinate,g=a("../types").MapPoint,h=a("../types").MapRect,i=a("../utils"),j=2*Math.PI,k=.001;d.prototype=i.inheritPrototype(e,d,{get coordinate(){return this._coordinate},set coordinate(a){i.checkInstance(a,f,"[MapKit] CircleOverlay.coordinate expected a Coordinate value, but got `"+a+"` instead."),this._coordinate&&this._coordinate.latitude===a.latitude&&this._coordinate.longitude===a.longitude||(this._coordinate=a.copy(),this._updateGeometry())},get radius(){return this._radius},set radius(a){var b="[MapKit] CircleOverlay.radius expected a non-negative number (radius in meters), but got `"+a+"` instead.";i.checkType(a,"number",b),0>a&&console.warn(b);var c=Math.max(0,a);this._radius!==c&&(this._radius=c,this._updateGeometry())},_handlePanningStartAtScale:function(a){this._scaledRadius=this._mapRadius*a},_calculateBoundingRect:function(){if(!this._coordinate||isNaN(this._radius))return null;var a=this._center=this._coordinate.toMapPoint(),b=this._mapRadius=this._radius*i.mapUnitsPerMeterAtLatitude(this._coordinate.latitude);return new h(a.x-b,a.y-b,2*b,2*b)},_drawClipped:function(a,b,c,d,e,f,h){function i(a,b){var c=r-a,d=s-b;return t*t>=c*c+d*d}if(!h||this._mapRadius<b.size.width||this._mapRadius<b.size.height)return!1;var l,m=this.style._halfStrokeWidthAtResolution()/d,n=b.minX()-m,o=b.maxX()+m,p=b.minY()-m,q=b.maxY()+m,r=this._center.x,s=this._center.y,t=this._mapRadius,u=[];i(o,q)&&u.push(new g(o,q));var v=Math.acos((o-r)/t);if(!isNaN(v)){var w=s+t*Math.sin(v);w>=p&&q>=w&&(l=new g(o,w),l.angle=v,u.push(l)),w=s-t*Math.sin(v),w>=p&&q>=w&&(l=new g(o,w),l.angle=j-v,u.push(l))}i(o,p)&&u.push(new g(o,p));var x=Math.asin((p-s)/t);if(!isNaN(x)){var y=r+t*Math.cos(x);y>=n&&o>=y&&(l=new g(y,p),l.angle=(x+j)%j,u.push(l)),y=r-t*Math.cos(x),y>=n&&o>=y&&(l=new g(y,p),l.angle=Math.PI-x,u.push(l))}i(n,p)&&u.push(new g(n,p));var z=Math.acos((n-r)/t);if(!isNaN(z)){var A=s-t*Math.sin(z);A>=p&&q>=A&&(l=new g(n,A),l.angle=j-z,u.push(l)),A=s+t*Math.sin(z),A>=p&&q>=A&&(l=new g(n,A),l.angle=z,u.push(l))}i(n,q)&&u.push(new g(n,q));var B=Math.asin((q-s)/t);if(!isNaN(B)){var C=r-t*Math.cos(B);C>=n&&o>=C&&(l=new g(C,q),l.angle=Math.PI-B,u.push(l)),C=r+t*Math.cos(B),C>=n&&o>=C&&(l=new g(C,q),l.angle=(B+j)%j,u.push(l))}for(var D=u.length,E=1;D>2&&D>E&&(!isNaN(u[E-1].angle)||isNaN(u[E].angle)||isNaN(u[(E+1)%D].angle));++E);if(D>E){for(var F=(E+1)%D;D>2&&!isNaN(u[F].angle)&&!isNaN(u[(F+1)%D].angle);F=(F+1)%D);var G=this._panningReferencePosition?this._scaledRadius:this._mapRadius*d,H=Math.abs(u[E].angle-u[F].angle),I=G*H,J=2*G*Math.sin(H/2),K=I-J>k;if(f){K?this._createArcPath(a,c,d,u[E].angle,u[F].angle):(a.beginPath(),a.moveTo(u[E].x*d+c.x,u[E].y*d+c.y),a.lineTo(u[F].x*d+c.x,u[F].y*d+c.y));for(var L=(F+1)%D;isNaN(u[L].angle);L=(L+1)%D)a.lineTo(u[L].x*d+c.x,u[L].y*d+c.y);this._fillPath(a,e)}h&&(K?this._createArcPath(a,c,d,u[E].angle,u[F].angle):(a.beginPath(),a.moveTo(u[E].x*d+c.x,u[E].y*d+c.y),a.lineTo(u[F].x*d+c.x,u[F].y*d+c.y)),this._strokePath(a,e))}else D>0&&(a.save(),a.fillStyle=e.fillColor,a.globalAlpha=e.fillOpacity,a.fillRect(b.minX()*d+c.x,b.minY()*d+c.y,b.size.width*d,b.size.height*d),a.restore());return!0},_createPath:function(a,b,c,d){return this._panningReferencePosition&&this._scaledRadius<.5||this._mapRadius*d<.5?!1:(this._createArcPath(a,c,d,0,j),!0)},_createArcPath:function(a,b,c,d,e){a.beginPath(),this._panningReferencePosition?a.arc(this._panningReferencePosition.x+b.x,this._panningReferencePosition.y+b.y,this._scaledRadius,d,e,!0):a.arc(this._center.x*c+b.x,this._center.y*c+b.y,this._mapRadius*c,d,e,!0)}}),b.exports=d},{"../types":97,"../utils":101,"./overlay":78}],78:[function(a,b,c){function d(a){g.EventTarget(this),a&&(f.checkType(a,"object"),i.forEach(function(b){b in a&&(this[b]=a[b])},this),Object.keys(a).forEach(function(a){i.indexOf(a)<0&&console.warn("[MapKit] Unknown option: "+a+". Use the data property to store custom data.")}))}var e=a("./style"),f=a("../utils"),g=a("dom-events"),h=a("geometry/point"),i=["visible","draggable","enabled","selected","style","data"];d.Events={Select:"select",Deselect:"deselect",DragStart:"drag-start",DragEnd:"drag-end"},d.prototype={constructor:d,_internalDelegate:null,_map:null,_visible:!0,_draggable:!1,_enabled:!0,_selected:!1,_fillable:!0,get map(){return this._map},set map(a){console.warn("[MapKit] The `map` property of an overlay is read-only. Use map.addOverlay() instead.")},get data(){return this.hasOwnProperty("_data")||(this._data={}),this._data},set data(a){this._data=a},get visible(){return this._visible},set visible(a){var b=!!a;this._visible!==b&&(this._visible=b,this._updatedProperty("visible"))},get draggable(){return this._draggable},set draggable(a){var b=!!a;this._draggable!==b&&(this._draggable=b,this._updatedProperty("draggable"))},get enabled(){return this._enabled},set enabled(a){this._enabled=!!a},get selected(){return this._selected},set selected(a){var b=!!a;b!==this._selected&&(this._selected=b,this.dispatchEvent(new g.Event(this._selected?d.Events.Select:d.Events.Deselect)),this._updatedProperty("selected"))},get style(){return this._style||(this._style=new e,this._style.addEventListener(e.UPDATE_EVENT,this)),this._style},set style(a){if(this._style){if(this._style===a)return;this._style.removeEventListener(e.UPDATE_EVENT,this)}f.checkInstance(a,e,"[MapKit] Expected a mapkit.Style value for Overlay.style, but got `"+a+"` instead."),this._style!==a&&(this._style=a,this._style&&this._style.addEventListener(e.UPDATE_EVENT,this),this._updatedProperty("style"))},handleEvent:function(a){a.type===e.UPDATE_EVENT&&this._updatedProperty("style")},_draw:function(a,b,c,d,e){e||(e=this.style);var f=this._fillable&&e._shouldFill(),g=e._shouldStroke();(f||g)&&(a.save(),!this._drawClipped(a,b,c,d,e,f,g)&&this._createPath(a,b,c,d)&&(f&&this._fillPath(a,e),g&&this._strokePath(a,e)),a.restore())},_drawClipped:function(){return!1},_fillPath:function(a,b){a.save(),a.fillStyle=b.fillColor,a.globalAlpha=b.fillOpacity,a.fill(b.fillRule),a.restore()},_strokePath:function(a,b){a.save(),a.strokeStyle=b.strokeColor,a.globalAlpha=b.strokeOpacity;var c=f.devicePixelRatio;a.lineWidth=b.lineWidth*c,b.lineDash.length>0&&"function"==typeof a.setLineDash&&(a.setLineDash(b.lineDash.map(function(a){return a*c})),a.lineDashOffset=b.lineDashOffset*c),a.lineJoin=b.lineJoin,a.lineCap=b.lineCap,a.stroke(),a.restore()},_handlePanningStartAtScale:function(a){},_createPath:function(a,b){return!1},_canBePicked:function(){return this._shown&&this._visible},_panningWillStartAtScale:function(a){this._panningReferencePosition=new h(this._boundingRect.midX()*a,this._boundingRect.midY()*a),this._handlePanningStartAtScale(a)},_updateGeometry:function(){var a=this._calculateBoundingRect();a&&(this._boundingRect=a,this._updatedProperty("geometry"))},_updatedProperty:function(a){this._internalDelegate&&this._internalDelegate.overlayPropertyDidChange(this,a)}},b.exports=d},{"../utils":101,"./style":82,"dom-events":7,"geometry/point":9}],79:[function(a,b,c){function d(a){f.call(this,a)}function e(a,b,c,d,e,f){a._shown=!1;var g=a.style._halfStrokeWidthAtResolution()/d;if(!(!a.visible||a._boundingRect.maxY()+g<b.minY()||a._boundingRect.minY()-g>b.maxY()))for(var h=a._boundingRect.minX()-g,i=a._boundingRect.maxX()+g,k=-1;1>=k;++k){var m=0===k?b:new j(b.origin.x-k,b.origin.y,b.size.width,b.size.height);if(i>=m.minX()&&h<=m.maxX()){a._shown=!0;var n=new l(c.x+d*k,c.y);a._draw(e,m,n,d,f)}}}var f=a("../layer-items-controller"),g=a("./overlay"),h=a("./accuracy-ring-overlay"),i=a("../utils"),j=a("../types").MapRect,k=a("render-tree"),l=a("geometry/point"),m="mk-overlays",n=.1,o=.4;d.prototype=i.inheritPrototype(f,d,{itemConstructor:g,itemName:"overlay",capitalizedItemName:"Overlay",_node:null,get node(){return!this._node&&this._items.length>0&&(this._canvas=i.htmlElement("canvas",{"class":m}),this._context=this._canvas.getContext("2d"),this._node=new k.Node(this._canvas)),this._node},isItemExposed:function(a){return a!==this._userLocationAccuracyRingOverlay},removeUserLocationAccuracyRingOverlay:function(){this._userLocationAccuracyRingOverlay&&(this.removeItem(this._userLocationAccuracyRingOverlay),delete this._userLocationAccuracyRingOverlay)},removedReferenceToMap:function(){this._items.forEach(function(a){delete a._map})},mapSizeDidUpdate:function(a){this._node&&!a.equals(this._node.size)&&(this._node.size=a.copy(),this._updateCanvasSize())},mapTypeWasSet:function(a){this._userLocationAccuracyRingOverlay&&(this._userLocationAccuracyRingOverlay.style.fillOpacity=a===mapkit.Map.MapTypes.Standard?n:o)},panningWillStart:function(){var a=this._map._renderingMapRect.origin,b=this._map._worldSize*i.devicePixelRatio;this._panningReferencePosition=new l(-a.x*b,-a.y*b),this._items.forEach(function(a){a._panningWillStartAtScale(b)},this)},panningDidChange:function(a){this._panningTranslation=a,this._scheduleUpdate()},panningDidEnd:function(){delete this._panningReferencePosition,this._items.forEach(function(a){delete a._panningReferencePosition})},updateRendering:function(){this._deletePreviousPointForPickingItem(),this._scheduleUpdate()},overlayPropertyDidChange:function(a,b){switch(b){case"selected":a.selected?this.selectedItem=a:this.selectedItem=null,this._map._overlaySelectionDidChange(a),this._scheduleUpdate();break;case"style":case"visible":case"geometry":this._scheduleUpdate();break;case"draggable":}},updateUserLocationAccuracyRingOverlay:function(a){return a.coordinate?this._userLocationAccuracyRingOverlay?void this._userLocationAccuracyRingOverlay.updateForUserLocation(a):(this._userLocationAccuracyRingOverlay=this.addItem(new h(a)),void this.mapTypeWasSet(this._map.mapType)):void 0},addedItem:function(a,b){f.prototype.addedItem.call(this,a,b),a._map=this._map,a.selected&&(this.selectedItem=a),this._scheduleUpdate()},removedItem:function(a){delete a._map,f.prototype.removedItem.call(this,a),this._scheduleUpdate()},devicePixelRatioDidChange:function(){this._updateCanvasSize()},updateNode:function(){0===this._items.length?this._destroyNode():this._map&&this._renderOverlays(this._panningReferencePosition&&this._panningTranslation),delete this._panningTranslation},pickableItemsCloseToPoint:function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d");c.width=this._selectionDistance,c.height=this._selectionDistance;var f=this._map._renderingMapRect,g=this._selectionDistance/2,h=b.x-g,k=b.y-g,m=this._map._worldSize,n=new l(-f.origin.x*m-h,-f.origin.y*m-k),o=this._selectionDistance/i.devicePixelRatio,p=new j(-n.x/m,-n.y/m,c.width/m,c.height/m),q=!1;return a.filter(function(a){if(!a._shown)return!1;if(q&&(d.clearRect(0,0,c.width,c.height),q=!1),e(a,p,n,m,d,a.style._styleForHitTesting(o)),!a._shown)return a._shown=!0,!1;q=!0;var b=d.getImageData(g,g,1,1).data;return!!b[3]},this).reverse()},_renderOverlays:function(a){var b=this._map._renderingMapRect,c=i.devicePixelRatio,d=this._map._worldSize*c;this._pendingSizeUpdate?(this._canvas.width=this._node.size.width*c,this._canvas.height=this._node.size.height*c,delete this._pendingSizeUpdate):this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.save();for(var f=a?new l(this._panningReferencePosition.x+a.x*c,this._panningReferencePosition.y+a.y*c):new l(-b.origin.x*d,-b.origin.y*d),g=0,h=this._items.length;h>g;++g)this._items[g].selected||e(this._items[g],b,f,d,this._context);this._selectedItem&&e(this._selectedItem,b,f,d,this._context),this._context.restore()},_updateCanvasSize:function(){this._pendingSizeUpdate=!0,this._scheduleUpdate()},_scheduleUpdate:function(){this._node?this._node.scheduleUpdate(this):this._map&&this._map._overlaysControllerShouldCreateNode()},_destroyNode:function(){this._node.remove(),delete this._node,delete this._canvas,delete this._context}}),b.exports=d},{"../layer-items-controller":71,"../types":97,"../utils":101,"./accuracy-ring-overlay":76,"./overlay":78,"geometry/point":9,"render-tree":28}],80:[function(a,b,c){function d(a,b){g.call(this,b),this.points=a,this._updateGeometry()}function e(a){var b=a.filter(function(a){return a.length>2}).map(function(a){var b=a.reduce(function(a,b){return b.x<a.xMin&&(a.xMin=b.x),b.x>a.xMax&&(a.xMax=b.x),b.y<a.yMin&&(a.yMin=b.y),b.y>a.yMax&&(a.yMax=b.y),a},{xMin:1/0,xMax:-(1/0),yMin:1,yMax:0});return new i(b.xMin,b.yMin,b.xMax-b.xMin,b.yMax-b.yMin)}).sort(function(a,b){return a.minX()-b.minX()});return i._boundingRectForSortedRects(b)}function f(a,b,c){for(var d=b.minX()-c,e=b.minY()-c,f=b.maxX()+c,g=b.maxY()+c,h=[],i=0,j=a.length;j>i;++i){for(var k=a[i],l=[],m=0,n=k.length;n>m;++m){var o=k[m];(o.x>=d||k[(m-1+n)%n].x>=d||k[(m+1)%n].x>=d)&&l.push(o)}var p=[];for(m=0,n=l.length;n>m;++m)o=l[m],(o.y>=e||l[(m-1+n)%n].y>=e||l[(m+1)%n].y>=e)&&p.push(o);var q=[];for(m=0,n=p.length;n>m;++m)o=p[m],(o.x<=f||p[(m-1+n)%n].x<=f||p[(m+1)%n].x<=f)&&q.push(o);var r=[];for(m=0,n=q.length;n>m;++m)o=q[m],(o.y<=g||q[(m-1+n)%n].y<=g||q[(m+1)%n].y<=g)&&r.push(o);r.length>2&&h.push(r)}return h}var g=a("./overlay"),h=a("../types").Coordinate,i=a("../types").MapRect,j=a("../types").MapPoint,k=a("../line-simplification"),l=a("../utils"),m=new j;d.prototype=l.inheritPrototype(g,d,{get points(){return this._points.map(function(a){return a.slice()})},set points(a){l.checkArray(a,"[MapKit] PolygonOverlay.points expected an array of Coordinates."),Array.isArray(a[0])||(a=[a]),this._points=a.map(function(a,b){return l.checkArray(a,"[MapKit] PolygonOverlay.points expected an array at index: "+b),a.slice()}),this._polygons=this._points.map(function(a,b){return a.map(function(a,c){return l.checkInstance(a,h,"[MapKit] PolygonOverlay.points expected a Coordinate at index: "+b+", "+c),a.toUnwrappedMapPoint()})}),this._updateGeometry()},_calculateBoundingRect:function(){var a=e(this._polygons);return delete this._simplifiedPolygonsLevel,a.size.width>1&&console.warn("[MapKit] Polygon overlay spans over 360 in longitude and may not render correctly."),this._polygons.forEach(function(b){0!==b.length&&(b.forEach(function(b){var c=l.mod(b.x,1);b.x=c+(c<a.minX()?1:0)}),k.preprocessPoints(b,!0))}),a},_createPath:function(a,b,c,d){var e=d;this._simplifyPolygonsAtScale(e);var g,h=this.style._halfStrokeWidthAtResolution();if(this._panningReferencePosition){var i=this._scalePolygons(e),j=b.scale(e,m);g=j._contains(this._boundingRect.scale(e,m))?i:f(i,j,h),e=1}else g=b._contains(this._boundingRect)?this._simplifiedPolygons:f(this._simplifiedPolygons,b,h/d);return 0===g.length?!1:(a.beginPath(),g.forEach(function(b){a.moveTo(b[0].x*e+c.x,b[0].y*e+c.y);for(var d=1;d<b.length;d++){var f=b[d];a.lineTo(f.x*e+c.x,f.y*e+c.y)}a.closePath()}),!0)},_simplifyPolygonsAtScale:function(a){var b=Math.ceil(l.log2(a));if(this._simplifiedPolygonsLevel!==b){delete this._scaledPolygons;var c=this._simplifiedPolygonsLevel>b?this._simplifiedPolygons:this._polygons;this._simplifiedPolygons=[],c.forEach(function(a){var c=k.filterPointsAtScale(a,Math.pow(2,b));c.length>0&&this._simplifiedPolygons.push(c)},this),this._simplifiedPolygonsLevel=b}},_scalePolygons:function(a){return this._scaledPolygons||(this._scaledPolygons=this._simplifiedPolygons.map(function(b){return b.map(function(b){return new j(b.x*a,b.y*a)})})),this._scaledPolygons}}),b.exports=d},{"../line-simplification":72,"../types":97,"../utils":101,"./overlay":78}],81:[function(a,b,c){function d(a,b){f.call(this,b),this.points=a,this._updateGeometry()}function e(a,b,c){for(var d,e=b.minX()-c,f=b.minY()-c,g=b.maxX()+c,h=b.maxY()+c,i=[],j=0,k=a.length;k-1>j;++j){var l,m=a[j],n=a[j+1],o=n.x-m.x;if(0!==o){var p=(e-m.x)/o,q=(g-m.x)/o;l=!(0>p&&0>q||p>1&&q>1)}else l=m.x>=e&&m.x<=g;if(l){var r=n.y-m.y;if(0!==r){var s=(f-m.y)/r,t=(h-m.y)/r;l=!(0>s&&0>t||s>1&&t>1)}else l=m.y>=f&&m.y<=h}l?(d||(d=[]),d.push(m)):d&&(d.push(m),i.push(d),d=null)}return d&&(d.push(n),i.push(d)),i}var f=a("./overlay"),g=a("../types").Coordinate,h=a("../types").MapRect,i=a("../types").MapPoint,j=a("../line-simplification"),k=a("../utils"),l=new i;d.prototype=k.inheritPrototype(f,d,{_fillable:!1,get points(){return this._points.slice()},set points(a){k.checkInstance(a,Array,"[MapKit] PolylineOverlay.points expected an array of Coordinates."),this._points=a.slice(),this._mapPoints=this._points.map(function(a,b){return k.checkInstance(a,g,"[MapKit] PolylineOverlay.points expected a Coordinate at index: "+b),a.toUnwrappedMapPoint()}),this._pointsNeedRemapping=!0,this._updateGeometry()},_calculateBoundingRect:function(){if(0===this._mapPoints.length)return new h(0,0,0,0);var a=this._mapPoints.reduce(function(a,b){return b.x<a.xMin&&(a.xMin=b.x),b.x>a.xMax&&(a.xMax=b.x),b.y<a.yMin&&(a.yMin=b.y),b.y>a.yMax&&(a.yMax=b.y),a},{xMin:1/0,xMax:-(1/0),yMin:1,yMax:0}),b=a.xMax-a.xMin,c=k.mod(a.xMin,1);if(this._pointsNeedRemapping){delete this._pointsNeedRemapping,b>1&&console.warn("[MapKit] Polyline overlay spans over 360 in longitude and may not render correctly.");var d=a.xMin-c;this._mapPoints.forEach(function(a){a.x-=d}),j.preprocessPoints(this._mapPoints),delete this._simplifiedMapPointsLevel}return new h(c,a.yMin,b,a.yMax-a.yMin)},_createPath:function(a,b,c,d){var f=d;this._simplifyPointsAtScale(f);var g,h=this.style._halfStrokeWidthAtResolution();if(this._panningReferencePosition){var i=this._scaleMapPoints(f),j=b.scale(f,l);g=j._contains(this._boundingRect.scale(f,l))?0===i.length?[]:[i]:e(i,j,h),f=1}else g=b._contains(this._boundingRect)?0===this._simplifiedMapPoints.length?[]:[this._simplifiedMapPoints]:e(this._simplifiedMapPoints,b,h/d);return 0===g.length?!1:(a.beginPath(),g.forEach(function(b){a.moveTo(b[0].x*f+c.x,b[0].y*f+c.y);for(var d=1;d<b.length;d++){var e=b[d];a.lineTo(e.x*f+c.x,e.y*f+c.y)}}),!0)},_simplifyPointsAtScale:function(a){var b=Math.ceil(k.log2(a));if(this._simplifiedMapPointsLevel!==b){delete this._scaledMapPoints;var c=this._simplifiedMapPointsLevel>b?this._simplifiedMapPoints:this._mapPoints;this._simplifiedMapPoints=j.filterPointsAtScale(c,Math.pow(2,b)),this._simplifiedMapPointsLevel=b}},_scaleMapPoints:function(a){return this._scaledMapPoints||(this._scaledMapPoints=this._simplifiedMapPoints.map(function(b){return new i(b.x*a,b.y*a)})),this._scaledMapPoints}}),b.exports=d},{"../line-simplification":72,"../types":97,"../utils":101,"./overlay":78}],82:[function(a,b,c){function d(a){e.EventTarget(this),arguments.length>0&&f.checkType(a,"object","[MapKit] Expected an object for argument of Style constructor, but got `"+a+"` instead.");for(var b in a){var c=Object.getOwnPropertyDescriptor(d.prototype,b);c&&c.set?this[b]=a[b]:console.warn("[MapKit] Style has no property named `"+b+"`, ignoring.")}}var e=a("dom-events"),f=a("../utils"),g={lineCap:["butt","round","square"],lineJoin:["miter","round","bevel"],fillRule:["nonzero","evenodd"]};d.UPDATE_EVENT="update-style";var h="rgb(0, 122, 255)";d.prototype={constructor:d,_strokeColor:h,_strokeOpacity:1,_lineWidth:1,_lineCap:"round",_lineJoin:"round",_lineDash:[],_lineDashOffset:0,_fillColor:h,_fillOpacity:.1,_fillRule:"nonzero",get strokeColor(){return this._strokeColor},set strokeColor(a){null!=a&&f.checkType(a,"string","[MapKit] Expected a string value for Style.strokeColor, but got `"+a+"` instead."),this._strokeColor!==a&&(this._strokeColor=a,this._updated())},get strokeOpacity(){return this._strokeOpacity},set strokeOpacity(a){f.checkType(a,"number","[MapKit] Expected a number value for Style.strokeOpacity, but got `"+a+"` instead.");var b=f.clamp(a,0,1);this._strokeOpacity!==b&&(this._strokeOpacity=b,this._updated())},get lineWidth(){return this._lineWidth},set lineWidth(a){f.checkType(a,"number","[MapKit] Expected a number value for Style.lineWidth, but got `"+a+"` instead.");var b=Math.max(0,a);this._lineWidth!==b&&(this._lineWidth=b,this._updated())},get lineCap(){return this._lineCap},set lineCap(a){var b=g.lineCap,c="[MapKit] Expected one of "+b.map(function(a){return"`"+a+"`"}).join(", ")+" for Style.lineCap, but got `"+a+"` instead.";if(f.checkType(a,"string",c),b.indexOf(a)<0)throw new TypeError(c);this._lineCap!==a&&(this._lineCap=a,this._updated())},get lineJoin(){return this._lineJoin},set lineJoin(a){var b=g.lineJoin,c="[MapKit] Expected one of "+b.map(function(a){return"`"+a+"`"}).join(", ")+" for Style.lineJoin, but got `"+a+"` instead.";if(f.checkType(a,"string",c),b.indexOf(a)<0)throw new TypeError(c);this._lineJoin!==a&&(this._lineJoin=a,this._updated())},get lineDash(){return this._lineDash},set lineDash(a){f.checkArray(a,"[MapKit] Expected an array of numbers for Style.lineDash, but got `"+a+"` instead."),a.forEach(function(a,b){f.checkType(a,"number","[MapKit] Expected an array of numbers for Style.lineDash, but got `"+a+"` at index "+b+" instead.")}),this._lineDash=a.slice(),this._updated()},get lineDashOffset(){return this._lineDashOffset},set lineDashOffset(a){f.checkType(a,"number","[MapKit] Expected a number value for Style.lineDashOffset, but got `"+a+"` instead."),this._lineDashOffset!==a&&(this._lineDashOffset=a,this._updated())},get fillColor(){return this._fillColor},set fillColor(a){null!=a&&f.checkType(a,"string","[MapKit] Expected a string value for Style.fillColor, but got `"+a+"` instead."),this._fillColor!==a&&(this._fillColor=a,this._updated())},get fillOpacity(){return this._fillOpacity},set fillOpacity(a){f.checkType(a,"number","[MapKit] Expected a number value for Style.fillOpacity, but got `"+a+"` instead.");var b=f.clamp(a,0,1);this._fillOpacity!==b&&(this._fillOpacity=b,this._updated())},get fillRule(){return this._fillRule},set fillRule(a){var b=g.fillRule,c="[MapKit] Expected one of "+b.map(function(a){return"`"+a+"`"}).join(", ")+" for Style.fillRule, but got `"+a+"` instead.";if(f.checkType(a,"string",c),b.indexOf(a)<0)throw new TypeError(c);this._fillRule!==a&&(this._fillRule=a,this._updated())},_shouldStroke:function(){return this.strokeColor&&this.strokeOpacity>0&&this.lineWidth>0},_shouldFill:function(){return this.fillColor&&this.fillOpacity>0},_halfStrokeWidthAtResolution:function(){return this.strokeColor&&this.strokeOpacity>0?this.lineWidth/2*f.devicePixelRatio:0},_styleForHitTesting:function(a){var b=Object.create(this);return null!=this._fillColor&&(b._fillColor=h,b._fillOpacity=1),b._strokeColor=h,b._strokeOpacity=1,b._lineWidth=this.lineWidth+a,b},_updated:function(){this.dispatchEvent(new e.Event(d.UPDATE_EVENT))}},b.exports=d},{"../utils":101,"dom-events":7}],83:[function(a,b,c){function d(){this._zoom=0,this._size=new k,this._mode=d.Modes.Light;var a=l.htmlElement("canvas",{"class":m});this._node=new i(a),this._ctx=a.getContext("2d")}function e(a,b,c,d,e,f){c=l.mod(c,b),d=l.mod(d,b),e=Math.ceil(e),f=Math.ceil(f);for(var g=Math.ceil(e/b),h=Math.ceil(f/b),i=0;g>i;++i)a.fillRect(c+i*b,0,1,f);for(i=0;h>i;++i)a.fillRect(0,d+i*b,e,1)}function f(a){return"rgb("+a.join(",")+")"}function g(a,b,c){return 0===c?a:1===c?b:[h(a[0],b[0],c),h(a[1],b[1],c),h(a[2],b[2],c)]}function h(a,b,c){return Math.round(b*c+a*(1-c))}var i=a("render-tree").Node,j=a("geometry/point"),k=a("geometry/size"),l=a("../utils"),m="mk-grid",n=100,o=10,p=l.log2(o);d.Modes={Light:{fillColor:[249,245,237],lineColor:[152,151,147]},Dark:{fillColor:[64,64,64],lineColor:[214,214,214]}},d.prototype={constructor:d,get node(){return this._node},set size(a){this._size=a.copy();var b=this._node.element;b.width=a.width*l.devicePixelRatio,b.height=a.height*l.devicePixelRatio;var c=l.devicePixelRatio;this._ctx.scale(c,c)},set mode(a){a!==this._mode&&(this._mode=a,this._scheduleDraw())},update:function(a,b){var c=Math.pow(2,b)*l.tileSize;this._position=new j(-a.x*c,-a.y*c),this._zoom=b,this._scheduleDraw()},updateNode:function(){this._draw()},_scheduleDraw:function(){this._position&&this._node.scheduleUpdate(this)},_draw:function(){var a=this._ctx,b=Math.pow(2,this._zoom%p),c=n*b,d=c/o,h=n/o,i=Math.min(d,n),j=h>d?0:(i-h)/(n-h),k=l.mod(this._position.x,c)-c,m=l.mod(this._position.y,c)-c,q=this._size.width,r=this._size.height;a.fillStyle=f(this._mode.fillColor),a.fillRect(0,0,q,r);var s=1-Math.pow(1-j,2);s>0&&(a.fillStyle=f(g(this._mode.fillColor,this._mode.lineColor,s)),e(a,d,k,m,q,r)),a.fillStyle=f(this._mode.lineColor),e(a,c,k,m,q,r)}},b.exports=d},{"../utils":101,"geometry/point":9,"geometry/size":11,"render-tree":28}],84:[function(a,b,c){function d(){}var e=a("../utils"),f=a("geometry/size"),g=a("geometry/point"),h=new f(e.tileSize,e.tileSize);d.prototype={constructor:d,element:function(a){return document.createElement("div")},canFadeTiles:function(){return!1},tileDataDidChange:function(a){a.backgroundImages=[]},drawTiles:function(a,b,c){var d=[];b.forEach(function(a){var b=c[a.key],f=new g(b.column*e.tileSize,b.row*e.tileSize);a.tileImages.forEach(function(a){d.push({url:a.image.src,position:f,size:h})})}),a.backgroundImages=a.backgroundImages.concat(d)}},b.exports=d},{"../utils":101,"geometry/point":9,"geometry/size":11}],85:[function(a,b,c){function d(){}var e=a("../debug"),f=a("../utils"),g=a("geometry/size");d.prototype={constructor:d,element:function(a){return this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas},canFadeTiles:function(){return!0},tileDataDidChange:function(a){this._pendingFirstDrawForTileData=!0;var b=a.size,c=f.devicePixelRatio,d=new g(b.width*c,b.height*c);(d.width!==this._canvas.width||d.height!==this._canvas.height)&&(this._newCanvasSize=d)},drawTiles:function(a,b,c){var d=this._ctx;this._newCanvasSize?(this._canvas.width=this._newCanvasSize.width,this._canvas.height=this._newCanvasSize.height,delete this._newCanvasSize):this._pendingFirstDrawForTileData&&d.clearRect(0,0,this._canvas.width,this._canvas.height);var g=f.tileSize*f.devicePixelRatio;b.forEach(function(a){var b=c[a.key],f=b.column*g,h=b.row*g;d.clearRect(f,h,g,g),a.tileImages.forEach(function(a){try{d.globalAlpha=b?b.opacity:1,d.drawImage(a.image,f,h,g,g)}catch(c){}}),e.drawTileOverlay(d,f,h,g,a)}),delete this._pendingFirstDrawForTileData}},b.exports=d},{"../debug":63,"../utils":101,"geometry/size":11}],86:[function(a,b,c){function d(){var a=k.iOSVersion;return a&&(a[0]<8||8===a[0]&&a[1]<4)}function e(){j.EventTarget(this),this._renderer=new n;var a=this._renderer.element(this);a.className=l,f.call(this,a),this.wantsHardwareCompositing=!0,this._drawingData={},this._tilesToDraw=[]}var f=a("render-tree").Node,g=a("css-transform"),h=a("geometry/point"),i=a("geometry/size"),j=a("dom-events"),k=a("../utils"),l="mk-tile-grid",m=300,n=a(d()?"./tile-grid-background-image-renderer":"./tile-grid-canvas-renderer"),o=new g;e.Events={FullRender:"full-render"},e.prototype=k.inheritPrototype(f,e,{constructor:e,fullyRendered:!1,_center:new h,_pendingTileCount:0,_tileData:null,set scale(a){1===a?this.transform=o:this.transform=(new g).translate(-this._center.x,-this._center.y).scale(a).translate(this._center.x,this._center.y)},get tileData(){return this._tileData},set tileData(a){this.setTileDataAnimated(a,!1)},setTileDataAnimated:function(a,b){this._tilesToDraw=[];var c=a.range,d=a.tiles;this._tileData&&this._tileData.tiles.forEach(function(a){a.removeEventListener("load",this),-1===d.indexOf(a)&&delete this._drawingData[a.key]},this);var e=c.min,f=c.max,g=f.x-e.x+1,j=f.y-e.y+1,l=Math.pow(2,e.z);0>=g&&(g+=l);var m=g*k.tileSize,n=j*k.tileSize;this._center=new h(m/2,n/2),this.size=new i(m,n),this._tileData=a,this.fullyRendered=!1,this._pendingTileCount=d.length,this._renderer.tileDataDidChange(this);var o=Object.getOwnPropertyNames(this._drawingData).length;d.forEach(function(a){var c=this._ensureDrawingDataForTile(a);c.column=k.mod(a.x-e.x,l),c.row=a.y-e.y,a.loaded?((o>0||!b)&&(c.opacity=1),this._tileDidLoad(a)):a.addEventListener("load",this)},this)},get pendingTileCount(){return this._pendingTileCount},handleEvent:function(a){var b=a.target;b.removeEventListener("load",this),this._tileDidLoad(b)},updateNode:function(){this._drawPendingTiles(),0===this._pendingTileCount&&0===this._tilesToDraw.length&&this._allTilesDidDraw()},_tileDidLoad:function(a){this._pendingTileCount--,this._tilesToDraw.push(a),this.scheduleUpdate(this)},_drawPendingTiles:function(a){var b=this._drawingData,c=this._renderer.canFadeTiles();if(c){var d=Date.now();this._tilesToDraw.forEach(function(a){var c=b[a.key];c.startTime>0?c.opacity=Math.min(1,(d-c.startTime)/m):0===c.opacity&&(c.startTime=d);
})}this._renderer.drawTiles(this,this._tilesToDraw,b),c?(this._tilesToDraw=this._tilesToDraw.filter(function(a){return 1!==b[a.key].opacity}),this._tilesToDraw.length>0&&this.scheduleUpdate(this)):this._tilesToDraw=[]},_allTilesDidDraw:function(){this.fullyRendered=!0,this.dispatchEvent(new j.Event(e.Events.FullRender))},_ensureDrawingDataForTile:function(a){var b=this._drawingData[a.key];return b||(b=this._drawingData[a.key]={startTime:0,opacity:this._renderer.canFadeTiles()?0:1}),b}}),b.exports=e},{"../utils":101,"./tile-grid-background-image-renderer":84,"./tile-grid-canvas-renderer":85,"css-transform":3,"dom-events":7,"geometry/point":9,"geometry/size":11,"render-tree":28}],87:[function(a,b,c){function d(a,b){this.min=a,this.max=b,this._language=j.language,this._provider=j.tileProvider,this._resolution=m.devicePixelRatio}function e(a,b,c,d,e){return[d,a,b,c,j.language,j.tileProvider,m.devicePixelRatio,e?"lo":"hi"].join("-")}function f(a,b,c,d,f,g){var i=e(a,b,c,d,f),j=q[i];return j||(j=new h(i,a,b,c,d,f,g),q[i]=j,j._refCount=0),j._loadTileImages(),j._refCount++,j}function g(a,b){for(var c=a.min.z,d=Math.pow(2,c),e=a.min,f=a.denormalize().max,g=e.x;g<=f.x;++g)for(var h=e.y;h<=f.y;++h)b(m.mod(g,d),h,c)}function h(a,b,c,d,e,f,g){l.EventTarget(this),this.key=a,this.x=b,this.y=c,this.z=d,this.type=e,this.lowResolution=!!f,this.priority=g,this.tileImages=[]}function i(a,b,c,d,e){this.x=a,this.y=b,this.z=c,this.tileSource=d,this._loader=new n(e,this),this._loader.schedule()}var j=a("../configuration"),k=a("geometry/point"),l=a("dom-events"),m=a("../utils"),n=a("../requests/image-loader"),o=a("../requests/request-manager").Priority,p=a("../requests/request-manager").LoadingState;d.prototype={constructor:d,denormalize:function(){var a=this.min.copy(),b=this.max.copy();return b.x<a.x&&(b.x+=Math.pow(2,a.z)),new d(a,b)},equals:function(a){var b=this.denormalize(),c=a.denormalize();return c.min.x===b.min.x&&c.min.y===b.min.y&&c.max.x===b.max.x&&c.max.y===b.max.y&&c.min.z===b.min.z&&c.max.z===b.max.z},usesSameTileSourceAs:function(a){return!!a&&this._language===a._language&&this._provider===a._provider&&this._resolution===a._resolution}};var q={},r={},s=[];b.exports={tileRangeForMapPointFrameAndZoom:function(a,b,c){var e=Math.pow(2,c),f=e-1,g=Math.ceil(b.size.width/m.tileSize)+1,h=Math.ceil(b.size.height/m.tileSize)+1,i=Math.floor(m.mod(a.x,1)*e),j=i+g,l=m.clamp(Math.floor(a.y*e),0,f),n=m.clamp(l+h,0,f);return new d(new k(i,l,c),new k(j,n,c))},tileDataForRangeAndMapType:function(a,b,c){for(var d=a.min.z,e=Math.pow(2,d),g=a.min,h=a.denormalize().max,i=new k((g.x+h.x)/2,(g.y+h.y)/2),j=[],l=g.x;l<=h.x;++l)for(var n=g.y;n<=h.y;++n)j.push(new k(l,n));j.sort(function(a,b){return a.distanceToPoint(i)-b.distanceToPoint(i)});var p=j.map(function(a){return f(m.mod(a.x,e),a.y,d,b,c,o.HIGH)});return{range:a,tiles:p}},lowPriorityTilesForRangeAndMapType:function(a,b,c){var d=[];return g(a,function(a,e,g){d.push(f(a,e,g,b,c,o.MEDIUM))}),d},cachedTilesForRangeAndMapType:function(a,b,c){var d=[];return g(a,function(a,f,g){var h=q[e(a,f,g,b,c)];h&&h.loaded&&d.push(h)}),d},releaseTile:function(a,b){for(var c in a.tileImages)a.tileImages[c]instanceof i&&a.tileImages[c].unschedule()&&a._refCount--;var d=s.indexOf(a);if(-1!==d&&s.splice(d,1),!b&&0===a._refCount){var f=e(a.x,a.y,a.z,a.type,a.lowResolution);delete q[f]}}};var t="load";h.prototype={constructor:h,loading:!1,loaded:!1,_loadTileImages:function(){if(!j.ready)return void s.push(this);if(!this.loading&&!this.loaded){console.assert(j.types.hasOwnProperty(this.type),"Unknown map type",this.type),this.loading=!0;var a=j.types[this.type];if(this.lowResolution&&a.lowResolutionTileSource)this._pendingTileImageLoads=1,this._loadTileImage(a.lowResolutionTileSource);else{var b=a.tileSources;this._pendingTileImageLoads=b.length,b.forEach(this._loadTileImage,this)}}},_loadTileImage:function(a){var b=new i(this.x,this.y,this.z,a,this.priority);this.tileImages.push(b),b.whenDoneLoading(this._tileImageDoneLoading.bind(this))},_tileImageDoneLoading:function(){this._pendingTileImageLoads--,0===this._pendingTileImageLoads&&this._allTileImagesDoneLoading()},_allTileImagesDoneLoading:function(){delete this._pendingTileImageLoads,this.loading=!1,this.loaded=!0,r[this.key]=!0,this.dispatchEvent(new l.Event(t))}};var u={};i.prototype={constructor:i,unschedule:function(){return this._loader.unschedule()},get urlForImageLoader(){var a=this.tileSource,b=a.domains,c=a.protocol,d=a.supportedResolutions[0],e=a.supportedResolutions[a.supportedResolutions.length-1],f=m.clamp(m.devicePixelRatio,d,e),g=m.fillTemplate(a.path,{tileSizeIndex:1,x:this.x,y:this.y,z:this.z,resolution:f,lang:j.language}),h=u[g];if(h)return h;var i=b[(this.x+this.y)%b.length];return h=c+"//"+i+g,u[g]=h,h},loaderDidSucceed:function(a){"function"==typeof this._doneLoadingCallback&&(this._doneLoadingCallback(),delete this._doneLoadingCallback),this.image=a.image},whenDoneLoading:function(a){this._loader.state===p.SUCCEEDED?a():this._doneLoadingCallback=a}},j.addEventListener(j.Events.Changed,function(){s.forEach(function(a){a._loadTileImages()})})},{"../configuration":53,"../requests/image-loader":88,"../requests/request-manager":90,"../utils":101,"dom-events":7,"geometry/point":9}],88:[function(a,b,c){function d(a,b){f.call(this,a,b),this._image=null}var e=a("../utils"),f=a("./loader");d.prototype=e.inheritPrototype(f,d,{get image(){return this._image},loaderWillStart:function(){f.prototype.loaderWillStart.call(this),this._image=document.createElement("img"),console.assert(this._delegate.urlForImageLoader,"ImageLoader._delegate.urlForImageLoader is not set"),this._image.src=this._delegate.urlForImageLoader,this._image.complete?this.loaderDidSucceed():(this._image.addEventListener("load",this),this._image.addEventListener("error",this))},handleEvent:function(a){switch(a.type){case"error":f.prototype._reload.call(this);break;case"load":this.loaderDidSucceed()}},_reset:function(){this._image&&(this._image.removeEventListener("load",this),this._image.removeEventListener("error",this)),f.prototype._reset.call(this)}}),b.exports=d},{"../utils":101,"./loader":89}],89:[function(a,b,c){function d(a,b){this._delegate=b,this._state=null,this._retries=0,this._timeoutID=-1,this.priority=a}var e=a("./request-manager"),f=3,g=1e4;d.prototype={constructor:d,get state(){return this._state},schedule:function(){console.assert(!this._state,"Loader has already been scheduled"),this._state=e.LoadingState.WAITING,e.schedule(this)},unschedule:function(){var a=!1;return this._state===e.LoadingState.WAITING?a=e.unschedule(this):this._state===e.LoadingState.LOADING&&(e._loaderDidComplete(this),a=!0),this._state=e.LoadingState.CANCELLED,"function"==typeof this._delegate.loaderDidCancel&&this._delegate.loaderDidCancel(this),this._reset(),a},loaderWillStart:function(){this._state=e.LoadingState.LOADING,"function"==typeof this._delegate.loaderWillStart&&this._delegate.loaderWillStart(this)},loaderDidSucceed:function(a){this._state=e.LoadingState.SUCCEEDED,e._loaderDidComplete(this),"function"==typeof this._delegate.loaderDidSucceed&&this._delegate.loaderDidSucceed(this,a),this._reset()},loaderDidFail:function(a){this._state=e.LoadingState.FAILED,e._loaderDidComplete(this),"function"==typeof this._delegate.loaderDidFail&&this._delegate.loaderDidFail(this,a),this._reset()},_reset:function(){window.clearTimeout(this._timeoutID)},_reload:function(){if(this._retries++,this._retries<f){var a="number"==typeof this._delay?this._delay:g;this._timeoutID=window.setTimeout(this.loaderWillStart.bind(this),a)}else this.loaderDidFail()}},b.exports=d},{"./request-manager":90}],90:[function(a,b,c){function d(a){n[a.priority].push(a),p++,j()}function e(a){return i(a)}function f(a){o[a.priority]--,j()}function g(){for(var a in k){if(n[k[a]].length>0){if(o[k[a]]===m[k[a]])break;return n[k[a]][0]}if(o[k[a]]>0)break}return null}function h(){for(var a in k)if(n[k[a]].length>0)return n[k[a]].shift(),p--,!0;return!1}function i(a){for(var b in k){var c=n[k[b]].indexOf(a);if(-1!==c)return n[k[b]].splice(c,1),p--,!0}return!1}function j(){for(var a=g();a;)o[a.priority]++,h(),a.loaderWillStart(),a=g()}var k={HIGHEST:0,HIGH:1,MEDIUM:2,LOW:3},l={WAITING:0,LOADING:2,CANCELLED:3,SUCCEEDED:4,FAILED:5},m=[];m[k.HIGHEST]=12,m[k.HIGH]=12,m[k.MEDIUM]=4,m[k.LOW]=1;var n=[],o=[],p=0;for(var q in k)n[k[q]]=[],o[k[q]]=0;b.exports={schedule:d,unschedule:e,_loaderDidComplete:f,Priority:k,LoadingState:l}},{}],91:[function(a,b,c){function d(a,b,c){c=c||{};var d=c.priority||g.HIGHEST;f.call(this,d,b),this._url=a,this._method=c.method||"GET",this._retry=c.retry===!0,this._delay=c.delay}var e=a("../utils"),f=a("./loader"),g=a("./request-manager").Priority;d.prototype=e.inheritPrototype(f,d,{get xhrData(){return this._xhrData},unschedule:function(){return this._xhr&&this._xhr.abort(),f.prototype.unschedule.call(this)},loaderWillStart:function(){f.prototype.loaderWillStart.call(this),this._xhr=e.xhr(this),this._xhr.open(this._method,this._url,!0),"POST"===this._method&&(this._xhrData||(this._xhrData=this._delegate.getDataToSend(this._xhr),console.assert("string"==typeof this._xhrData,"XHRLoader data has been set to a non-string value."))),this._xhr.send(this._xhrData)},handleEvent:function(a){"error"===a.type||"timeout"===a.type||200!==a.target.status?this._retry?f.prototype._reload.call(this):this.loaderDidFail(a.target):"load"===a.type?this.loaderDidSucceed(a.target):console.log("Unhandled XHR event type:",a.type," status:",a.target.status)}}),b.exports=d},{"../utils":101,"./loader":89,"./request-manager":90}],92:[function(a,b,c){"use strict";function d(a){a=a||{},this._checkOptions(a,j),i.call(this,"Geocoder",a)}var e=a("../configuration"),f=a("../utils"),g=a("../types").BoundingRegion,h=a("../types").Coordinate,i=a("./service"),j=["language","getsUserLocation"],k=["language","region","coordinate","limitToCountries"],l=["language"];d.prototype=f.inheritPrototype(i,d,{constructor:d,lookup:function(a,b,c){var d={};c=c||{},this._checkOptions(c,k),f.required(a,"[MapKit] Missing `address` in call to `Geocoder.lookup()`.").checkType(a,"string","[MapKit] `address` passed to `Geocoder.lookup()` is not a string."),f.required(b,"[MapKit] Missing `callback` in call to `Geocoder.lookup()`.").checkType(b,"function","[MapKit] `callback` passed to `Geocoder.lookup()` is not a function."),d.q=a;var g=c.region,h=c.coordinate,i=c.limitToCountries,j=this.language||e.language;if(g){var l=g.toBoundingRegion();d.searchRegion=[l.northLatitude,l.eastLongitude,l.southLatitude,l.westLongitude].join(",")}else h&&(d.searchLocation=[h.latitude,h.longitude].join(","));if(c.language&&(j=this._bestLanguage(c.language)),j&&(d.lang=j),i&&(f.checkType(i,"string","[MapKit] `limitToCountries` is not a string."),d.limitToCountries=i),this.getsUserLocation){var m=this._requestMap.add({path:"geocode",parameters:d,callback:b},"geo");return this._locate(function(a,b){var c=this._requestMap.get(m);c&&(a?console.warn("[MapKit] Unable to get current location:",a.message):c.parameters.userLocation=[b.latitude,b.longitude].join(","),this._send(c.path,c.parameters,c.callback,this._transform),this._requestMap.remove(m))}.bind(this)),m}return this._send("geocode",d,b,this._transform)},reverseLookup:function(a,b,c){var d={},g=this.language||e.language;return c=c||{},this._checkOptions(c,l),f.required(a,"[MapKit] Missing `coordinate` in call to `Geocoder.reverseLookup()`.").checkInstance(a,h,"[MapKit] `coordinate` passed to `Geocoder.reverseLookup()` is not a Coordinate."),f.required(b,"[MapKit] Missing `callback` in call to `Geocoder.reverseLookup()`.").checkType(b,"function","[MapKit] `callback` passed to `Geocoder.reverseLookup()` is not a function."),d.loc=a.latitude+","+a.longitude,c.language&&(g=this._bestLanguage(c.language)),g&&(d.lang=g),this._send("reverseGeocode",d,b,this._transform)},_transform:function(a,b){var c={status:b.status,results:[]};return b.results&&(c.results=b.results.map(function(a){var b,c,d={};return a.displayMapRegion&&(b=a.displayMapRegion,c=new g(b.northLat,b.eastLng,b.southLat,b.westLng),d.region=c.toCoordinateRegion(),d.coordinate=d.region.center),a.formattedAddressLines&&(d.formattedAddress=a.formattedAddressLines.join(", ")),a.center&&(d.coordinate=new h(a.center.lat,a.center.lng)),a.countryCode&&(d.countryCode=a.countryCode),a.geocodeAccuracy&&(d.geocodeAccuracy=a.geocodeAccuracy),d})),c}}),b.exports=d},{"../configuration":53,"../types":97,"../utils":101,"./service":95}],93:[function(a,b,c){function d(){this._requests={},this._types={},this._counter=1}d.prototype={constructor:d,add:function(a,b){console.assert(b&&-1!==["query","geo","xhr"].indexOf(b),"Invalid type: "+b);var c=this._counter;return this._counter+=1,this._requests[c]=a,this._types[c]=b,c},get:function(a){return console.assert(a&&"number"==typeof a,"Invalid ID: "+a),this._requests[a]},typeForId:function(a){return console.assert(a&&"number"==typeof a,"Invalid ID: "+a),this._types[a]},idsByType:function(a){return Object.keys(this._requests).filter(function(b){return this._types[b]===a},this).map(function(a){return parseInt(a)})},remove:function(a){console.assert(a&&"number"==typeof a,"Invalid ID: "+a);var b=this.get(a);return b?(delete this._requests[a],delete this._types[a],!0):!1}},b.exports=d},{}],94:[function(a,b,c){function d(a){var b=region=null;a=a||{},this._checkOptions(a,j),i.call(this,"Search",a),"coordinate"in a&&(b=a.coordinate),this.coordinate=b,"region"in a&&(region=a.region),this.region=region}var e=a("../configuration"),f=a("../utils"),g=a("../types").BoundingRegion,h=a("../types").Coordinate,i=a("./service"),j=["language","getsUserLocation","coordinate","region"],k=["language","region","coordinate"];d.prototype=f.inheritPrototype(i,d,{constructor:d,search:function(a,b,c){return this._request("search","search",this._searchTransform,a,b,c)},autocomplete:function(a,b,c){this._request("autocomplete","searchAutocomplete",this._autocompleteTransform,a,b,c)},_request:function(a,b,c,d,g,h){if("object"==typeof g){var i=g;g=function(b,c){var d="search"===a?i.searchDidError:i.autocompleteDidError,e="search"===a?i.searchDidComplete:i.autocompleteDidComplete;b?"function"==typeof d&&d(b):"function"==typeof e&&e(c)}}var j={};h=h||{},this._checkOptions(h,k);var l="Search."+a+"()";f.required(d,"[MapKit] Missing `query` in call to `"+l+"`.").checkType(d,"string","[MapKit] `query` passed to `"+l+"` is not a string."),f.required(g,"[MapKit] Missing `callback` in call to `"+l+"`.").checkType(g,"function","[MapKit] `callback` passed to `"+l+"` is not a function."),j.q=d;var m=h.region||this.region,n=h.coordinate||this.coordinate,o=this.language||e.language;if(m){var p=m.toBoundingRegion();j.searchRegion=[p.northLatitude,p.eastLongitude,p.southLatitude,p.westLongitude].join(",")}else n&&(j.searchLocation=[n.latitude,n.longitude].join(","));if(h.language&&(o=this._bestLanguage(h.language)),o&&(j.lang=o),this.getsUserLocation){var q=this._requestMap.add({path:b,parameters:j,callback:g,transform:c},"geo");return this._locate(function(a,b){var c=this._requestMap.get(q);c&&(a?console.warn("[MapKit] Unable to get current location:",a.message):c.parameters.userLocation=[b.latitude,b.longitude].join(","),this._send(c.path,c.parameters,c.callback,c.transform),this._requestMap.remove(q))}.bind(this)),q}return this._send(b,j,g,c)},_searchTransform:function(a,b){var c={query:a.q,results:[]};return b.results&&(c.results=b.results.map(function(a){var b,c,d={};return a.name&&(d.name=a.name),a.displayMapRegion&&(b=a.displayMapRegion,c=new g(b.northLat,b.eastLng,b.southLat,b.westLng),d.region=c.toCoordinateRegion(),d.coordinate=d.region.center),a.formattedAddress&&(d.formattedAddress=a.formattedAddress),a.coordinate&&(d.coordinate=new h(a.coordinate.latitude,a.coordinate.longitude)),a.countryCode&&(d.countryCode=a.countryCode),d})),c},_autocompleteTransform:function(a,b){var c={query:a.q,results:[]};return b.results&&(c.results=b.results.map(function(a){var b={};return a.displayLines&&(b.displayLines=a.displayLines),a.location&&(b.coordinate=new h(a.location.lat,a.location.lng)),b})),c}}),b.exports=d},{"../configuration":53,"../types":97,"../utils":101,"./service":95}],95:[function(a,b,c){function d(a,b){var c=null;this._name=a,this._requestMap=new j,e.addEventListener(e.Events.Changed,this),e.addEventListener(e.Events.Error,this),e.state===e.States.ERROR&&(this._configFailed=!0),"language"in b&&(c=this._bestLanguage(b.language)),this.language=c,this.getsUserLocation="getsUserLocation"in b?b.getsUserLocation===!0:!1}var e=a("../configuration"),f=a("../language-support"),g=a("../utils"),h=a("../user-location/user-location"),i=a("../types").Coordinate,j=a("./request-map"),k=a("../requests/xhr-loader"),l=8e3,m=9e5,n={enableHighAccuracy:!1,timeout:l,maximumAge:m};d.prototype={cancel:function(a){g.required(a,"[MapKit] Missing `id` in call to `"+this._name+".cancel()`.").checkType(a,"number","[MapKit] `id` passed to `"+this._name+".cancel()` is not a number.");var b=this._requestMap.typeForId(a);if(b)switch(b){case"query":case"geo":return this._requestMap.remove(a);case"xhr":var c=this._requestMap.get(a);if(c)return c.unschedule(),this._requestMap.remove(a);break;default:console.assert(!1,"Unknown type: "+b)}return!1},handleEvent:function(a){switch(a.type){case e.Events.Error:this._configFailed=!0;case e.Events.Changed:this._requestMap.idsByType("query").forEach(function(a){var b=this._requestMap.get(a);this._send(b.path,b.parameters,b.callback,b.transform),this._requestMap.remove(a)},this)}},_send:function(a,b,c,d){var f=this._requestMap;if(!e.apiBaseUrl||e.state===e.States.PENDING)return this._configFailed?(c(new Error("MapKit failed to initialize.")),0):f.add({path:a,parameters:b,callback:c,transform:d},"query");var h=e.apiBaseUrl+a;b=b||{};var i=g.toQueryString(b);""!==i&&(h+="?"+i);var j={loaderDidSucceed:function(a,e){var g;if(f.remove(a.id),e.status<200||e.status>=300)return void c(new Error("HTTP error:"+e.status));try{g=JSON.parse(e.responseText)}catch(h){return void c(new Error("Failed to parse response:"+e.responseText))}c(null,d(b,g))},loaderDidFail:function(a,b){f.remove(a.id),c(new Error("Network error"))}},l=new k(h,j);return l.schedule(),l.id=f.add(l,"xhr"),l.id},_checkOptions:function(a,b){g.checkType(a,"object","[MapKit] The `options` object is invalid."),Object.keys(a).forEach(function(a){if(-1===b.indexOf(a))throw new Error("[MapKit] `"+a+"` is not a valid option.")})},_bestLanguage:function(a){g.checkType(a,"string","[MapKit] `language` is not a string.");var b=f.bestMatch(a);return null===b?console.warn("[MapKit] Geocoder: "+a+" is not supported."):b!==a&&console.warn("[MapKit] Geocoder: "+a+" is not supported. Substituting "+b+""),b},_locate:function(a){var b=function(b){var c=b.coords;a(null,new i(c.latitude,c.longitude))},c=function(b){var c;switch(b.code){case b.PERMISSION_DENIED:c="PERMISSION_DENIED";break;case b.POSITION_UNAVAILABLE:c="POSITION_UNAVAILABLE";break;case b.TIMEOUT:c="TIMEOUT";break;default:console.assert(!1,"Unknown PositionError code: "+b.code)}a(new Error(c))};g.required(a,"Missing callback").checkType(a,"function"),h.locate(b,c,n)}},b.exports=d},{"../configuration":53,"../language-support":70,"../requests/xhr-loader":91,"../types":97,"../user-location/user-location":100,"../utils":101,"./request-map":93}],96:[function(a,b,c){function d(){this._element=g.htmlElement("div",{"class":h})}function e(a){for(var b,c=[a];c.length>0;)if(a=c.shift(),a.nodeType===window.Node.ELEMENT_NODE){var d=window.getComputedStyle(a),e=parseFloat(d.marginLeft),g=parseFloat(d.marginTop),h=parseFloat(d.marginRight),i=parseFloat(d.marginBottom),j=f.rectFromClientRect(a.getBoundingClientRect()).inset(-e,-g,-h,-i);j.size.width>0&&j.size.height>0&&(b=b?b.unionWithRect(j):j),Array.prototype.push.apply(c,a.childNodes)}return b||new f}var f=a("geometry/rect"),g=a("./utils"),h="mk-sizer";d.prototype={constructor:d,get element(){return this._element},sizeForElement:function(a){var b=a.parentElement,c=a.nextSibling;this._element.appendChild(a);var d=e(a);return b?b.insertBefore(a,c):this._element.removeChild(a),d.size}},b.exports=d},{"./utils":101,"geometry/rect":10}],97:[function(a,b,c){function d(a,b){void 0===a&&(a=new f),void 0===b&&(b=new e),l.checkInstance(a,f,"[MapKit] `center` is not a Coordinate."),l.checkInstance(b,e,"[MapKit] `span` is not a CoordinateSpan."),this.center=new f(a.latitude,a.longitude),this.span=new e(b.latitudeDelta,b.longitudeDelta)}function e(a,b){void 0===a&&(a=0),void 0===b&&(b=0),l.checkType(a,"number","[MapKit] `latitudeDelta` is not a number."),l.checkType(b,"number","[MapKit] `longitudeDelta` is not a number."),this.latitudeDelta=a,this.longitudeDelta=b}function f(a,b){void 0===a&&(a=0),void 0===b&&(b=0),l.checkType(a,"number","[MapKit] `latitude` is not a number."),l.checkType(b,"number","[MapKit] `longitude` is not a number."),this.latitude=a,this.longitude=b}function g(a,b,c,d){arguments.length<4&&(d=0,arguments.length<3&&(c=0,arguments.length<2&&(b=0,arguments.length<1&&(a=0)))),l.checkType(a,"number","[MapKit] Expected a number for `northLatitude` in BoundingRegion constructor but got `"+a+"` instead."),l.checkType(b,"number","[MapKit] Expected a number for `eastLongitude` in BoundingRegion constructor but got `"+b+"` instead."),l.checkType(c,"number","[MapKit] Expected a number for `southLatitude` in BoundingRegion constructor but got `"+c+"` instead."),l.checkType(d,"number","[MapKit] Expected a number for `westLongitude` in BoundingRegion constructor but got `"+d+"` instead."),this.northLatitude=a,this.eastLongitude=b,this.southLatitude=c,this.westLongitude=d}function h(a,b){arguments.length<2&&(b=0,arguments.length<1&&(a=0)),l.checkType(a,"number","[MapKit] Expected a number for `x` in MapPoint constructor but got `"+a+"` instead."),l.checkType(b,"number","[MapKit] Expected a number for `y` in MapPoint constructor but got `"+b+"` instead."),this.x=a,this.y=b}function i(a,b){arguments.length<2&&(b=0,arguments.length<1&&(a=0)),l.checkType(a,"number","[MapKit] Expected a number for `width` in MapSize constructor but got `"+a+"` instead."),l.checkType(b,"number","[MapKit] Expected a number for `height` in MapSize constructor but got `"+b+"` instead."),this.width=a,this.height=b}function j(a,b,c,d){arguments.length<4&&(d=0,arguments.length<3&&(c=0,arguments.length<2&&(b=0,arguments.length<1&&(a=0)))),l.checkType(a,"number","[MapKit] Expected a number for `x` in MapRect constructor but got `"+a+"` instead."),l.checkType(b,"number","[MapKit] Expected a number for `y` in MapRect constructor but got `"+b+"` instead."),l.checkType(c,"number","[MapKit] Expected a number for `width` in MapRect constructor but got `"+c+"` instead."),l.checkType(d,"number","[MapKit] Expected a number for `height` in MapRect constructor but got `"+d+"` instead."),this.origin=new h(a,b),this.size=new i(c,d)}function k(){var a=arguments.length;if(1===a&&"object"==typeof arguments[0]){this.top=0,this.right=0,this.bottom=0,this.left=0;var b=arguments[0];Object.keys(b).forEach(function(a){"top"===a||"right"===a||"bottom"===a||"left"===a?this[a]=b[a]:console.warn("[MapKit] Unknown property `"+a+"` for Padding constructor.")},this)}else this.top=a>0?arguments[0]:0,this.right=a>1?arguments[1]:0,this.bottom=a>2?arguments[2]:0,this.left=a>3?arguments[3]:0;l.checkType(this.top,"number","[MapKit] Expected a number for `top` in Padding constructor but got `"+this.top+"` instead."),l.checkType(this.left,"number","[MapKit] Expected a number for `left` in Padding constructor but got `"+this.left+"` instead."),l.checkType(this.bottom,"number","[MapKit] Expected a number for `bottom` in Padding constructor but got `"+this.bottom+"` instead."),l.checkType(this.right,"number","[MapKit] Expected a number for `right` in Padding constructor but got `"+this.right+"` instead.")}var l=a("./utils"),m=500,n=1e-8,o=l.convertYToLatitude(0),p=l.convertYToLatitude(1);d.prototype={constructor:d,copy:function(){return new d(this.center.copy(),this.span.copy())},toString:function(){return["CoordinateRegion(","	latitude: "+this.center.latitude,"	longitude: "+this.center.longitude,"	latitudeDelta: "+this.span.latitudeDelta,"	longitudeDelta: "+this.span.longitudeDelta,")"].join("\n")},toBoundingRegion:function(){var a=this.span.latitudeDelta/2,b=this.span.longitudeDelta/2;return new g(this.center.latitude+a,this.center.longitude+b,this.center.latitude-a,this.center.longitude-b)},toMapRect:function(){if(this.span.latitudeDelta<0)this.span.latitudeDelta=0;else{var a=l.convertLatitudeToY(Math.abs(this.center.latitude)),b=2*a,c=o-l.convertYToLatitude(b);this.span.latitudeDelta>c&&(this.span.latitudeDelta=c)}var d=this.center.longitude-this.span.longitudeDelta/2,e=this.center.longitude+this.span.longitudeDelta/2,g=!1;-180>d&&(d+=360,g=!0);var i=!1;e>180&&(e-=360,i=!0);var k=new f(this.center.latitude,d),q=new f(this.center.latitude,e),r=k.toMapPoint(),s=q.toMapPoint();g&&(r.x-=1),i&&(s.x+=1);var t=new j;if(0===this.center.latitude){var u=new f(this.center.latitude+this.span.latitudeDelta/2,this.center.longitude),v=new f(this.center.latitude-this.span.latitudeDelta/2,this.center.longitude);return t.origin.x=r.x,t.size.width=s.x-t.origin.x,t.origin.y=u.toMapPoint().y,t.size.height=v.toMapPoint().y-t.origin.y,t}var w=this.copy();w.center.latitude=p+this.span.latitudeDelta/2;var x=10,y=new f,z=new h;u=new f,v=new f,u.longitude=this.center.longitude,v.longitude=this.center.longitude;var A=0;do{if(w.center.latitude>o&&w.center.latitude>this.center.latitude||w.center.latitude<p&&w.center.latitude<this.center.latitude)w.center.latitude-=x,x*=.1;else if(w.center.latitude>o||w.center.latitude<p)return new j(0,0,1,1);if(A>m)return new j(0,0,1,1);u.latitude=w.center.latitude+w.span.latitudeDelta/2,v.latitude=w.center.latitude-w.span.latitudeDelta/2,t.origin.x=r.x,t.size.width=s.x-t.origin.x,t.origin.y=u.toMapPoint().y,t.size.height=v.toMapPoint().y-t.origin.y,z.x=t.midX(),z.y=t.midY(),y=z.toCoordinate(),(x>0&&y.latitude>this.center.latitude||0>x&&y.latitude<this.center.latitude)&&(x*=-.1),w.center.latitude+=x,A++}while(Math.abs(y.latitude-this.center.latitude)>=n);return t}},d._enclosingRegionForCoordinates=function(a){var b=0,c=180,g=-180,h=0,i=90,j=-90;a.forEach(function(a){var d=l.clamp(a.latitude,-90,90);i=Math.min(i,d),j=Math.max(j,d);var e=l.wrapLongitude(a.longitude);0>e?(b=Math.min(b,e),g=Math.max(g,e)):(c=Math.min(c,e),h=Math.max(h,e))});var k,m,n=j-i,o=i+n/2;if(b>g)k=h-c,m=c+k/2;else if(c>h)k=g-b,m=b+k/2;else{var p=h-b,q=360-(c-g);q>p?(k=p,m=b+k/2):(k=q,m=c+k/2)}return new d(new f(o,m),new e(n,k))},e.prototype={constructor:e,copy:function(){return new e(this.latitudeDelta,this.longitudeDelta)},toString:function(){return["CoordinateSpan(","	latitudeDelta: "+this.latitudeDelta,"	longitudeDelta: "+this.longitudeDelta,")"].join("\n")}},f.prototype={constructor:f,copy:function(){return new f(this.latitude,this.longitude)},toMapPoint:function(){return new h(l.convertLongitudeToX(this.longitude),l.convertLatitudeToY(this.latitude))},toUnwrappedMapPoint:function(){return new h(this.longitude/360+.5,l.convertLatitudeToY(this.latitude))},toString:function(){return["Coordinate(","	latitude: "+this.latitude,"	longitude: "+this.longitude,")"].join("\n")}},g.prototype={constructor:g,copy:function(){return new g(this.northLatitude,this.eastLongitude,this.southLatitude,this.westLongitude)},toString:function(){return["BoundingRegion(","	northLatitude: "+this.northLatitude,"	eastLongitude: "+this.eastLongitude,"	southLatitude: "+this.southLatitude,"	westLongitude: "+this.westLongitude,")"].join("\n")},toCoordinateRegion:function(){var a=l.wrapLongitude(this.eastLongitude),b=l.wrapLongitude(this.westLongitude);b>a&&(a+=360);var c=this.northLatitude-this.southLatitude,g=a-b;return new d(new f(this.southLatitude+c/2,l.wrapLongitude(b+g/2)),new e(c,g))}},h.prototype={constructor:h,toString:function(){return"MapPoint("+this.x+", "+this.y+")"},copy:function(){return new h(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},toCoordinate:function(){return new f(l.convertYToLatitude(this.y),l.wrapLongitude(l.convertXToLongitude(this.x)))}},i.prototype={constructor:i,toString:function(){return"MapSize("+this.width+", "+this.height+")"},copy:function(){return new i(this.width,this.height)},equals:function(a){return this.width===a.width&&this.height===a.height}},j.prototype={constructor:j,toString:function(){return"MapRect("+[this.origin.x,this.origin.y,this.size.width,this.size.height].join(", ")+")"},copy:function(){return new j(this.origin.x,this.origin.y,this.size.width,this.size.height)},equals:function(a){return this.origin.equals(a.origin)&&this.size.equals(a.size)},minX:function(){return this.origin.x},minY:function(){return this.origin.y},midX:function(){return this.origin.x+this.size.width/2},midY:function(){return this.origin.y+this.size.height/2},maxX:function(){return this.origin.x+this.size.width},maxY:function(){return this.origin.y+this.size.height},scale:function(a,b){if(l.required(a,"[MapKit] Missing `scaleFactor` parameter in call to `MapRect.scale()`."),"number"!=typeof a||isNaN(a))throw new TypeError("[MapKit] The `scaleFactor` parameter passed to `MapRect.scale()` is not a number.");var c=this.size.width*a,d=this.size.height*a;return b?(l.checkInstance(b,h,"[MapKit] The `scaleCenter` parameter passed to `MapRect.scale()` is not a MapPoint."),new j(b.x-a*(b.x-this.origin.x),b.y-a*(b.y-this.origin.y),c,d)):new j(this.midX()-c/2,this.midY()-d/2,c,d)},toCoordinateRegion:function(){var a=this.origin.toCoordinate(),b=new h(this.maxX(),this.maxY()).toCoordinate(),c=Math.abs(b.latitude-a.latitude),f=b.longitude-a.longitude;return b.longitude<a.longitude&&(f+=360),new d(new h(this.midX(),this.midY()).toCoordinate(),new e(c,f))},_pad:function(a){l.checkType(a,"object","[MapKit] MapRect.pad expects a padding object with top, left, bottom, right but got `"+a+"` instead");var b=a.left||0,c=a.top||0;return new j(this.origin.x-b,this.origin.y-c,this.size.width+b+(a.right||0),this.size.height+c+(a.bottom||0))},_contains:function(a){var b=a.origin.x,c=a.origin.y,d=this.maxX(),e=this.maxY();return b>=this.origin.x&&d>=b&&c>=this.origin.y&&e>=c&&a.maxX()<=d&&a.maxY()<=e}},j._boundingRectForSortedRects=function(a){if(0===a.length)return new j;if(1===a.length){var b=a[0].minX();return b>=0&&1>b?a[0]:new j(l.mod(b,1),a[0].minY(),a[0].size.width,a[0].size.height)}for(var c=[[a[0].minX(),a[0].maxX()]],d=a[0].minY(),e=a[0].maxY(),f=1,g=a.length,h=0;g>f;++f){var i=c[h],k=a[f];d=Math.min(d,k.minY()),e=Math.max(e,k.maxY()),k.minX()<=i[1]?c[h]=[i[0],Math.max(i[1],k.maxX())]:(c.push([k.minX(),k.maxX()]),++h)}var m=c.length;if(1===m)return new j(c[0][0],d,Math.min(c[0][1]-c[0][0],1),e-d);for(var n=1+c[0][0]-c[m-1][1],o=c[0][0],p=1;m>p;++p){var q=c[p][0]-c[p-1][1];q>n&&(n=q,o=c[p][0])}return new j(l.mod(o,1),d,1-n,e-d)},k.Zero=new k,k.prototype={constructor:k,toString:function(){return"Padding("+[this.top,this.right,this.bottom,this.left].join(", ")+")"},copy:function(){return new k(this.top,this.right,this.bottom,this.left)},equals:function(a){return this.top===a.top&&this.right===a.right&&this.bottom===a.bottom&&this.left===a.left}},b.exports={CoordinateRegion:d,CoordinateSpan:e,Coordinate:f,BoundingRegion:g,MapPoint:h,MapRect:j,MapSize:i,Padding:k}},{"./utils":101}],98:[function(a,b,c){"use strict";var d=a("../build.json"),e="";b.exports={createUrl:function(a){return e||(e=d.testBuild?this.getMapKitScriptParts().prefix:d.cdnUrl),a=a&&a.replace(/^\//,"")||"",[e,a].join("/")},createImageUrl:function(a){return this.createUrl("images/"+a)},parse:function(a){var b=document.createElement("a");return b.href=a,b.protocol||(b.protocol=location.protocol),["href","protocol","hostname","port","pathname","search","hash"].reduce(function(a,c){return a[c]=b[c],a},{})},getMapKitScriptParts:function(){for(var a=/(.*)(?=\/mapkit\.js)/,b=document.scripts,c=0,d=b.length;d>c;++c){var e=a.exec(b[c].src);if(e){var f=this.parse(b[c].src);
return f.prefix=e[0],f}}return{}},isSameOrigin:function(a,b){return a=this.parse(a),b=this.parse(b),a.hostname===b.hostname&&a.protocol===b.protocol}}},{"../build.json":43}],99:[function(a,b,c){function d(a){this._delegate=a,this._showsUserLocation=!1,this._tracksUserLocation=!1}var e=a("./user-location");d.prototype={constructor:d,get showsUserLocation(){return this._showsUserLocation},set showsUserLocation(a){this._showsUserLocation=a,a?(e.addEventListener(e.Events.Change,this),e.addEventListener(e.Events.Error,this),e.watch()):(e.removeEventListener(e.Events.Change,this),e.removeEventListener(e.Events.Error,this))},get tracksUserLocation(){return this._tracksUserLocation},set tracksUserLocation(a){this._tracksUserLocation=a,a?(e.addEventListener(e.Events.Change,this),e.addEventListener(e.Events.Error,this),e.watch()):(e.removeEventListener(e.Events.Change,this),e.removeEventListener(e.Events.Error,this))},get userLocation(){return e},handleEvent:function(a){switch(a.type){case e.Events.Change:this._handleUserLocationChange(a);break;case e.Events.Error:this._handleUserLocationError(a)}},mapWasDestroyed:function(){delete this._delegate,e.removeEventListener(e.Events.Change,this),e.removeEventListener(e.Events.Error,this)},_handleUserLocationChange:function(a){e.errorCode=0,this._delegate.userLocationDidChange(a)},_handleUserLocationError:function(a){e.errorCode=a.code,this._delegate.userLocationDidError(a)}},b.exports=d},{"./user-location":100}],100:[function(a,b,c){function d(){n.EventTarget(this),this.Events=q,this._location=null,this._coordinate=null,this._stale=!1,this._watchers=0,Object.defineProperty(this,"location",{get:function(){return this._location}}),Object.defineProperty(this,"coordinate",{get:function(){return this._coordinate}}),Object.defineProperty(this,"stale",{get:function(){return this._stale}}),this.watch=function(){this._watchId||(this._watchId=window.navigator.geolocation.watchPosition(f,h))},this.locate=function(a,b,c){return l&&this._watchId?void e(l,a,b):void window.navigator.geolocation.getCurrentPosition(function(c){e(c,a,b)},b,c)},this.addEventListener=function(){n.EventTarget.prototype.addEventListener.apply(this,arguments)&&++this._watchers},this.removeEventListener=function(){n.EventTarget.prototype.removeEventListener.apply(this,arguments)&&(--this._watchers,0===this._watchers&&this._watchId&&(window.navigator.geolocation.clearWatch(this._watchId),this._watchId=null))},this.handleEvent=function(a){switch(a.type){case o.Events.Changed:if(!l)return;f(l)}},this.reset=function(){this._watchers=0,this._watchId=null,l=null},o.addEventListener(o.Events.Changed,this)}function e(a,b,c){if("AutoNavi"===o.tileProvider){var d=new m(a.coords.latitude,a.coords.longitude);p.shift(d,o.locationShiftUrl,function(d,e){if(d)return void(c&&c(d));var f=k(a);f.coords.latitude=e.latitude,f.coords.longitude=e.longitude,b&&b(f)})}else b&&b(a)}function f(a){return l=a,o.ready?void((r._stale||!r._coordinate||a.coords.latitude!==r._coordinate.latitude||a.coords.longitude!==r._coordinate.longitude)&&e(a,g,h)):void h({code:4,message:"MapKit not initialized."})}function g(a){r._stale=!1,r._location=a.coords,r._coordinate=new m(a.coords.latitude,a.coords.longitude),r.dispatchEvent(new i(r._coordinate))}function h(a){l=null,r._stale=!0,r.dispatchEvent(new j(a))}function i(a){n.Event.call(this,q.Change),this.coordinate=a,this.timestamp=new Date}function j(a){n.Event.call(this,q.Error),this.code=a.code}function k(a){var b={coords:{}};return Object.keys(a).forEach(function(c){"coords"===c?Object.keys(a.coords).forEach(function(c){b.coords[c]=a.coords[c]}):b[c]=a[c]}),b}var l,m=a("../types").Coordinate,n=a("dom-events"),o=a("../configuration"),p=a("../coordinate-shifter"),q={Change:"user-location-change",Error:"user-location-error"},r=new d;b.exports=r},{"../configuration":53,"../coordinate-shifter":62,"../types":97,"dom-events":7}],101:[function(a,b,c){function d(a,b){var c=window.document.createElementNS(this,a),d=1;if("object"==typeof b&&null!=b&&!(b instanceof window.Node)){++d;for(var e in b)c.setAttribute(e,b[e])}for(var f=d,g=arguments.length;g>f;++f){var h=arguments[f];h instanceof window.Node?c.appendChild(h):"string"==typeof h&&c.appendChild(document.createTextNode(h))}return c}function e(a){a=(a+90)%180-90;var b=Math.max(Math.min(a,90),-90)*j;return.5+Math.log(Math.tan(k-b/2))/l}function f(a){return g(a/360+.5,1)}function g(a,b){return a-b*Math.floor(a/b)}var h=a("device-pixel-ratio"),i=a("./urls"),j=Math.PI/180,k=Math.PI/4,l=2*Math.PI,m=Math.log(2),n=a("gesture-recognizers").SupportsTouches;b.exports={tileSize:256,focusColor:"rgb(0, 122, 255)",KeyCodes:{Escape:27,SpaceBar:32,UpArrow:38,DownArrow:40},get iOSVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3]||0,10)]}},isIE9:function(){return/MSIE 9/i.test(navigator.userAgent)},isIE10:function(){return/MSIE 10/i.test(navigator.userAgent)},isIEAndNotEdge:function(){return/MSIE|Trident\//i.test(navigator.userAgent)},classList:a("class-list"),convertLatitudeToY:e,convertYToLatitude:function(a){var b=Math.pow(Math.E,2*Math.PI*(a-.5)),c=Math.atan2(b,1),d=-2*(c-Math.PI/4);return d/Math.PI*180},convertLongitudeToX:f,convertXToLongitude:function(a){return 360*(g(a,1)-.5)},wrapLongitude:function(a){return g(180+a,360)-180},get devicePixelRatio(){return h()},supportsTouches:n,touchstartOrMousedown:n?"touchstart":"mousedown",touchendOrMouseup:n?"touchend":"mouseup",supportsForceTouch:!n&&"webkitForce"in MouseEvent.prototype,transitionend:document.createElement("div").style.WebkitTransition?"webkitTransitionEnd":"transitionend",htmlElement:d.bind("http://www.w3.org/1999/xhtml"),svgElement:d.bind("http://www.w3.org/2000/svg"),parentNodeForSvgTarget:function(a){return this.isIE9()?a.nearestViewportElement?a.nearestViewportElement.parentNode:a.tagName&&"div"!==a.tagName.toLowerCase()?a.parentNode:a:a.tagName&&"div"!==a.tagName.toLowerCase()?this.parentNodeForSvgTarget(a.parentNode):a},zoomLevelForMapRectInViewport:function(a,b,c){var d=b.width/(c*a.size.width),e=b.height/(c*a.size.height);return Math.log(Math.min(d,e))/Math.log(2)},mapUnitsPerMeterAtLatitude:function(a){var b=a*Math.PI/180,c=111132.92,d=-559.82,f=1.175,g=-.0023,h=c+d*Math.cos(2*b)+f*Math.cos(4*b)+g*Math.cos(6*b),i=e(a-.5),j=e(a+.5),k=Math.abs(i-j);return k/h},mod:g,log2:function(a){return Math.log(a)/m},clamp:function(a,b,c){return Math.max(b,Math.min(a,c))},inheritPrototype:function(a,b,c){var d={constructor:{enumerable:!0,value:b}};return Object.keys(c).forEach(function(a){var b=Object.getOwnPropertyDescriptor(c,a);b&&(d[a]=b)}),Object.create(a.prototype,d)},imagePathForDevice:function(a,b,c){var d=(a||[]).indexOf(this.devicePixelRatio)>=0?this.devicePixelRatio:1;return c=c||".png",b+(d>1?"_"+d+"x":"")+".png"},checkValueIsInEnum:function(a,b){return Object.keys(b).some(function(c){return b[c]===a})},required:function(a,b,c){if(c=c||{},"checkNull"in c||(c.checkNull=!0),void 0===a||c.checkNull&&null===a)throw new Error(b||"Missing parameter");return this},checkType:function(a,b,c){if(typeof a!==b)throw new TypeError(c||"Expected `"+b+"` but got `"+typeof a+"`");if("number"===b&&isNaN(a))throw new TypeError(c||"Expected `"+b+"` but got `NaN`");return this},checkInstance:function(a,b,c){if(!(a instanceof b))throw new Error(c||"Unexpected object instance");return this},checkElement:function(a,b){if(!this.isElement(a))throw new Error(b||"Expected an Element");return this},checkArray:function(a,b){if(!Array.isArray(a))throw new Error(b||"Expected an array");return this},isElement:function(a){return a instanceof window.Node&&a.nodeType===window.Node.ELEMENT_NODE},toQueryString:function(a){return null===a||"object"!=typeof a?"":Object.keys(a).reduce(function(b,c){var d=a[c];return d&&(console.assert("string"==typeof d,"toQueryString: only strings are allowed as values"),b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))),b},[]).join("&")},parseQueryString:function(a){var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))};if("string"==typeof a)for(;null!==(b=e.exec(a));)c[f(b[1])]=f(b[2]);return c},fillTemplate:function(a,b,c){return a.replace(/{{(.*?)}}/g,function(a,d){var e=b[d];if(c&&!e)throw new Error("fillTemplate: Missing value for parameter: "+d);return e})},createSVGIcon:function(a,b){var c=this.svgElement("svg",b);return c.setAttribute("class","mk-icon"),c.setAttribute("focusable",!1),c.appendChild(this.svgElement("g")).appendChild(a),c},xhr:function(a,b){function c(b){a.handleEvent({target:d,type:b})}var d,e=!1;return b&&(e=i.isSameOrigin(b,location.href)),window.XDomainRequest&&!e?(d=new XDomainRequest,d.onload=function(){d.status=200,c("load")},d.onerror=function(){c("error")},d.ontimeout=function(){c("timeout")},d.onprogress=function(){c("progress")},d.setRequestHeader=function(){}):(d=new XMLHttpRequest,d.addEventListener("load",a),d.addEventListener("error",a),d.addEventListener("timeout",a)),d},debounce:function(a,b,c){var d;return function(){function e(){d=null,a.apply(c,f)}var f=arguments;d&&window.clearTimeout(d),d=window.setTimeout(e,b||0)}},convertColorToRGB:function(a){var b=document.createElement("div");try{return b.style.setProperty("color",a),b.style.color}catch(c){return""}},isValidCSSColor:function(a){return""!==this.convertColorToRGB(a)}}},{"./urls":98,"class-list":2,"device-pixel-ratio":4,"gesture-recognizers":12}],102:[function(a,b,c){function d(a){this._delegate=a.delegate,this._node=a.node,this._duration=a.duration,this._startRect=a.from,this._endRect=a.to,this._animatedEndRect=this._endRect.copy();var b=this._startRect.midX()-this._endRect.midX();Math.abs(b)>.5&&(0>b?this._startRect.origin.x+=1:this._animatedEndRect.origin.x+=1),this._startTime=Date.now(),this._node.scheduleUpdate(this)}var e=a("./types").MapRect;d.prototype={constructor:d,cancel:function(){this._cancelled=!0},updateNode:function(){if(!this._cancelled){var a=this._startRect,b=this._animatedEndRect,c=a.origin.x,d=a.origin.y,f=a.size.width,g=a.size.height,h=b.origin.x-a.origin.x,i=b.origin.y-a.origin.y,j=b.size.width-a.size.width,k=b.size.height-a.size.height,l=Date.now(),m=l-this._startTime,n=Math.min(m/this._duration,1),o=new e(c+h*n,d+i*n,f+j*n,g+k*n);this._delegate.visibleMapRectAnimationDidProgress(o),n>=1?this._delegate.visibleMapRectAnimationDidEnd(this._endRect):this._node.scheduleUpdate(this)}}},b.exports=d},{"./types":97}],103:[function(a,b,c){b.exports={"Annotation.Generic.AccessibilityLabel":"{{title}}, {{subtitle}}","Annotation.Pin.AccessibilityLabel":"Pin","Annotation.Pin.Green.AccessibilityLabel":"Green Pin","Annotation.Pin.Purple.AccessibilityLabel":"Purple Pin","Annotation.Pin.Red.AccessibilityLabel":"Red Pin","Legal.Attribution.HTML.Label":"Data from {{logo}}, others {{chevron}}","Legal.Attribution.Plain.Label":"Data from {{attribution}}","Legal.Label":"Legal","Legal.Menu.Close.Label":"Close","Legal.Privacy.Label":"Privacy","Legal.Privacy.URL":"https://www.apple.com/privacy/","Legal.TermsOfUse.Label":"Terms of Use","Legal.TermsOfUse.URL":"http://www.apple.com/legal/internet-services/maps/terms-en.html","Location.Subtitle":"Unknown Address","Location.Title":"Current Location","Logo.Apple.Tooltip":"Apple","Logo.AutoNavi.Tooltip":"AutoNavi","Mode.Hybrid":"Hybrid","Mode.Satellite":"Satellite","Mode.Standard":"Standard","Track.User.Location.Tooltip":"Show your current location","Zoom.In.Tooltip":"Zoom In","Zoom.Out.Tooltip":"Zoom Out"}},{}],104:[function(a,b,c){b.exports=["en-US","fr-FR","pt-BR","zh-CN"]},{}],105:[function(a,b,c){b.exports={zh:{CN:"Hans",HK:"Hant",TW:"Hant"}}},{}],106:[function(a,b,c){b.exports=["ar-SA","iw-IL"]},{}],107:[function(a,b,c){b.exports=["ar-SA","ca-ES","cs-CZ","da-DK","de-DE","el-GR","en-GB","en-US","es-ES","fi-FI","fr-CA","fr-FR","hi-IN","hr-HR","hu-HU","id-ID","it-IT","iw-IL","ja-JP","ko-KR","ms-MY","nl-NL","no-NO","pl-PL","pt-BR","pt-PT","ro-RO","ru-RU","sk-SK","sv-SE","th-TH","tr-TR","uk-UA","vi-VI","zh-CN","zh-TW"]},{}],108:[function(a,b,c){b.exports=["ar","ca","cs","da","de","el","en","en-AU","en-GB","es","es-MX","fi","fr","fr-CA","he","hi","hr","hu","id","it","ja","ko","ms","nb","nl","pl","pt","pt-PT","ro","ru","sk","sv","th","tr","uk","vi","zh-Hans","zh-Hant"]},{}]},{},[1]);